import{F as e}from"./Form-z-w41Ao_.js";import{d as o,b as s,a5 as t,m as a,u as r,q as l,e as n,F as i,H as c,I as d,r as u,G as m,Q as p,a6 as f,a as g,a7 as w,a8 as h,o as v,i as y,O as R,k as b}from"./index-sOAuXSC9.js";import{E as P}from"./el-checkbox-n8j0cSmU.js";import{E as I}from"./el-link-eFv-wUTI.js";import{u as j}from"./useForm-DRnDcJlc.js";import{u as x}from"./useValidator-qshxcBT7.js";function k(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!R(e)}const z="#999",D="var(--el-color-primary)",E=o({__name:"LoginForm",emits:["to-register"],setup(o,{emit:R}){const{required:E}=x(),F=R,C=s(),A=t(),L=a(),{currentRoute:q,addRoute:V,push:M}=r(),{t:O}=b(),S={username:[E()],password:[E()]},_=l([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>n("h2",{class:"text-2xl font-bold text-center w-[100%]"},[O("login.login")])}}},{field:"username",label:O("login.username"),component:"Input",colProps:{span:24},componentProps:{placeholder:"admin or test"}},{field:"password",label:O("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"admin or test"}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return n(i,null,[n("div",{class:"flex justify-between items-center w-[100%]"},[n(P,{modelValue:U.value,"onUpdate:modelValue":e=>U.value=e,label:O("login.remember"),size:"small"},null),n(I,{type:"primary",underline:!1},k(e=O("login.forgetPassword"))?e:{default:()=>[e]})])])}}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e,o;return n(i,null,[n("div",{class:"w-[100%]"},[n(c,{loading:J.value,type:"primary",class:"w-[100%]",onClick:T},k(e=O("login.login"))?e:{default:()=>[e]})]),n("div",{class:"w-[100%] mt-15px"},[n(c,{class:"w-[100%]",onClick:X},k(o=O("login.register"))?o:{default:()=>[o]})])])}}}},{field:"other",component:"Divider",label:O("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24},formItemProps:{slots:{default:()=>n(i,null,[n("div",{class:"flex justify-between w-[100%]"},[n(d,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer ant-icon",color:z,hoverColor:D},null),n(d,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer ant-icon",color:z,hoverColor:D},null),n(d,{icon:"ant-design:alipay-circle-filled",size:30,color:z,hoverColor:D,class:"cursor-pointer ant-icon"},null),n(d,{icon:"ant-design:weibo-circle-filled",size:30,color:z,hoverColor:D,class:"cursor-pointer ant-icon"},null)])])}}}]),U=u(A.getRememberMe);m((()=>{(()=>{const e=A.getLoginInfo;if(e){const{username:o,password:s}=e;B({username:o,password:s})}})()}));const{formRegister:G,formMethods:H}=j(),{getFormData:N,getElFormExpose:Q,setValues:B}=H,J=u(!1),K=u("");p((()=>q.value),(e=>{var o;K.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const T=async()=>{const e=await Q();await(null==e?void 0:e.validate((async e=>{if(e){J.value=!0;const e=await N();try{const o=await f(e);o&&(g(U)?A.setLoginInfo({username:e.username,password:e.password}):A.setLoginInfo(void 0),A.setRememberMe(g(U)),A.setUserInfo(o.data),C.getDynamicRouter?W():(await L.generateRoutes("static").catch((()=>{})),L.getAddRouters.forEach((e=>{V(e)})),L.setIsAddRouters(!0),M({path:K.value||L.addRouters[0].path})))}finally{J.value=!1}}})))},W=async()=>{const e={roleName:(await N()).username},o=C.getDynamicRouter&&C.getServerDynamicRouter?await w(e):await h(e);if(o){const e=o.data||[];A.setRoleRouters(e),C.getDynamicRouter&&C.getServerDynamicRouter?await L.generateRoutes("server",e).catch((()=>{})):await L.generateRoutes("frontEnd",e).catch((()=>{})),L.getAddRouters.forEach((e=>{V(e)})),L.setIsAddRouters(!0),M({path:K.value||L.addRouters[0].path})}},X=()=>{F("to-register")};return(o,s)=>(v(),y(g(e),{schema:_,rules:S,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:g(G)},null,8,["schema","onRegister"]))}});export{E as _};
