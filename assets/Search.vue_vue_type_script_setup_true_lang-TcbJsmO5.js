import{F as e,i as s}from"./Form-z-w41Ao_.js";import{d as o,S as a,A as t,o as n,c as l,i,w as r,a as d,V as c,F as h,B as u,t as m,k as p,r as f,x as g,Q as w,G as b,e as v,$ as x,a4 as y,c2 as E,c8 as S,c9 as k,s as F}from"./index-sOAuXSC9.js";import{u as L}from"./useForm-DRnDcJlc.js";import{u as R}from"./useIcon-ti0QyV6o.js";const j=o({__name:"ActionButton",props:{showSearch:a.bool.def(!0),showReset:a.bool.def(!0),showExpand:a.bool.def(!1),visible:a.bool.def(!0),searchLoading:a.bool.def(!1),resetLoading:a.bool.def(!1)},emits:["search","reset","expand"],setup(e,{emit:s}){const o=s,{t:a}=p(),f=()=>{o("search")},g=()=>{o("reset")},w=()=>{o("expand")};return(s,o)=>{const p=t("BaseButton");return n(),l(h,null,[e.showSearch?(n(),i(p,{key:0,type:"primary",loading:e.searchLoading,icon:d(R)({icon:"ep:search"}),onClick:f},{default:r((()=>[u(m(d(a)("common.query")),1)])),_:1},8,["loading","icon"])):c("",!0),e.showReset?(n(),i(p,{key:1,loading:e.resetLoading,plain:"",icon:d(R)({icon:"ep:refresh-right"}),onClick:g},{default:r((()=>[u(m(d(a)("common.reset")),1)])),_:1},8,["loading","icon"])):c("",!0),e.showExpand?(n(),i(p,{key:2,icon:d(R)({icon:e.visible?"ep:arrow-up":"ep:arrow-down"}),text:"",onClick:w},{default:r((()=>[u(m(d(a)(e.visible?"common.shrink":"common.expand")),1)])),_:1},8,["icon"])):c("",!0)],64)}}}),_=o({__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:a.bool.def(!1),labelWidth:a.oneOfType([String,Number]).def("auto"),layout:a.string.validate((e=>["inline","bottom"].includes(e))).def("inline"),buttonPosition:a.string.validate((e=>["left","center","right"].includes(e))).def("center"),showSearch:a.bool.def(!0),showReset:a.bool.def(!0),showExpand:a.bool.def(!1),expandField:a.string.def(""),inline:a.bool.def(!0),removeNoValueItem:a.bool.def(!0),model:{type:Object,default:()=>({})},searchLoading:a.bool.def(!1),resetLoading:a.bool.def(!1)},emits:["search","reset","register","validate"],setup(o,{expose:a,emit:t}){const i=o,r=t,m=f(!0),p=f(i.model),R=g((()=>{const e=d(P);let s=y(e.schema);if(e.showExpand&&e.expandField&&!d(m)){const o=E(s,(s=>s.field===e.expandField));s.map(((e,s)=>(e.hidden=s>=o,e)))}return"inline"===e.layout&&(s=s.concat([{field:"action",formItemProps:{labelWidth:"0px",slots:{default:()=>v("div",null,[v(j,{showSearch:e.showSearch,showReset:e.showReset,showExpand:e.showExpand,searchLoading:e.searchLoading,resetLoading:e.resetLoading,visible:m.value,onExpand:G,onReset:z,onSearch:q},null)]),label:()=>v("span",null,[u("Â ")])}}}])),s})),{formRegister:_,formMethods:O}=L(),{getElFormExpose:V,getFormData:B,getFormExpose:C}=O,A=f({}),I=f({}),P=g((()=>{const e={...i};return Object.assign(e,d(I)),e})),N=f([]);w((()=>d(R)),(async(e=[])=>{p.value=s(e,d(p)),N.value=e}),{immediate:!0,deep:!0});const W=async()=>{const e=await B();return d(P).removeNoValueItem?Object.keys(e).reduce(((s,o)=>{const a=e[o];return S(a)||(k(a)?Object.keys(a).length>0&&(s[o]=a):s[o]=a),s}),{}):e},q=async()=>{const e=await V();await(null==e?void 0:e.validate((async e=>{if(e){const e=await W();r("search",e)}})))},z=async()=>{const e=await V();null==e||e.resetFields();const s=await W();r("reset",s)},D=g((()=>({textAlign:d(P).buttonPosition}))),G=async()=>{m.value=!d(m)},M={getElFormExpose:V,setProps:(e={})=>{I.value=Object.assign(d(I),e),A.value=e},setSchema:e=>{const{schema:s}=d(P);for(const o of s)for(const s of e)o.field===s.field&&F(o,s.path,s.value)},setValues:async(e={})=>{p.value=Object.assign(i.model,d(p),e);const s=await C();null==s||s.setValues(e)},delSchema:e=>{const{schema:s}=d(P),o=E(s,(s=>s.field===e));o>-1&&s.splice(o,1)},addSchema:(e,s)=>{const{schema:o}=d(P);void 0===s?o.push(e):o.splice(s,0,e)}};b((()=>{r("register",M)})),a(M);const Q=(e,s,o)=>{r("validate",e,s,o)};return(s,a)=>(n(),l(h,null,[v(d(e),{model:p.value,"is-custom":!1,"label-width":P.value.labelWidth,"hide-required-asterisk":"",inline:P.value.inline,"is-col":P.value.isCol,schema:N.value,onRegister:d(_),onValidate:Q},null,8,["model","label-width","inline","is-col","schema","onRegister"]),"bottom"===o.layout?(n(),l("div",{key:0,style:x(D.value)},[v(j,{"show-reset":P.value.showReset,"show-search":P.value.showSearch,"show-expand":P.value.showExpand,"search-loading":P.value.searchLoading,"reset-loading":P.value.resetLoading,onExpand:G,onReset:z,onSearch:q},null,8,["show-reset","show-search","show-expand","search-loading","reset-loading"])],4)):c("",!0)],64))}});export{_};
