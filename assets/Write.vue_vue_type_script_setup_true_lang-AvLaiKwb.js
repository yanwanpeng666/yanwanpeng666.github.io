import{F as e}from"./Form-z-w41Ao_.js";import{u as s}from"./useForm-DRnDcJlc.js";import{u as a}from"./useValidator-qshxcBT7.js";import{d as o,r as t,e as l,a as r,F as i,q as n,Q as m,o as u,i as d,k as c,R as p,c2 as f}from"./index-sOAuXSC9.js";import{E as v}from"./el-tree-eX3GmpfZ.js";import{b,E as h}from"./el-checkbox-n8j0cSmU.js";import"./el-radio-button-uBLWo-z7.js";import{g as w}from"./index-G3Hz7na1.js";import{e as x,f as j}from"./tree-1FtpebiE.js";const g=o({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(o,{expose:g}){const{t:k}=c(),{required:R}=a(),y=o,F=t(),E=t([{field:"roleName",label:k("role.roleName"),component:"Input"},{field:"status",label:k("menu.status"),component:"Select",componentProps:{options:[{label:k("userDemo.disable"),value:0},{label:k("userDemo.enable"),value:1}]}},{field:"menu",label:k("role.menu"),colProps:{span:24},formItemProps:{slots:{default:()=>{var e;return l(i,null,[l("div",{class:"flex w-full"},[l("div",{class:"flex-1"},[l(v,{ref:F,"show-checkbox":!0,"node-key":"id","highlight-current":!0,"check-strictly":!0,"expand-on-click-node":!1,data:L.value,"onNode-click":V},{default:e=>l("span",null,[e.data.meta.title])})]),l("div",{class:"flex-1"},[r(N)&&(null==(e=r(N))?void 0:e.permissionList)?l(b,{modelValue:r(N).meta.permission,"onUpdate:modelValue":e=>r(N).meta.permission=e},{default:()=>{var e;return[null==(e=r(N))?void 0:e.permissionList.map((e=>l(h,{label:e.value},{default:()=>[e.label]})))]}}):null])])])}}}}]),N=t(),V=e=>{N.value=e},_=n({roleName:[R()],role:[R()],status:[R()]}),{formRegister:D,formMethods:P}=s(),{setValues:q,getFormData:C,getElFormExpose:I}=P,L=t([]);(async()=>{var e;const s=await w();if(s){if(L.value=s.data.list,!y.currentRow)return;await p();const a=[];x(y.currentRow.menu,(e=>{var s;a.push({id:e.id,permission:(null==(s=e.meta)?void 0:s.permission)||[]})})),x(L.value,(e=>{const s=f(a,(s=>s.id===e.id));if(s>-1){const o={...e.meta||{}};o.permission=a[s].permission,e.meta=o}}));for(const s of a)null==(e=r(F))||e.setChecked(s.id,!0,!1)}})();return m((()=>y.currentRow),(e=>{e&&q(e)}),{deep:!0,immediate:!0}),g({submit:async()=>{var e;const s=await I();if(await(null==s?void 0:s.validate().catch((e=>{})))){const s=await C(),a=(null==(e=r(F))?void 0:e.getCheckedKeys())||[],o=j(r(L),(e=>a.includes(e.id)));return s.menu=o||[],s}}}),(s,a)=>(u(),d(r(e),{rules:_,onRegister:r(D),schema:E.value},null,8,["rules","onRegister","schema"]))}});export{g as _};
