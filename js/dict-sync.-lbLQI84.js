import{ct as e,r as a,d as l,c as t,o as s,bq as d,g as c,f as n,m as o,w as i,bA as u,ai as r,D as m,e as p,i as f,$ as b,b7 as v,ah as y,aT as _,S as g,V as h,G as D,bs as w,Z as j,aZ as k,bM as V,aJ as S}from"./index.Dv9sjPYC.js";import{E as C,a as x}from"./col.BTxHlVsk.js";import{E as I,a as Y}from"./radio-group.DKuTe-fa.js";import{E}from"./card.UCV2TBx1.js";import{E as M}from"./empty.DXTb2JZL.js";import{a as W,E as z}from"./form-item.DgRMSZzs.js";import{E as T,a as U}from"./select.D46WCvpG.js";import"./scrollbar.DQblMs23.js";import"./popper.m2lNosSJ.js";import{u as H}from"./useStomp.gBnXjQjw.js";import"./omit.B6E_lyF8.js";import"./_baseClone.Br4BWTY9.js";import"./castArray.D1K_WIrw.js";import"./strings.BtizHOxT.js";import"./toNumber.P9ps2NTq.js";import"./_baseIteratee.DbpbFJtj.js";import"./index.8lkWLndA.js";let N=null;function A(){return N||(N=function(){const l=e(),t=H({reconnectDelay:2e4,connectionTimeout:15e3,useExponentialBackoff:!1,maxReconnectAttempts:3,autoRestoreSubscriptions:!0,debug:!1}),s=a([]),d=()=>{},c=()=>{t.unsubscribeDestination("/topic/dict"),t.disconnect(),s.value=[]},n=e=>(s.value.push(e),()=>{const a=s.value.indexOf(e);-1!==a&&s.value.splice(a,1)});return{isConnected:t.isConnected,connectionState:t.connectionState,initialize:d,cleanup:c,onDictChange:n,initWebSocket:d,closeWebSocket:c,onDictMessage:n,handleDictChangeMessage:e=>{if(e.body)try{const a=JSON.parse(e.body),{dictCode:t}=a;if(!t)return;l.removeDictItem(t),s.value.forEach(e=>{try{e(a)}catch(l){}})}catch(a){}}}}()),N}const J={class:"app-container"},O={class:"card-header"},R={class:"flex justify-between items-center"},Z={key:0,class:"dict-form"},q={class:"flex justify-between items-center"},B={class:"dict-component-demo"},F={class:"mt-4 pt-3 border-top"},G={class:"text-muted mb-2"},Q={class:"text-muted"},$={class:"flex justify-between items-center"},K={class:"cache-content"},L={class:"cache-data"},P="gender",X=S(l({__name:"dict-sync",setup(l){const S=e(),H=a(!1),N=a("-"),X=a(null),ee=a(""),ae=A(),le=t(()=>ae.isConnected),te=t(()=>le.value?"已连接":"未连接");let se=null;const de=t(()=>S.getDictItems(P).length>0),ce=async()=>{await S.loadDictItems(P),k.success("字典组件已刷新")},ne=async()=>{const e=await V.getDictItemFormData(P,"1");X.value=e},oe=async()=>{if(X.value){H.value=!0;try{await V.updateDictItem(P,"1",X.value),N.value=w(new Date,"YYYY-MM-DD HH:mm:ss").value,k.success("保存成功，后端将通过WebSocket通知所有客户端")}catch(e){k.error("保存失败")}finally{H.value=!1}}};return s(async()=>{await ne(),await S.loadDictItems(P),ee.value="1",ae.initWebSocket(),se=ae.onDictMessage(e=>{e.dictCode===P&&(N.value=w(new Date,"YYYY-MM-DD HH:mm:ss").value,j(()=>{ce()}))})}),d(()=>{se?.()}),(e,a)=>{const l=v,t=u,s=y,d=b,w=z,j=U,k=T,V=W,A=M,P=E,ae=x,se=Y,ie=I,ue=C;return n(),c("div",J,[o(P,{class:"box-card"},{header:i(()=>[m("div",O,[a[5]||(a[5]=m("span",null,"字典WebSocket实时更新演示",-1)),o(l,{type:f(le)?"success":"danger",size:"small",class:"ml-2"},{default:i(()=>[r(" WebSocket "+D(f(te)),1)]),_:1},8,["type"])])]),default:i(()=>[o(t,{type:"info",closable:!1,class:"mb-4"},{default:i(()=>[...a[6]||(a[6]=[r(' 本示例展示WebSocket实时更新字典缓存的效果。您可以编辑"男"性别字典项，保存后后端将通过WebSocket通知所有客户端刷新缓存。 ',-1)])]),_:1}),o(ue,{gutter:16},{default:i(()=>[o(ae,{span:8},{default:i(()=>[o(P,{shadow:"hover",class:"dict-card"},{header:i(()=>[m("div",R,[a[8]||(a[8]=m("span",null,"性别字典项 - 男",-1)),o(s,{type:"warning",size:"small",onClick:ne},{default:i(()=>[...a[7]||(a[7]=[r("重新加载",-1)])]),_:1})])]),default:i(()=>[m("div",null,[f(X)?(n(),c("div",Z,[o(V,{model:f(X),"label-width":"80px"},{default:i(()=>[o(w,{label:"字典编码"},{default:i(()=>[o(d,{modelValue:f(X).dictCode,"onUpdate:modelValue":a[0]||(a[0]=e=>f(X).dictCode=e),disabled:""},null,8,["modelValue"])]),_:1}),o(w,{label:"字典标签"},{default:i(()=>[o(d,{modelValue:f(X).label,"onUpdate:modelValue":a[1]||(a[1]=e=>f(X).label=e)},null,8,["modelValue"])]),_:1}),o(w,{label:"字典值"},{default:i(()=>[o(d,{modelValue:f(X).value,"onUpdate:modelValue":a[2]||(a[2]=e=>f(X).value=e),disabled:""},null,8,["modelValue"])]),_:1}),o(w,{label:"标记颜色"},{default:i(()=>[o(k,{modelValue:f(X).tagType,"onUpdate:modelValue":a[3]||(a[3]=e=>f(X).tagType=e),placeholder:"选择标签类型",style:{width:"100%"}},{default:i(()=>[o(j,{value:"success",label:"success"},{default:i(()=>[o(l,{type:"success"},{default:i(()=>[...a[9]||(a[9]=[r("success",-1)])]),_:1})]),_:1}),o(j,{value:"warning",label:"warning"},{default:i(()=>[o(l,{type:"warning"},{default:i(()=>[...a[10]||(a[10]=[r("warning",-1)])]),_:1})]),_:1}),o(j,{value:"danger",label:"danger"},{default:i(()=>[o(l,{type:"danger"},{default:i(()=>[...a[11]||(a[11]=[r("danger",-1)])]),_:1})]),_:1}),o(j,{value:"info",label:"info"},{default:i(()=>[o(l,{type:"info"},{default:i(()=>[...a[12]||(a[12]=[r("info",-1)])]),_:1})]),_:1}),o(j,{value:"primary",label:"primary"},{default:i(()=>[o(l,{type:"primary"},{default:i(()=>[...a[13]||(a[13]=[r("primary",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(w,null,{default:i(()=>[o(s,{type:"primary",loading:f(H),onClick:oe},{default:i(()=>[...a[14]||(a[14]=[r("保存",-1)])]),_:1},8,["loading"]),o(s,{onClick:ne},{default:i(()=>[...a[15]||(a[15]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):(n(),p(A,{key:1,description:"暂无字典数据"}))])]),_:1})]),_:1}),o(ae,{span:8},{default:i(()=>[o(P,{shadow:"hover",class:"dict-card"},{header:i(()=>[m("div",q,[a[17]||(a[17]=m("span",null,"字典组件展示",-1)),o(s,{type:"primary",size:"small",onClick:ce},{default:i(()=>[...a[16]||(a[16]=[r(" 手动刷新 ",-1)])]),_:1})])]),default:i(()=>[m("div",B,[a[18]||(a[18]=m("h4",{class:"mt-4 mb-3"},"性别组件",-1)),o(ie,{modelValue:f(ee),"onUpdate:modelValue":a[4]||(a[4]=e=>_(ee)?ee.value=e:null)},{default:i(()=>[(n(!0),c(g,null,h(f(S).getDictItems("gender"),e=>(n(),p(se,{key:e.value,value:e.value},{default:i(()=>[r(D(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a[19]||(a[19]=m("h4",{class:"mt-4 mb-3"},"性别标签",-1)),m("div",null,[(n(!0),c(g,null,h(f(S).getDictItems("gender"),e=>(n(),p(l,{key:e.value,type:e.tagType||void 0,class:"mr-2"},{default:i(()=>[r(D(e.label),1)]),_:2},1032,["type"]))),128))]),m("div",F,[m("div",G,"已选择值: "+D(f(ee)),1),m("div",Q,"最后更新: "+D(f(N)),1)])])]),_:1})]),_:1}),o(ae,{span:8},{default:i(()=>[o(P,{shadow:"hover",class:"dict-card"},{header:i(()=>[m("div",$,[a[22]||(a[22]=m("span",null,"字典缓存数据",-1)),m("div",null,[f(de)?(n(),p(l,{key:0,type:"success",class:"ml-2",size:"small"},{default:i(()=>[...a[20]||(a[20]=[r(" 已缓存 ",-1)])]),_:1})):(n(),p(l,{key:1,type:"danger",class:"ml-2",size:"small"},{default:i(()=>[...a[21]||(a[21]=[r("未缓存",-1)])]),_:1}))])])]),default:i(()=>[m("div",K,[m("pre",L,D(JSON.stringify(f(S).getDictItems("gender"),null,2)),1)])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),[["__scopeId","data-v-d5b454f1"]]);export{X as default};
