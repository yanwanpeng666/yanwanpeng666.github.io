import{E as e,a as t,f as l,s as a}from"./el-select.D5K2M6II.js";import{E as s}from"./el-tree.cbGAGcQx.js";import{b as o,J as d,o as n,u as c,L as r,M as u,Z as i,c as v,aa as p,bA as h,U as f,d as k,C as y,at as C,b_ as m,O as b,ca as N,c0 as g,B as K,I as x,_ as O,r as E,W as V,aq as S,q as M}from"./index.-2dSJvT_.js";const w=k({extends:t,setup(e,l){const a=t.setup(e,l);delete a.selectOptionClick;const s=y().proxy;return i(()=>{a.select.states.cachedOptions.get(s.value)||a.select.onOptionCreate(s)}),d(()=>l.attrs.visible,e=>{i(()=>{a.states.visible=e})},{immediate:!0}),a},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function A(e){return e||0===e}function j(e){return C(e)&&e.length}function L(e){return C(e)?e:A(e)?[e]:[]}function $(e,t,l,a,s){for(let o=0;o<e.length;o++){const d=e[o];if(t(d,o,e,s))return a?a(d,o,e,s):d;{const e=l(d);if(j(e)){const s=$(e,t,l,a,d);if(s)return s}}}}function q(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const d=l(o);j(d)&&q(d,t,l,o)}}var H=k({props:{data:{type:Array,default:()=>[]}},setup(e){const t=K(a);return d(()=>e.data,()=>{var l;e.data.forEach(e=>{t.states.cachedOptions.has(e.value)||t.states.cachedOptions.set(e.value,e)});const a=(null==(l=t.selectRef)?void 0:l.querySelectorAll("input"))||[];x&&!Array.from(a).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const R=M(O(k({name:"ElTreeSelect",inheritAttrs:!1,props:{...e.props,...s.props,cacheData:{type:Array,default:()=>[]}},setup(t,a){const{slots:k,expose:y}=a,C=E(),K=E(),x=v(()=>t.nodeKey||t.valueKey||"value"),O=((t,{attrs:l,emit:a},{select:s,tree:k,key:y})=>{const C=o("tree-select");d(()=>t.data,()=>{t.filterable&&i(()=>{var e,t;null==(t=k.value)||t.filter(null==(e=s.value)?void 0:e.states.inputValue)})},{flush:"post"});const m=e=>{var t;const l=e.at(-1);if(!l.expanded||!l.childNodes.at(-1)){const l=null==(t=k.value.el$)?void 0:t.querySelector(`[data-key="${e.at(-1).key}"]`);return void(null==l||l.focus({preventScroll:!0}))}m([l.childNodes.at(-1)])};return n(()=>{c(()=>{var e;return null==(e=s.value)?void 0:e.$el},"keydown",async e=>{const t=r(e),{dropdownMenuVisible:l}=s.value;[u.down,u.up].includes(t)&&l&&(await i(),setTimeout(()=>{var e,l,a;if(u.up===t){const e=k.value.store.root.childNodes;return void m(e)}null==(a=null==(l=null==(e=s.value.optionsArray[s.value.states.hoveringIndex].$el)?void 0:e.parentNode)?void 0:l.parentNode)||a.focus({preventScroll:!0})}))},{capture:!0})}),{...p(h(t),Object.keys(e.props)),...l,class:v(()=>l.class),style:v(()=>l.style),"onUpdate:modelValue":e=>a(f,e),valueKey:y,popperClass:v(()=>{const e=[C.e("popper")];return t.popperClass&&e.push(t.popperClass),e.join(" ")}),filterMethod:(e="")=>{var l;t.filterMethod?t.filterMethod(e):t.remoteMethod?t.remoteMethod(e):null==(l=k.value)||l.filter(e)}}})(t,a,{select:C,tree:K,key:x}),{cacheOptions:M,...R}=((e,{attrs:t,slots:a,emit:o},{select:n,tree:c,key:r})=>{d([()=>e.modelValue,c],()=>{e.showCheckbox&&i(()=>{const t=c.value;t&&!g(t.getCheckedKeys(),L(e.modelValue))&&t.setCheckedKeys(L(e.modelValue))})},{immediate:!0,deep:!0});const u=v(()=>({value:r.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),k=(e,t)=>{var l;const a=u.value[e];return N(a)?a(t,null==(l=c.value)?void 0:l.getNode(k("value",t))):t[a]},y=L(e.modelValue).map(t=>$(e.data||[],e=>k("value",e)===t,e=>k("children",e),(e,t,l,a)=>a&&k("value",a))).filter(e=>A(e)),C=v(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return q(e.data.concat(e.cacheData),e=>{const l=k("value",e);t.push({value:l,currentLabel:k("label",e),isDisabled:k("disabled",e)})},e=>k("children",e)),t}),K=()=>{var e;return null==(e=c.value)?void 0:e.getCheckedKeys().filter(e=>{var t;const l=null==(t=c.value)?void 0:t.getNode(e);return!b(l)&&m(l.childNodes)})};return{...p(h(e),Object.keys(s.props)),...t,nodeKey:r,expandOnClickNode:v(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:v(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(y):y),renderContent:(t,{node:l,data:s,store:o})=>t(w,{value:k("value",s),label:k("label",s),disabled:k("disabled",s),visible:l.visible},e.renderContent?()=>e.renderContent(t,{node:l,data:s,store:o}):a.default?()=>a.default({node:l,data:s,store:o}):void 0),filterNodeMethod:(t,a,s)=>e.filterNodeMethod?e.filterNodeMethod(t,a,s):!t||new RegExp(l(t),"i").test(k("label",a)||""),onNodeClick:(l,a,s)=>{var o,d,c;if(null==(o=t.onNodeClick)||o.call(t,l,a,s),!e.showCheckbox||!e.checkOnClickNode)if(e.showCheckbox||!e.checkStrictly&&!a.isLeaf)e.expandOnClickNode&&s.proxy.handleExpandIconClick();else if(!k("disabled",l)){const e=null==(d=n.value)?void 0:d.states.options.get(k("value",l));null==(c=n.value)||c.handleOptionSelect(e)}},onCheck:(l,a)=>{var s;if(!e.showCheckbox)return;const d=k("value",l),r={};q([c.value.store.root],e=>r[e.key]=e,e=>e.childNodes);const u=a.checkedKeys,v=e.multiple?L(e.modelValue).filter(e=>!(e in r)&&!u.includes(e)):[],p=v.concat(u);if(e.checkStrictly)o(f,e.multiple?p:p.includes(d)?d:void 0);else if(e.multiple){const e=K();o(f,v.concat(e))}else{const t=$([l],e=>!j(k("children",e))&&!k("disabled",e),e=>k("children",e)),a=t?k("value",t):void 0,s=A(e.modelValue)&&!!$([l],t=>k("value",t)===e.modelValue,e=>k("children",e));o(f,a===e.modelValue||s?void 0:a)}i(()=>{var a;const s=L(e.modelValue);c.value.setCheckedKeys(s),null==(a=t.onCheck)||a.call(t,l,{checkedKeys:c.value.getCheckedKeys(),checkedNodes:c.value.getCheckedNodes(),halfCheckedKeys:c.value.getHalfCheckedKeys(),halfCheckedNodes:c.value.getHalfCheckedNodes()})}),null==(s=n.value)||s.focus()},onNodeExpand:(l,a,s)=>{var d;null==(d=t.onNodeExpand)||d.call(t,l,a,s),i(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const t={},l=c.value.getCheckedKeys();q([c.value.store.root],e=>t[e.key]=e,e=>e.childNodes);const a=L(e.modelValue).filter(e=>!(e in t)&&!l.includes(e)),s=K();o(f,a.concat(s))}})},cacheOptions:C}})(t,a,{select:C,tree:K,key:x}),_=V({});return y(_),n(()=>{Object.assign(_,{...p(K.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...p(C.value,["focus","blur","selectedLabel"]),treeRef:K.value,selectRef:C.value})}),()=>S(e,V({...O,ref:e=>C.value=e}),{...k,default:()=>[S(H,{data:M.value}),S(s,V({...R,ref:e=>K.value=e}))]})}}),[["__file","tree-select.vue"]]));export{R as E};
