import{a as e,E as t,s as l}from"./el-select.BXFPsYVq.js";import{_ as a}from"./el-tree.BOV7JSyl.js";import{u as s,y as o,S as r,bo as d,U as n,z as c,d as u,h as i,ds as p,j as h,r as f,R as v,o as k,al as y,_ as C}from"./index.BM8HYK7W.js";import{p as m}from"./search.D9QYmBQ9.js";import{e as b}from"./strings.Dq2gSJJ_.js";import{i as g}from"./isEqual.CKhcz8jC.js";const K=u({extends:t,setup(e,l){const a=t.setup(e,l);delete a.selectOptionClick;const s=i().proxy;return r((()=>{a.select.states.cachedOptions.get(s.value)||a.select.onOptionCreate(s)})),a},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function N(e){return e||0===e}function x(e){return Array.isArray(e)&&e.length}function O(e){return Array.isArray(e)?e:N(e)?[e]:[]}function E(e,t,l,a,s){for(let o=0;o<e.length;o++){const r=e[o];if(t(r,o,e,s))return a?a(r,o,e,s):r;{const e=l(r);if(x(e)){const s=E(e,t,l,a,r);if(s)return s}}}}function j(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const r=l(o);x(r)&&j(r,t,l,o)}}var A=u({props:{data:{type:Array,default:()=>[]}},setup(e){const t=h(l);return o((()=>e.data),(()=>{var l;e.data.forEach((e=>{t.states.cachedOptions.has(e.value)||t.states.cachedOptions.set(e.value,e)}));const a=(null==(l=t.selectRef)?void 0:l.querySelectorAll("input"))||[];Array.from(a).includes(document.activeElement)||t.setSelected()}),{flush:"post",immediate:!0}),()=>{}}});var V=C(u({name:"ElTreeSelect",inheritAttrs:!1,props:{...e.props,...a.props,cacheData:{type:Array,default:()=>[]}},setup(t,l){const{slots:u,expose:i}=l,h=f(),C=f(),V=c((()=>t.nodeKey||t.valueKey||"value")),M=((t,{attrs:l,emit:a},{select:u,tree:i,key:p})=>{const h=s("tree-select");return o((()=>t.data),(()=>{t.filterable&&r((()=>{var e,t;null==(t=i.value)||t.filter(null==(e=u.value)?void 0:e.states.inputValue)}))}),{flush:"post"}),{...m(d(t),Object.keys(e.props)),...l,"onUpdate:modelValue":e=>a(n,e),valueKey:p,popperClass:c((()=>{const e=[h.e("popper")];return t.popperClass&&e.push(t.popperClass),e.join(" ")})),filterMethod:(e="")=>{var l;t.filterMethod?t.filterMethod(e):t.remoteMethod?t.remoteMethod(e):null==(l=i.value)||l.filter(e)}}})(t,l,{select:h,tree:C,key:V}),{cacheOptions:S,...w}=((e,{attrs:t,slots:l,emit:s},{select:u,tree:i,key:h})=>{o((()=>e.modelValue),(()=>{e.showCheckbox&&r((()=>{const t=i.value;t&&!g(t.getCheckedKeys(),O(e.modelValue))&&t.setCheckedKeys(O(e.modelValue))}))}),{immediate:!0,deep:!0});const f=c((()=>({value:h.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props}))),v=(e,t)=>{var l;const a=f.value[e];return p(a)?a(t,null==(l=i.value)?void 0:l.getNode(v("value",t))):t[a]},k=O(e.modelValue).map((t=>E(e.data||[],(e=>v("value",e)===t),(e=>v("children",e)),((e,t,l,a)=>a&&v("value",a))))).filter((e=>N(e))),y=c((()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return j(e.data.concat(e.cacheData),(e=>{const l=v("value",e);t.push({value:l,currentLabel:v("label",e),isDisabled:v("disabled",e)})}),(e=>v("children",e))),t}));return{...m(d(e),Object.keys(a.props)),...t,nodeKey:h,expandOnClickNode:c((()=>!e.checkStrictly&&e.expandOnClickNode)),defaultExpandedKeys:c((()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(k):k)),renderContent:(t,{node:a,data:s,store:o})=>t(K,{value:v("value",s),label:v("label",s),disabled:v("disabled",s)},e.renderContent?()=>e.renderContent(t,{node:a,data:s,store:o}):l.default?()=>l.default({node:a,data:s,store:o}):void 0),filterNodeMethod:(t,l,a)=>e.filterNodeMethod?e.filterNodeMethod(t,l,a):!t||new RegExp(b(t),"i").test(v("label",l)||""),onNodeClick:(l,a,s)=>{var o,r,d,n;if(null==(o=t.onNodeClick)||o.call(t,l,a,s),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!a.isLeaf)e.expandOnClickNode&&s.proxy.handleExpandIconClick();else if(!v("disabled",l)){const e=null==(r=u.value)?void 0:r.states.options.get(v("value",l));null==(d=u.value)||d.handleOptionSelect(e)}null==(n=u.value)||n.focus()}},onCheck:(l,a)=>{var o;if(!e.showCheckbox)return;const d=v("value",l),c={};j([i.value.store.root],(e=>c[e.key]=e),(e=>e.childNodes));const p=a.checkedKeys,h=e.multiple?O(e.modelValue).filter((e=>!(e in c)&&!p.includes(e))):[],f=h.concat(p);if(e.checkStrictly)s(n,e.multiple?f:f.includes(d)?d:void 0);else if(e.multiple)s(n,h.concat(i.value.getCheckedKeys(!0)));else{const t=E([l],(e=>!x(v("children",e))&&!v("disabled",e)),(e=>v("children",e))),a=t?v("value",t):void 0,o=N(e.modelValue)&&!!E([l],(t=>v("value",t)===e.modelValue),(e=>v("children",e)));s(n,a===e.modelValue||o?void 0:a)}r((()=>{var a;const s=O(e.modelValue);i.value.setCheckedKeys(s),null==(a=t.onCheck)||a.call(t,l,{checkedKeys:i.value.getCheckedKeys(),checkedNodes:i.value.getCheckedNodes(),halfCheckedKeys:i.value.getHalfCheckedKeys(),halfCheckedNodes:i.value.getHalfCheckedNodes()})})),null==(o=u.value)||o.focus()},cacheOptions:y}})(t,l,{select:h,tree:C,key:V}),H=v({});return i(H),k((()=>{Object.assign(H,{...m(C.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...m(h.value,["focus","blur"])})})),()=>y(e,v({...M,ref:e=>h.value=e}),{...u,default:()=>[y(A,{data:S.value}),y(a,v({...w,ref:e=>C.value=e}))]})}}),[["__file","tree-select.vue"]]);V.install=e=>{e.component(V.name,V)};const M=V;export{M as E};
