import{cz as e,bn as a,v as s,A as t,az as l,_ as o,d as n,bc as i,cA as r,cB as c,y as u,b as v,cC as d,r as f,cD as p,c as m,cE as g,s as b,cF as y,J as w,o as k,u as h,e as x,f as I,w as z,m as C,T as O,D as S,k as _,n as N,i as $,cG as E,h as L,g as T,l as A,j as R,E as Y,af as P,S as B,cH as X,an as M,ai as j,G as D,cI as F,cJ as q,F as G,be as H,cK as K,cL as W,cM as Z,L as J,M as V,Z as Q,q as U,c9 as ee,cN as ae,cj as se,I as te,at as le,ab as oe,bO as ne,ba as ie,bb as re,cO as ce,N as ue,cP as ve,cQ as de,cR as fe,a as pe}from"./index.Dv9sjPYC.js";import{d as me}from"./debounce.CITkvERZ.js";function ge(a,s,t){var l=!0,o=!0;if("function"!=typeof a)throw new TypeError("Expected a function");return e(t)&&(l="leading"in t?!!t.leading:l,o="trailing"in t?!!t.trailing:o),me(a,s,{leading:l,maxWait:s,trailing:o})}const be=s({urlList:{type:t(Array),default:()=>l([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:t(String)}}),ye={close:()=>!0,error:e=>e instanceof Event,switch:e=>a(e),rotate:e=>a(e)},we=n({name:"ElImageViewer"});const ke=U(o(n({...we,props:be,emits:ye,setup(e,{expose:a,emit:s}){var t;const l=e,o={CONTAIN:{name:"contain",icon:i(c)},ORIGINAL:{name:"original",icon:i(r)}};let n;const{t:U}=u(),ee=v("image-viewer"),{nextZIndex:ae}=d(),se=f(),te=f(),le=p(),oe=m(()=>{const{scale:e,minScale:a,maxScale:s}=l;return g(e,a,s)}),ne=f(!0),ie=f(!1),re=f(!1),ce=f(l.initialIndex),ue=b(o.CONTAIN),ve=f({scale:oe.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),de=f(null!=(t=l.zIndex)?t:ae());y(re,{ns:ee});const fe=m(()=>{const{urlList:e}=l;return e.length<=1}),pe=m(()=>0===ce.value),me=m(()=>ce.value===l.urlList.length-1),be=m(()=>l.urlList[ce.value]),ye=m(()=>[ee.e("btn"),ee.e("prev"),ee.is("disabled",!l.infinite&&pe.value)]),we=m(()=>[ee.e("btn"),ee.e("next"),ee.is("disabled",!l.infinite&&me.value)]),ke=m(()=>{const{scale:e,deg:a,offsetX:s,offsetY:t,enableTransition:l}=ve.value;let n=s/e,i=t/e;const r=a*Math.PI/180,c=Math.cos(r),u=Math.sin(r);n=n*c+i*u,i=i*c-s/e*u;const v={transform:`scale(${e}) rotate(${a}deg) translate(${n}px, ${i}px)`,transition:l?"transform .3s":""};return ue.value.name===o.CONTAIN.name&&(v.maxWidth=v.maxHeight="100%"),v}),he=m(()=>`${ce.value+1} / ${l.urlList.length}`);function xe(){le.stop(),null==n||n(),re.value=!1,s("close")}function Ie(){ne.value=!1}function ze(e){ie.value=!0,ne.value=!1,s("error",e),e.target.alt=U("el.image.error")}function Ce(e){if(ne.value||0!==e.button||!se.value)return;ve.value.enableTransition=!1;const{offsetX:a,offsetY:s}=ve.value,t=e.pageX,l=e.pageY,o=ge(e=>{ve.value={...ve.value,offsetX:a+e.pageX-t,offsetY:s+e.pageY-l}}),n=h(document,"mousemove",o),i=h(document,"mouseup",()=>{n(),i()});e.preventDefault()}function Oe(e){if(ne.value||!se.value||1!==e.touches.length)return;ve.value.enableTransition=!1;const{offsetX:a,offsetY:s}=ve.value,{pageX:t,pageY:l}=e.touches[0],o=ge(e=>{const o=e.touches[0];ve.value={...ve.value,offsetX:a+o.pageX-t,offsetY:s+o.pageY-l}}),n=h(document,"touchmove",o),i=h(document,"touchend",()=>{n(),i()});e.preventDefault()}function Se(){ve.value={scale:oe.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function _e(){if(ne.value||ie.value)return;const e=Z(o),a=Object.values(o),s=ue.value.name,t=(a.findIndex(e=>e.name===s)+1)%e.length;ue.value=o[e[t]],Se()}function Ne(e){ie.value=!1;const a=l.urlList.length;ce.value=(e+a)%a}function $e(){pe.value&&!l.infinite||Ne(ce.value-1)}function Ee(){me.value&&!l.infinite||Ne(ce.value+1)}function Le(e,a={}){if(ne.value||ie.value)return;const{minScale:t,maxScale:o}=l,{zoomRate:n,rotateDeg:i,enableTransition:r}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":ve.value.scale>t&&(ve.value.scale=Number.parseFloat((ve.value.scale/n).toFixed(3)));break;case"zoomIn":ve.value.scale<o&&(ve.value.scale=Number.parseFloat((ve.value.scale*n).toFixed(3)));break;case"clockwise":ve.value.deg+=i,s("rotate",ve.value.deg);break;case"anticlockwise":ve.value.deg-=i,s("rotate",ve.value.deg)}ve.value.enableTransition=r}function Te(e){var a;"pointer"===(null==(a=e.detail)?void 0:a.focusReason)&&e.preventDefault()}function Ae(){l.closeOnPressEscape&&xe()}function Re(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}return w(()=>oe.value,e=>{ve.value.scale=e}),w(be,()=>{Q(()=>{const e=te.value;(null==e?void 0:e.complete)||(ne.value=!0)})}),w(ce,e=>{Se(),s("switch",e)}),k(()=>{re.value=!0,function(){const e=ge(e=>{switch(J(e)){case V.esc:l.closeOnPressEscape&&xe();break;case V.space:_e();break;case V.left:$e();break;case V.up:Le("zoomIn");break;case V.right:Ee();break;case V.down:Le("zoomOut")}}),a=ge(e=>{Le((e.deltaY||e.deltaX)<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});le.run(()=>{h(document,"keydown",e),h(se,"wheel",a)})}(),n=h("wheel",Re,{passive:!1})}),a({setActiveItem:Ne}),(e,a)=>(I(),x($(W),{to:"body",disabled:!e.teleported},{default:z(()=>[C(O,{name:"viewer-fade",appear:""},{default:z(()=>[S("div",{ref_key:"wrapper",ref:se,tabindex:-1,class:N($(ee).e("wrapper")),style:_({zIndex:de.value})},[C($(E),{loop:"",trapped:"","focus-trap-el":se.value,"focus-start-el":"container",onFocusoutPrevented:Te,onReleaseRequested:Ae},{default:z(()=>[S("div",{class:N($(ee).e("mask")),onClick:R(a=>e.hideOnClickModal&&xe(),["self"])},null,10,["onClick"]),L(" CLOSE "),S("span",{class:N([$(ee).e("btn"),$(ee).e("close")]),onClick:xe},[C($(Y),null,{default:z(()=>[C($(P))]),_:1})],2),L(" ARROW "),$(fe)?L("v-if",!0):(I(),T(B,{key:0},[S("span",{class:N($(ye)),onClick:$e},[C($(Y),null,{default:z(()=>[C($(X))]),_:1})],2),S("span",{class:N($(we)),onClick:Ee},[C($(Y),null,{default:z(()=>[C($(M))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),T("div",{key:1,class:N([$(ee).e("btn"),$(ee).e("progress")])},[A(e.$slots,"progress",{activeIndex:ce.value,total:e.urlList.length},()=>[j(D($(he)),1)])],2)):L("v-if",!0),L(" ACTIONS "),S("div",{class:N([$(ee).e("btn"),$(ee).e("actions")])},[S("div",{class:N($(ee).e("actions__inner"))},[A(e.$slots,"toolbar",{actions:Le,prev:$e,next:Ee,reset:_e,activeIndex:ce.value,setActiveItem:Ne},()=>[C($(Y),{onClick:e=>Le("zoomOut")},{default:z(()=>[C($(F))]),_:1},8,["onClick"]),C($(Y),{onClick:e=>Le("zoomIn")},{default:z(()=>[C($(q))]),_:1},8,["onClick"]),S("i",{class:N($(ee).e("actions__divider"))},null,2),C($(Y),{onClick:_e},{default:z(()=>[(I(),x(G($(ue).icon)))]),_:1}),S("i",{class:N($(ee).e("actions__divider"))},null,2),C($(Y),{onClick:e=>Le("anticlockwise")},{default:z(()=>[C($(H))]),_:1},8,["onClick"]),C($(Y),{onClick:e=>Le("clockwise")},{default:z(()=>[C($(K))]),_:1},8,["onClick"])])],2)],2),L(" CANVAS "),S("div",{class:N($(ee).e("canvas"))},[ie.value&&e.$slots["viewer-error"]?A(e.$slots,"viewer-error",{key:0,activeIndex:ce.value,src:$(be)}):(I(),T("img",{ref_key:"imgRef",ref:te,key:$(be),src:$(be),style:_($(ke)),class:N($(ee).e("img")),crossorigin:e.crossorigin,onLoad:Ie,onError:ze,onMousedown:Ce,onTouchstart:Oe},null,46,["src","crossorigin"]))],2),A(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}}),[["__file","image-viewer.vue"]])),he=s({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:t([String,Object])},previewSrcList:{type:t(Array),default:()=>l([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:t(String)}}),xe={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>a(e),close:()=>!0,show:()=>!0},Ie=n({name:"ElImage",inheritAttrs:!1});const ze=U(o(n({...Ie,props:he,emits:xe,setup(e,{expose:a,emit:s}){const t=e,{t:l}=u(),o=v("image"),n=ee(),i=m(()=>ae(Object.entries(n).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),r=se({excludeListeners:!0,excludeKeys:m(()=>Object.keys(i.value))}),c=f(),d=f(!1),p=f(!0),g=f(!1),b=f(),y=f(),h=te&&"loading"in HTMLImageElement.prototype;let C;const O=m(()=>[o.e("inner"),E.value&&o.e("preview"),p.value&&o.is("loading")]),_=m(()=>{const{fit:e}=t;return te&&e?{objectFit:e}:{}}),E=m(()=>{const{previewSrcList:e}=t;return le(e)&&e.length>0}),R=m(()=>{const{previewSrcList:e,initialIndex:a}=t;let s=a;return a>e.length-1&&(s=0),s}),Y=m(()=>"eager"!==t.loading&&(!h&&"lazy"===t.loading||t.lazy)),P=()=>{te&&(p.value=!0,d.value=!1,c.value=t.src)};function X(e){p.value=!1,d.value=!1,s("load",e)}function M(e){p.value=!1,d.value=!0,s("error",e)}const j=pe(function(e){e&&(P(),q())},200,!0);async function F(){var e;if(!te)return;await Q();const{scrollContainer:a}=t;if(ce(a))y.value=a;else if(ue(a)&&""!==a)y.value=null!=(e=document.querySelector(a))?e:void 0;else if(b.value){const e=ve(b.value);y.value=de(e)?void 0:e}const{stop:s}=fe(b,([e])=>{j(e.isIntersecting)},{root:y});C=s}function q(){te&&j&&(null==C||C(),y.value=void 0,C=void 0)}function G(){E.value&&(g.value=!0,s("show"))}function H(){g.value=!1,s("close")}function K(e){s("switch",e)}return w(()=>t.src,()=>{Y.value?(p.value=!0,d.value=!1,q(),F()):P()}),k(()=>{Y.value?F():P()}),a({showPreview:G}),(e,a)=>(I(),T("div",oe({ref_key:"container",ref:b},$(i),{class:[$(o).b(),e.$attrs.class]}),[d.value?A(e.$slots,"error",{key:0},()=>[S("div",{class:N($(o).e("error"))},D($(l)("el.image.error")),3)]):(I(),T(B,{key:1},[void 0!==c.value?(I(),T("img",oe({key:0},$(r),{src:c.value,loading:e.loading,style:$(_),class:$(O),crossorigin:e.crossorigin,onClick:G,onLoad:X,onError:M}),null,16,["src","loading","crossorigin"])):L("v-if",!0),p.value?(I(),T("div",{key:1,class:N($(o).e("wrapper"))},[A(e.$slots,"placeholder",{},()=>[S("div",{class:N($(o).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),$(E)?(I(),T(B,{key:2},[g.value?(I(),x($(ke),{key:0,"z-index":e.zIndex,"initial-index":$(R),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"show-progress":e.showProgress,"url-list":e.previewSrcList,scale:e.scale,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:H,onSwitch:K},ne({toolbar:z(a=>[A(e.$slots,"toolbar",ie(re(a)))]),default:z(()=>[e.$slots.viewer?(I(),T("div",{key:0},[A(e.$slots,"viewer")])):L("v-if",!0)]),_:2},[e.$slots.progress?{name:"progress",fn:z(a=>[A(e.$slots,"progress",ie(re(a)))])}:void 0,e.$slots["viewer-error"]?{name:"viewer-error",fn:z(a=>[A(e.$slots,"viewer-error",ie(re(a)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],16))}}),[["__file","image.vue"]]));export{ze as E,ke as a};
