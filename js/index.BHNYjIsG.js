import{a as e,c as a,k as l,d as t,r as o,R as s,o as i,W as r,w as d,f as n,V as u,$ as m,T as p,l as c,aO as f,X as h,t as v,ax as g,aG as _,dd as y,Y as b,Z as k}from"./index.BM8HYK7W.js";import{_ as j,a as V,E as w,b as x,c as C,d as U,e as E,v as S}from"./refresh.BU4WPd7d.js";import{E as z}from"./el-scrollbar.mIbHh7R4.js";import{E as R}from"./el-tree.BOV7JSyl.js";import{_ as q}from"./search.D9QYmBQ9.js";import{E as N}from"./el-dialog.DOb72mWz.js";import{E as T}from"./el-input-number.B1aZbN5D.js";import{E as B}from"./el-tag.C9HAq4hI.js";import{E as F,a as A}from"./el-select.BXFPsYVq.js";import"./el-popper.DARfmJxr.js";import{E as L}from"./el-card.JvKkyGLr.js";import{_ as O}from"./index.BojkOl8h.js";import"./el-tooltip.l0sNRNKZ.js";import{_ as $}from"./plus.CKS9jjhi.js";import{E as G,a as I}from"./el-form-item.MoRrApRf.js";import{g as P,a as H,u as J,b as K,d as Q,c as W,e as X}from"./index.DPVA91VN.js";import"./_Uint8Array.Bk6YvMkU.js";import"./debounce.BCOJmmYb.js";import"./index.DDcUXN2j.js";import"./hasIn.BAQCL1fl.js";import"./index.Bj4YjYf5.js";import"./isEqual.CKhcz8jC.js";import"./use-dialog.IGiCrkwp.js";import"./isUndefined.DgmxjSXK.js";import"./refs.BIGcnKJG.js";import"./strings.Dq2gSJJ_.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./castArray.CjaThbuf.js";const Y={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},Z=[l("path",{fill:"currentColor",d:"m249.6 417.088l319.744 43.072l39.168 310.272L845.12 178.88zm-129.024 47.168a32 32 0 0 1-7.68-61.44l777.792-311.04a32 32 0 0 1 41.6 41.6l-310.336 775.68a32 32 0 0 1-61.44-7.808L512 516.992z"},null,-1)];const D={name:"ep-position",render:function(l,t){return e(),a("svg",Y,[...Z])}},M={class:"app-container"},ee={class:"search-container"},ae={class:"dialog-footer"},le={class:"dialog-footer"},te=t({name:"Role",inheritAttrs:!1,__name:"index",setup(t){const Y=o(G),Z=o(G),te=o(R),oe=o(!1),se=o([]),ie=o(0),re=s({pageNum:1,pageSize:10}),de=o(),ne=s({title:"",visible:!1}),ue=s({sort:1,status:1,code:"",name:""}),me=s({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),pe=o(!1),ce=o([]);let fe=s({});function he(){oe.value=!0,P(re).then((({data:e})=>{de.value=e.list,ie.value=e.total})).finally((()=>{oe.value=!1}))}function ve(){Y.value.resetFields(),re.pageNum=1,he()}function ge(e){se.value=e.map((e=>e.id))}function _e(e){ne.visible=!0,e?(ne.title="修改角色",H(e).then((({data:e})=>{Object.assign(ue,e)}))):ne.title="新增角色"}function ye(){Z.value.validate((e=>{if(e){oe.value=!0;const e=ue.id;e?J(e,ue).then((()=>{g.success("修改成功"),be(),ve()})).finally((()=>oe.value=!1)):K(ue).then((()=>{g.success("新增成功"),be(),ve()})).finally((()=>oe.value=!1))}}))}function be(){ne.visible=!1,Z.value.resetFields(),Z.value.clearValidate(),ue.id=void 0,ue.sort=1,ue.status=1}function ke(e){const a=[e||se.value].join(",");a?_.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{oe.value=!0,Q(a).then((()=>{g.success("删除成功"),ve()})).finally((()=>oe.value=!1))})):g.warning("请勾选删除项")}function je(){const e=fe.id;if(e){const a=te.value.getCheckedNodes(!1,!0).map((e=>e.value));oe.value=!0,X(e,a).then((()=>{g.success("分配权限成功"),pe.value=!1,ve()})).finally((()=>{oe.value=!1}))}}return i((()=>{he()})),(t,o)=>{const s=b,i=I,g=q,_=k,P=j,H=G,J=$,K=V,Q=w,X=B,Ve=D,we=x,xe=C,Ce=O,Ue=L,Ee=F,Se=A,ze=U,Re=E,qe=T,Ne=N,Te=R,Be=z,Fe=S;return e(),a("div",M,[l("div",ee,[r(H,{ref_key:"queryFormRef",ref:Y,model:n(re),inline:!0},{default:d((()=>[r(i,{prop:"keywords",label:"关键字"},{default:d((()=>[r(s,{modelValue:n(re).keywords,"onUpdate:modelValue":o[0]||(o[0]=e=>n(re).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:u(he,["enter"])},null,8,["modelValue"])])),_:1}),r(i,null,{default:d((()=>[r(_,{type:"primary",onClick:he},{default:d((()=>[r(g),m("搜索")])),_:1}),r(_,{onClick:ve},{default:d((()=>[r(P),m("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),r(Ue,{shadow:"never",class:"table-container"},{header:d((()=>[r(_,{type:"success",onClick:o[1]||(o[1]=e=>_e())},{default:d((()=>[r(J),m("新增")])),_:1}),r(_,{type:"danger",disabled:0===n(se).length,onClick:o[2]||(o[2]=e=>ke())},{default:d((()=>[r(K),m("删除")])),_:1},8,["disabled"])])),default:d((()=>[p((e(),c(xe,{ref:"dataTableRef",data:n(de),"highlight-current-row":"",border:"",onSelectionChange:ge},{default:d((()=>[r(Q,{type:"selection",width:"55",align:"center"}),r(Q,{label:"角色名称",prop:"name","min-width":"100"}),r(Q,{label:"角色编码",prop:"code",width:"150"}),r(Q,{label:"状态",align:"center",width:"100"},{default:d((a=>[1===a.row.status?(e(),c(X,{key:0,type:"success"},{default:d((()=>[m("正常")])),_:1})):(e(),c(X,{key:1,type:"info"},{default:d((()=>[m("禁用")])),_:1}))])),_:1}),r(Q,{label:"排序",align:"center",width:"80",prop:"sort"}),r(Q,{fixed:"right",label:"操作",width:"220"},{default:d((e=>[r(_,{type:"primary",size:"small",link:"",onClick:a=>function(e){const a=e.id;a&&(fe={id:a,name:e.name},pe.value=!0,oe.value=!0,y().then((e=>{ce.value=e.data,W(a).then((({data:e})=>{e.forEach((e=>te.value.setChecked(e,!0,!1)))})).finally((()=>{oe.value=!1}))})))}(e.row)},{default:d((()=>[r(Ve),m("分配权限 ")])),_:2},1032,["onClick"]),r(_,{type:"primary",size:"small",link:"",onClick:a=>_e(e.row.id)},{default:d((()=>[r(we),m("编辑 ")])),_:2},1032,["onClick"]),r(_,{type:"primary",size:"small",link:"",onClick:a=>ke(e.row.id)},{default:d((()=>[r(K),m("删除 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Fe,n(oe)]]),n(ie)>0?(e(),c(Ce,{key:0,total:n(ie),"onUpdate:total":o[3]||(o[3]=e=>f(ie)?ie.value=e:null),page:n(re).pageNum,"onUpdate:page":o[4]||(o[4]=e=>n(re).pageNum=e),limit:n(re).pageSize,"onUpdate:limit":o[5]||(o[5]=e=>n(re).pageSize=e),onPagination:he},null,8,["total","page","limit"])):h("",!0)])),_:1}),r(Ne,{modelValue:n(ne).visible,"onUpdate:modelValue":o[11]||(o[11]=e=>n(ne).visible=e),title:n(ne).title,width:"500px",onClose:be},{footer:d((()=>[l("div",ae,[r(_,{type:"primary",onClick:ye},{default:d((()=>[m("确 定")])),_:1}),r(_,{onClick:be},{default:d((()=>[m("取 消")])),_:1})])])),default:d((()=>[r(H,{ref_key:"roleFormRef",ref:Z,model:n(ue),rules:n(me),"label-width":"100px"},{default:d((()=>[r(i,{label:"角色名称",prop:"name"},{default:d((()=>[r(s,{modelValue:n(ue).name,"onUpdate:modelValue":o[6]||(o[6]=e=>n(ue).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),r(i,{label:"角色编码",prop:"code"},{default:d((()=>[r(s,{modelValue:n(ue).code,"onUpdate:modelValue":o[7]||(o[7]=e=>n(ue).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),r(i,{label:"数据权限",prop:"dataScope"},{default:d((()=>[r(Se,{modelValue:n(ue).dataScope,"onUpdate:modelValue":o[8]||(o[8]=e=>n(ue).dataScope=e)},{default:d((()=>[(e(),c(Ee,{key:0,label:"全部数据",value:0})),(e(),c(Ee,{key:1,label:"部门及子部门数据",value:1})),(e(),c(Ee,{key:2,label:"本部门数据",value:2})),(e(),c(Ee,{key:3,label:"本人数据",value:3}))])),_:1},8,["modelValue"])])),_:1}),r(i,{label:"状态",prop:"status"},{default:d((()=>[r(Re,{modelValue:n(ue).status,"onUpdate:modelValue":o[9]||(o[9]=e=>n(ue).status=e)},{default:d((()=>[r(ze,{label:1},{default:d((()=>[m("正常")])),_:1}),r(ze,{label:0},{default:d((()=>[m("停用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(i,{label:"排序",prop:"sort"},{default:d((()=>[r(qe,{modelValue:n(ue).sort,"onUpdate:modelValue":o[10]||(o[10]=e=>n(ue).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),r(Ne,{modelValue:n(pe),"onUpdate:modelValue":o[13]||(o[13]=e=>f(pe)?pe.value=e:null),title:"【"+n(fe).name+"】权限分配",width:"800px"},{footer:d((()=>[l("div",le,[r(_,{type:"primary",onClick:je},{default:d((()=>[m("确 定")])),_:1}),r(_,{onClick:o[12]||(o[12]=e=>pe.value=!1)},{default:d((()=>[m("取 消")])),_:1})])])),default:d((()=>[p((e(),c(Be,{"max-height":"600px"},{default:d((()=>[r(Te,{ref_key:"menuRef",ref:te,"node-key":"value","show-checkbox":"",data:n(ce),"default-expand-all":!0},{default:d((({data:e})=>[m(v(e.label),1)])),_:1},8,["data"])])),_:1})),[[Fe,n(oe)]])])),_:1},8,["modelValue","title"])])}}});export{te as default};
