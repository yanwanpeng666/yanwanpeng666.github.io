import{d as e,r as l,S as a,aT as o,I as t,o as u,ae as n,h as d,B as i,l as r,w as s,g as m,e as p,W as f,X as c,V as v,f as h,p as g,aj as b,D as y,$ as w,Q as V,R as _,aU as j,ax as k,U as N,aV as U,aW as C,E as x}from"./index.D_QSJYsl.js";import{v as E}from"./el-loading._KqTsM-B.js";import{E as S}from"./el-drawer.DueyomvI.js";import"./el-overlay.Dhsra1-x.js";import{E as I}from"./el-link.Bw76TBkJ.js";import{E as T}from"./el-scrollbar.BoGuQ_YI.js";import{E as q}from"./el-tree.D4gfJARj.js";import{E as F}from"./el-checkbox.CEBwfQau.js";import{_ as Q}from"./index.BieV__2C.js";/* empty css               */import{E as R,a as L}from"./el-select.DC1h_FUz.js";import{E as z}from"./el-popper.DKqv0zrb.js";import{E as W}from"./el-tree-select.DVyrlPyY.js";import"./el-tooltip.l0sNRNKZ.js";import{a as D,E as G}from"./el-col.BGZTpXFL.js";import{F as A,E as B,a as M,S as P}from"./FormTypeEnum.DQSOtj5C.js";import{E as $}from"./el-card.By4j4syX.js";import{_ as O}from"./index.D8PK28SR.js";import{E as K,a as X}from"./el-table-column.B0xSElgG.js";import{E as H,a as Z}from"./el-form-item.CqZkxdvL.js";import{E as J}from"./el-button.DHJ0WrCN.js";import{E as Y}from"./el-input.DoYwyLAs.js";import{G as ee,Q as le}from"./index.DuBDy2O_.js";import{E as ae}from"./el-message-box.tZ-J3hTm.js";import"./index.CNdeHcq7.js";import"./index.DxtlaFw4.js";import"./vnode.BmjJ-nYA.js";import"./use-form-item.CIyZU-1C.js";import"./scroll.DbNYepUn.js";import"./index.DHTQwj-k.js";import"./token.DWNpOE8r.js";import"./index.BevjTxEK.js";import"./isEqual.CxON6d9P.js";import"./_Uint8Array.BXuv5HTU.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.CS7ldtbZ.js";import"./strings.BaZxU9je.js";import"./castArray.BRlXenMr.js";import"./index.Ddvjems4.js";import"./debounce.CPg49gac.js";import"./_baseIteratee.BdihAaWh.js";import"./index.DaF98UHt.js";import"./index.qJP1IqzF.js";import"./el-pagination.5XY2b5kn.js";import"./index.DtZzBez1.js";import"./validator.pOeBc5qo.js";const oe={class:"app-container"},te={class:"search-bar"},ue={class:"mt-5"},ne={class:"flex-y-between"},de={class:"elTableCustom"},ie={class:"flex-y-center"},re={class:"flex-y-center"},se={class:"flex-y-center"},me={key:1},pe={key:1},fe={key:1},ce={key:1},ve={class:"ml-1"},he={class:"absolute-rt z-36 right-5 top-2"},ge=e({name:"Codegen",__name:"index",setup(e){const ge=l([]),be=l(H),ye=a({pageNum:1,pageSize:10}),we=l(!1),Ve=l("loading..."),_e=l([]),je=l(0),ke=A,Ne=le,Ue=l(),Ce=l([]),xe=l({fieldConfigs:[]}),Ee={tableName:[{required:!0,message:"请输入表名",trigger:"blur"}],businessName:[{required:!0,message:"请输入业务名",trigger:"blur"}],packageName:[{required:!0,message:"请输入包名",trigger:"blur"}],moduleName:[{required:!0,message:"请输入模块名",trigger:"blur"}],entityName:[{required:!0,message:"请输入实体名",trigger:"blur"}]},Se=a({visible:!1,title:""}),{copy:Ie,copied:Te}=o(),qe=l(),Fe=l(),Qe={mode:"text/javascript"},Re=l(""),Le=l("下一步，字段配置"),ze=l(0),We=l(""),De=l(),Ge=l(!1),Ae=l(!1),Be=l(!1);t(ze,(e=>{0===e?Le.value="下一步，字段配置":1===e?(Re.value="上一步，基础配置",Le.value="下一步，确认生成"):2===e&&(Re.value="上一步，字段配置",Le.value="下载代码")})),t(Te,(()=>{Te.value&&k.success("复制成功")})),t((()=>xe.value.fieldConfigs),(e=>{e.forEach((e=>{e.fieldType&&e.fieldType.includes("Date")&&1===e.isShowInQuery&&(e.queryType=le.BETWEEN.value)}))}),{deep:!0,immediate:!0});const Me=()=>{if(De.value)return;const e=document.querySelector(".elTableCustom .el-table__body-wrapper tbody");De.value=P.create(e,{group:"shared",animation:150,ghostClass:"sortable-ghost",handle:".sortable-handle",easing:"cubic-bezier(1, 0, 0, 1)",onStart:e=>{},onEnd:e=>{Pe(e.oldIndex,e.newIndex)}})},Pe=(e,l)=>{let a=Object.assign([],xe.value.fieldConfigs);const o=a.splice(e,1)[0];a.splice(l,0,o),a.forEach(((e,l)=>{e.fieldSort=l+1})),xe.value.fieldConfigs=[],N((async()=>{xe.value.fieldConfigs=a}))};function $e(){2===ze.value&&(xe.value={fieldConfigs:[]},N((()=>{we.value=!0,ee.getGenConfig(We.value).then((e=>{xe.value=e})).finally((()=>{we.value=!1}))})),Me()),ze.value--<=0&&(ze.value=0)}function Oe(){if(0===ze.value){const{tableName:e,packageName:l,businessName:a,moduleName:o,entityName:t}=xe.value;if(!(e&&l&&a&&o&&t))return void k.error("表名、业务名、包名、模块名、实体名不能为空");Me()}if(1===ze.value){const e=xe.value.tableName;if(!e)return void k.error("表名不能为空");we.value=!0,Ve.value="代码生成中，请稍后...",ee.saveGenConfig(e,xe.value).then((()=>{Je(e)})).then((()=>{ze.value++>=2&&(ze.value=2)})).finally((()=>{we.value=!1,Ve.value="loading..."}))}else if(ze.value++>=2&&(ze.value=2),2===ze.value){const e=xe.value.tableName;if(!e)return void k.error("表名不能为空");ee.download(e)}}function Ke(){we.value=!0,ee.getTablePage(ye).then((e=>{_e.value=e.list,je.value=e.total})).finally((()=>{we.value=!1}))}function Xe(){be.value.resetFields(),ye.pageNum=1,Ke()}const He=(e,l)=>{var a;const o=null==(a=xe.value)?void 0:a.fieldConfigs;o&&o.forEach((a=>{a[e]=l?1:0}))},Ze=(e,l)=>{var a;const o=(null==(a=xe.value)?void 0:a.fieldConfigs)||[];l.value=o.every((l=>1===l[e]))};function Je(e){ge.value=[],ee.getPreviewData(e).then((l=>{Se.title=`代码生成 ${e}`;const a=function(e){const l={label:"前后端代码",children:[]};return e.forEach((e=>{var a;const o=e.path.includes("/")?"/":"\\",t=e.path.split(o),u=["src"+o+"main","java",xe.value.backendAppName,xe.value.frontendAppName,(xe.value.packageName+"."+xe.value.moduleName).replace(/\./g,o)],n=[];let d=[];t.forEach((e=>{d.push(e);const l=d.join(o);u.includes(l)&&(n.push(l),d=[])})),n.forEach(((e,l)=>{n[l]=e.replace(/\\/g,"/")})),d.length>0&&n.push(...d);let i=l;n.forEach((e=>{var l,a;let o=null==(l=i.children)?void 0:l.find((l=>l.label===e));o||(o={label:e,children:[]},null==(a=i.children)||a.push(o)),i=o})),null==(a=i.children)||a.push({label:e.fileName,content:null==e?void 0:e.content})})),l}(l);ge.value=[a];const o=Ye(a);o&&(qe.value=o.content||"")})).catch((()=>{ze.value=0}))}function Ye(e){if(!e.children||0===e.children.length)return e;for(const l of e.children){const e=Ye(l);if(e)return e}return null}function el(e){e.children&&0!==e.children.length||(qe.value=e.content||"")}const ll=()=>{qe.value&&Ie(qe.value)};return u((()=>{var e;Ke(),null==(e=Fe.value)||e.destroy()})),(e,l)=>{const a=Y,o=Z,t=n("Search"),u=J,N=n("Refresh"),P=H,le=K,Ie=n("MagicStick"),Te=n("RefreshLeft"),De=X,Me=O,Pe=$,Ye=B,al=M,ol=D,tl=G,ul=n("QuestionFilled"),nl=x,dl=z,il=W,rl=n("Rank"),sl=F,ml=L,pl=R,fl=Q,cl=q,vl=T,hl=n("CopyDocument"),gl=I,bl=n("Back"),yl=n("Right"),wl=n("Download"),Vl=S,_l=E;return p(),d("div",oe,[i("div",te,[r(P,{ref_key:"queryFormRef",ref:be,model:m(ye),inline:!0},{default:s((()=>[r(o,{prop:"keywords",label:"关键字"},{default:s((()=>[r(a,{modelValue:m(ye).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>m(ye).keywords=e),placeholder:"表名",clearable:"",onKeyup:f(Ke,["enter"])},null,8,["modelValue"])])),_:1}),r(o,null,{default:s((()=>[r(u,{type:"primary",onClick:Ke},{icon:s((()=>[r(t)])),default:s((()=>[l[20]||(l[20]=c(" 搜索 "))])),_:1}),r(u,{onClick:Xe},{icon:s((()=>[r(N)])),default:s((()=>[l[21]||(l[21]=c(" 重置 "))])),_:1})])),_:1})])),_:1},8,["model"])]),r(Pe,{shadow:"never",class:"table-container"},{default:s((()=>[v((p(),h(De,{ref:"dataTableRef",data:m(_e),"highlight-current-row":"",border:""},{default:s((()=>[r(le,{type:"selection",width:"55",align:"center"}),r(le,{label:"表名",prop:"tableName","min-width":"100"}),r(le,{label:"描述",prop:"tableComment",width:"150"}),r(le,{label:"存储引擎",align:"center",prop:"engine"}),r(le,{label:"排序规则",align:"center",prop:"tableCollation"}),r(le,{label:"创建时间",align:"center",prop:"createTime"}),r(le,{fixed:"right",label:"操作",width:"200"},{default:s((e=>[r(u,{type:"primary",size:"small",link:"",onClick:l=>async function(e){Se.visible=!0,ze.value=0,Ce.value=await U.getOptions(!0),We.value=e,C.getList().then((l=>{Ue.value=l.map((e=>({label:e.name,value:e.dictCode}))),we.value=!0,ee.getGenConfig(e).then((l=>{Se.title=`${e} 代码生成`,xe.value=l,Ze("isShowInQuery",Ge),Ze("isShowInList",Ae),Ze("isShowInForm",Be),xe.value.id?(ze.value=2,Je(e)):ze.value=0})).finally((()=>{we.value=!1}))}))}(e.row.tableName)},{icon:s((()=>[r(Ie)])),default:s((()=>[l[22]||(l[22]=c(" 生成代码 "))])),_:2},1032,["onClick"]),1===e.row.isConfigured?(p(),h(u,{key:0,type:"danger",size:"small",link:"",onClick:l=>{return a=e.row.tableName,void ae.confirm("确定要重置配置吗？","提示",{type:"warning"}).then((()=>{ee.resetGenConfig(a).then((()=>{k.success("重置成功"),Ke()}))}));var a}},{icon:s((()=>[r(Te)])),default:s((()=>[l[23]||(l[23]=c(" 重置配置 "))])),_:2},1032,["onClick"])):g("",!0)])),_:1})])),_:1},8,["data"])),[[_l,m(we)]]),m(je)>0?(p(),h(Me,{key:0,total:m(je),"onUpdate:total":l[1]||(l[1]=e=>b(je)?je.value=e:null),page:m(ye).pageNum,"onUpdate:page":l[2]||(l[2]=e=>m(ye).pageNum=e),limit:m(ye).pageSize,"onUpdate:limit":l[3]||(l[3]=e=>m(ye).pageSize=e),onPagination:Ke},null,8,["total","page","limit"])):g("",!0)])),_:1}),r(Vl,{modelValue:m(Se).visible,"onUpdate:modelValue":l[18]||(l[18]=e=>m(Se).visible=e),title:m(Se).title,size:"80%",onClose:l[19]||(l[19]=e=>m(Se).visible=!1)},{footer:s((()=>[0!==m(ze)?(p(),h(u,{key:0,type:"success",onClick:$e},{default:s((()=>[r(nl,null,{default:s((()=>[r(bl)])),_:1}),c(" "+y(m(Re)),1)])),_:1})):g("",!0),r(u,{type:"primary",onClick:Oe},{default:s((()=>[c(y(m(Le))+" ",1),2!==m(ze)?(p(),h(nl,{key:0},{default:s((()=>[r(yl)])),_:1})):(p(),h(nl,{key:1},{default:s((()=>[r(wl)])),_:1}))])),_:1})])),default:s((()=>[r(al,{active:m(ze),"align-center":"","finish-status":"success",simple:""},{default:s((()=>[r(Ye,{title:"基础配置"}),r(Ye,{title:"字段配置"}),r(Ye,{title:"预览生成"})])),_:1},8,["active"]),i("div",ue,[v(r(P,{model:m(xe),"label-width":100,rules:Ee},{default:s((()=>[r(tl,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(o,{label:"表名",prop:"tableName"},{default:s((()=>[r(a,{modelValue:m(xe).tableName,"onUpdate:modelValue":l[4]||(l[4]=e=>m(xe).tableName=e),readonly:""},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(o,{label:"业务名",prop:"businessName"},{default:s((()=>[r(a,{modelValue:m(xe).businessName,"onUpdate:modelValue":l[5]||(l[5]=e=>m(xe).businessName=e),placeholder:"用户"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(tl,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(o,{label:"包名",prop:"packageName"},{default:s((()=>[r(a,{modelValue:m(xe).packageName,"onUpdate:modelValue":l[6]||(l[6]=e=>m(xe).packageName=e),placeholder:"com.youlai.boot"},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(o,{label:"模块名",prop:"moduleName"},{default:s((()=>[r(a,{modelValue:m(xe).moduleName,"onUpdate:modelValue":l[7]||(l[7]=e=>m(xe).moduleName=e),placeholder:"system"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(tl,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(o,{label:"实体名",prop:"entityName"},{default:s((()=>[r(a,{modelValue:m(xe).entityName,"onUpdate:modelValue":l[8]||(l[8]=e=>m(xe).entityName=e),placeholder:"User"},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(o,{label:"作者"},{default:s((()=>[r(a,{modelValue:m(xe).author,"onUpdate:modelValue":l[9]||(l[9]=e=>m(xe).author=e),placeholder:"youlai"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(tl,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(o,null,{label:s((()=>[i("div",ne,[l[25]||(l[25]=i("span",null,"上级菜单",-1)),r(dl,{effect:"dark"},{content:s((()=>l[24]||(l[24]=[c(" 选择上级菜单，生成代码后会自动创建对应菜单。 "),i("br",null,null,-1),c(" 注意1：生成菜单后需分配权限给角色，否则菜单将无法显示。 "),i("br",null,null,-1),c(" 注意2：演示环境默认不生成菜单，如需生成，请在本地部署数据库。 ")]))),default:s((()=>[r(nl,{class:"cursor-pointer"},{default:s((()=>[r(ul)])),_:1})])),_:1})])])),default:s((()=>[r(il,{modelValue:m(xe).parentMenuId,"onUpdate:modelValue":l[10]||(l[10]=e=>m(xe).parentMenuId=e),placeholder:"选择上级菜单",data:m(Ce),"check-strictly":"","render-after-expand":!1,filterable:"",clearable:""},null,8,["modelValue","data"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),[[w,0==m(ze)]]),v(i("div",de,[v((p(),h(De,{"row-key":"id","element-loading-text":m(Ve),"highlight--currentrow":"",data:m(xe).fieldConfigs},{default:s((()=>[r(le,{width:"55",align:"center"},{default:s((()=>[r(nl,{class:"cursor-move sortable-handle"},{default:s((()=>[r(rl)])),_:1})])),_:1}),r(le,{label:"列名",width:"110"},{default:s((e=>[c(y(e.row.columnName),1)])),_:1}),r(le,{label:"列类型",width:"80"},{default:s((e=>[c(y(e.row.columnType),1)])),_:1}),r(le,{label:"字段名",width:"120"},{default:s((e=>[r(a,{modelValue:e.row.fieldName,"onUpdate:modelValue":l=>e.row.fieldName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{label:"字段类型",width:"80"},{default:s((e=>[c(y(e.row.fieldType),1)])),_:1}),r(le,{label:"字段注释","min-width":"100"},{default:s((e=>[r(a,{modelValue:e.row.fieldComment,"onUpdate:modelValue":l=>e.row.fieldComment=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{label:"最大长度",width:"80"},{default:s((e=>[r(a,{modelValue:e.row.maxLength,"onUpdate:modelValue":l=>e.row.maxLength=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{width:"70"},{header:s((()=>[i("div",ie,[l[26]||(l[26]=i("span",null,"查询",-1)),r(sl,{modelValue:m(Ge),"onUpdate:modelValue":l[11]||(l[11]=e=>b(Ge)?Ge.value=e:null),class:"ml-1",onChange:l[12]||(l[12]=e=>He("isShowInQuery",m(Ge)))},null,8,["modelValue"])])])),default:s((e=>[r(sl,{modelValue:e.row.isShowInQuery,"onUpdate:modelValue":l=>e.row.isShowInQuery=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{width:"70"},{header:s((()=>[i("div",re,[l[27]||(l[27]=i("span",null,"列表",-1)),r(sl,{modelValue:m(Ae),"onUpdate:modelValue":l[13]||(l[13]=e=>b(Ae)?Ae.value=e:null),class:"ml-1",onChange:l[14]||(l[14]=e=>He("isShowInList",m(Ae)))},null,8,["modelValue"])])])),default:s((e=>[r(sl,{modelValue:e.row.isShowInList,"onUpdate:modelValue":l=>e.row.isShowInList=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{width:"70"},{header:s((()=>[i("div",se,[l[28]||(l[28]=i("span",null,"表单",-1)),r(sl,{modelValue:m(Be),"onUpdate:modelValue":l[15]||(l[15]=e=>b(Be)?Be.value=e:null),class:"ml-1",onChange:l[16]||(l[16]=e=>He("isShowInForm",m(Be)))},null,8,["modelValue"])])])),default:s((e=>[r(sl,{modelValue:e.row.isShowInForm,"onUpdate:modelValue":l=>e.row.isShowInForm=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(le,{label:"必填",width:"70"},{default:s((e=>[1==e.row.isShowInForm?(p(),h(sl,{key:0,modelValue:e.row.isRequired,"onUpdate:modelValue":l=>e.row.isRequired=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])):(p(),d("span",me,"-"))])),_:1}),r(le,{label:"查询方式","min-width":"120"},{default:s((e=>[1===e.row.isShowInQuery?(p(),h(pl,{key:0,modelValue:e.row.queryType,"onUpdate:modelValue":l=>e.row.queryType=l,placeholder:"请选择"},{default:s((()=>[(p(!0),d(V,null,_(m(Ne),((e,l)=>(p(),h(ml,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),d("span",pe,"-"))])),_:1}),r(le,{label:"表单类型","min-width":"120"},{default:s((e=>[1===e.row.isShowInQuery||1===e.row.isShowInForm?(p(),h(pl,{key:0,modelValue:e.row.formType,"onUpdate:modelValue":l=>e.row.formType=l,placeholder:"请选择"},{default:s((()=>[(p(!0),d(V,null,_(m(ke),((e,l)=>(p(),h(ml,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),d("span",fe,"-"))])),_:1}),r(le,{label:"字典类型","min-width":"100"},{default:s((e=>[e.row.formType===m(A).SELECT.value?(p(),h(pl,{key:0,modelValue:e.row.dictType,"onUpdate:modelValue":l=>e.row.dictType=l,placeholder:"请选择",clearable:""},{default:s((()=>[(p(!0),d(V,null,_(m(Ue),(e=>(p(),h(ml,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),d("span",ce,"-"))])),_:1})])),_:1},8,["element-loading-text","data"])),[[_l,m(we)]])],512),[[w,1==m(ze)]]),v(r(tl,null,{default:s((()=>[r(ol,{span:6},{default:s((()=>[r(vl,{"max-height":"72vh"},{default:s((()=>[r(cl,{data:m(ge),"default-expand-all":"","highlight-current":"",onNodeClick:el},{default:s((({data:e})=>{return[r(fl,{"icon-class":(l=e.label,l.endsWith(".java")?"java":l.endsWith(".html")?"html":l.endsWith(".vue")?"vue":l.endsWith(".ts")?"typescript":l.endsWith(".xml")?"xml":"file")},null,8,["icon-class"]),i("span",ve,y(e.label),1)];var l})),_:1},8,["data"])])),_:1})])),_:1}),r(ol,{span:18},{default:s((()=>[r(vl,{"max-height":"72vh"},{default:s((()=>[i("div",he,[r(gl,{type:"primary",onClick:ll},{default:s((()=>[r(nl,null,{default:s((()=>[r(hl)])),_:1}),l[29]||(l[29]=c(" 一键复制 "))])),_:1})]),r(m(j),{ref_key:"cmRef",ref:Fe,value:m(qe),"onUpdate:value":l[17]||(l[17]=e=>b(qe)?qe.value=e:null),options:Qe,border:"",readonly:!0,height:"100%",width:"100%"},null,8,["value"])])),_:1})])),_:1})])),_:1},512),[[w,2==m(ze)]])])])),_:1},8,["modelValue","title"])])}}});export{ge as default};
