import{v as e,A as a,x as s,b2 as l,bu as t,_ as r,d as o,b as i,r as d,c as n,N as c,K as u,J as p,g as m,f,e as v,l as w,k as b,i as y,w as _,F as g,E as h,n as k,q as j,bv as P,W as V,o as E,aM as x,m as U,D as C,ah as F,bw as S,G as z,ai as q,h as R,$ as L,bx as I,aU as N}from"./index.-2dSJvT_.js";import{E as T}from"./el-dialog.Kkc-pGkQ.js";import{a as B,E as D}from"./el-tag.CL_KEoGm.js";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang.C26VMgpl.js";import{a as G,E as J}from"./el-col.Bkcyc5FA.js";import{E as K,a as M}from"./el-descriptions-item.DFoOR_b9.js";import{E as O}from"./el-card.BXatHMm7.js";import{E as $}from"./el-divider.DO3fz5LU.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DNWtI2fw.js";import"./use-dialog.DWCABKHh.js";import"./refs.Cw5r5QN8.js";import"./el-scrollbar.h6wvvJ8y.js";import"./el-checkbox.5kbAoqEu.js";import"./el-select.D5K2M6II.js";import"./index.6v8T4Dn9.js";import"./_baseIteratee.Jw5YRMh2.js";import"./index.od3oxRLs.js";const W=e({size:{type:[Number,String],values:t,default:"",validator:e=>l(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:s},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),Q={error:e=>e instanceof Event},X=o({name:"ElAvatar"});const Y=j(r(o({...X,props:W,emits:Q,setup(e,{emit:a}){const s=e,t=i("avatar"),r=d(!1),o=n(()=>{const{size:e,icon:a,shape:l}=s,r=[t.b()];return c(e)&&r.push(t.m(e)),a&&r.push(t.m("icon")),l&&r.push(t.m(l)),r}),j=n(()=>{const{size:e}=s;return l(e)?t.cssVarBlock({size:u(e)}):void 0}),P=n(()=>({objectFit:s.fit}));function V(e){r.value=!0,a("error",e)}return p(()=>s.src,()=>r.value=!1),(e,a)=>(f(),m("span",{class:k(y(o)),style:b(y(j))},[!e.src&&!e.srcSet||r.value?e.icon?(f(),v(y(h),{key:1},{default:_(()=>[(f(),v(g(e.icon)))]),_:1})):w(e.$slots,"default",{key:2}):(f(),m("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:b(y(P)),onError:V},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),Z={upload:e=>P({url:"/api/v1/files",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}}),uploadFile(e){const a=new FormData;return a.append("file",e),P({url:"/api/v1/files",method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})},delete:e=>P({url:"/api/v1/files",method:"delete",params:{filePath:e}}),download:(e,a)=>P({url:e,method:"get",responseType:"blob"}).then(e=>{const s=new Blob([e.data]),l=document.createElement("a"),t=window.URL.createObjectURL(s);l.href=t,l.download=a||"下载文件",l.click(),window.URL.revokeObjectURL(t)})},ee={class:"profile-container"},ae={class:"user-info"},se={class:"avatar-wrapper"},le={class:"user-name"},te={class:"nickname"},re={class:"user-role"},oe={class:"security-item"},ie={class:"dialog-footer"},de=H(o({__name:"index",setup(e){const a=d({}),s=V({visible:!1,title:"",type:""}),l=V({}),t=V({}),r={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},o=e=>{switch(s.type=e,s.visible=!0,e){case"account":s.title="账号资料",l.id=a.value.id,l.nickname=a.value.nickname,l.gender=a.value.gender;break;case"password":s.title="修改密码"}},i=async()=>{if("account"===s.type)I.updateProfile(l).then(()=>{N.success("账号资料修改成功"),s.visible=!1,p()});else if("password"===s.type){if(t.newPassword!==t.confirmPassword)return void N.error("两次输入的密码不一致");I.changePassword(t).then(()=>{N.success("密码修改成功"),s.visible=!1})}},n=d(null),c=()=>{var e;null==(e=n.value)||e.click()},u=async e=>{const s=e.target,l=s.files?s.files[0]:null;if(l)try{const e=await Z.uploadFile(l);a.value.avatar=e.url,await I.updateProfile({avatar:e.url})}catch(t){N.error("头像上传失败")}},p=async()=>{const e=await I.getProfile();a.value=e};return E(async()=>{await p()}),(e,d)=>{const p=Y,w=F,b=x("Edit"),g=h,k=$,j=O,P=G,V=x("Male"),E=x("Female"),I=M,N=K,H=J,W=L,Q=D,X=A,Z=B,de=T;return f(),m("div",ee,[U(H,{gutter:20},{default:_(()=>[U(P,{span:8},{default:_(()=>[U(j,{class:"user-card"},{default:_(()=>[C("div",ae,[C("div",se,[U(p,{src:y(a).avatar,size:100},null,8,["src"]),U(w,{type:"info",class:"avatar-edit-btn",circle:"",icon:y(S),size:"small",onClick:c},null,8,["icon"]),C("input",{ref_key:"fileInput",ref:n,type:"file",style:{display:"none"},onChange:u},null,544)]),C("div",le,[C("span",te,z(y(a).nickname),1),U(g,{class:"edit-icon",onClick:d[0]||(d[0]=e=>o("account"))},{default:_(()=>[U(b)]),_:1})]),C("div",re,z(y(a).roleNames),1)]),U(k),d[9]||(d[9]=C("div",{class:"user-stats"},[C("div",{class:"stat-item"},[C("div",{class:"stat-value"},"0"),C("div",{class:"stat-label"},"待办")]),C("div",{class:"stat-item"},[C("div",{class:"stat-value"},"0"),C("div",{class:"stat-label"},"消息")]),C("div",{class:"stat-item"},[C("div",{class:"stat-value"},"0"),C("div",{class:"stat-label"},"通知")])],-1))]),_:1})]),_:1}),U(P,{span:16},{default:_(()=>[U(j,{class:"info-card"},{header:_(()=>[...d[10]||(d[10]=[C("div",{class:"card-header"},[C("span",null,"账号信息")],-1)])]),default:_(()=>[U(N,{column:1,border:""},{default:_(()=>[U(I,{label:"用户名"},{default:_(()=>[q(z(y(a).username)+" ",1),1===y(a).gender?(f(),v(g,{key:0,class:"gender-icon male"},{default:_(()=>[U(V)]),_:1})):(f(),v(g,{key:1,class:"gender-icon female"},{default:_(()=>[U(E)]),_:1}))]),_:1}),U(I,{label:"手机号码"},{default:_(()=>[q(z(y(a).mobile||"未绑定"),1)]),_:1}),U(I,{label:"邮箱"},{default:_(()=>[q(z(y(a).email||"未绑定"),1)]),_:1}),U(I,{label:"部门"},{default:_(()=>[q(z(y(a).deptName),1)]),_:1}),U(I,{label:"创建时间"},{default:_(()=>[q(z(y(a).createTime),1)]),_:1})]),_:1})]),_:1}),U(j,{class:"security-card"},{header:_(()=>[...d[11]||(d[11]=[C("div",{class:"card-header"},[C("span",null,"安全设置")],-1)])]),default:_(()=>[C("div",oe,[d[13]||(d[13]=C("div",{class:"security-info"},[C("div",{class:"security-title"},"账户密码"),C("div",{class:"security-desc"},"定期修改密码有助于保护账户安全")],-1)),U(w,{type:"primary",link:"",onClick:d[1]||(d[1]=()=>o("password"))},{default:_(()=>[...d[12]||(d[12]=[q(" 修改 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1}),U(de,{modelValue:y(s).visible,"onUpdate:modelValue":d[8]||(d[8]=e=>y(s).visible=e),title:y(s).title,width:500},{footer:_(()=>[C("span",ie,[U(w,{onClick:d[7]||(d[7]=e=>y(s).visible=!1)},{default:_(()=>[...d[14]||(d[14]=[q("取消",-1)])]),_:1}),U(w,{type:"primary",onClick:i},{default:_(()=>[...d[15]||(d[15]=[q("确定",-1)])]),_:1})])]),default:_(()=>["account"===y(s).type?(f(),v(Z,{key:0,ref:"userProfileFormRef",model:y(l),"label-width":100},{default:_(()=>[U(Q,{label:"昵称"},{default:_(()=>[U(W,{modelValue:y(l).nickname,"onUpdate:modelValue":d[2]||(d[2]=e=>y(l).nickname=e)},null,8,["modelValue"])]),_:1}),U(Q,{label:"性别"},{default:_(()=>[U(X,{modelValue:y(l).gender,"onUpdate:modelValue":d[3]||(d[3]=e=>y(l).gender=e),code:"gender"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):R("",!0),"password"===y(s).type?(f(),v(Z,{key:1,ref:"passwordChangeFormRef",model:y(t),rules:r,"label-width":100},{default:_(()=>[U(Q,{label:"原密码",prop:"oldPassword"},{default:_(()=>[U(W,{modelValue:y(t).oldPassword,"onUpdate:modelValue":d[4]||(d[4]=e=>y(t).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),U(Q,{label:"新密码",prop:"newPassword"},{default:_(()=>[U(W,{modelValue:y(t).newPassword,"onUpdate:modelValue":d[5]||(d[5]=e=>y(t).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),U(Q,{label:"确认密码",prop:"confirmPassword"},{default:_(()=>[U(W,{modelValue:y(t).confirmPassword,"onUpdate:modelValue":d[6]||(d[6]=e=>y(t).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):R("",!0)]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-71f9d6ae"]]);export{de as default};
