import{o as e,H as t,a5 as n,K as o,r as s,_ as a,d as r,y as u,I as c,g as d,N as i,k as l,U as f,M as v,t as p,z as m,e as E,f as y,bU as w,q as L}from"./index.CFVY3HBy.js";function b(e){return void 0===e}let h=[];const T=e=>{const t=e;t.key===o.esc&&h.forEach((e=>e(t)))},k="focus-trap.focus-after-trapped",g="focus-trap.focus-after-released",F={cancelable:!0,bubbles:!1},R={cancelable:!0,bubbles:!1},K="focusAfterTrapped",N="focusAfterReleased",S=Symbol("elFocusTrap"),_=s(),P=s(0),I=s(0);let C=0;const x=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},A=(e,t)=>{for(const n of e)if(!O(n,t))return n},O=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},j=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),I.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function q(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const U=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=q(e,t),e.unshift(t)},remove:t=>{var n,o;e=q(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),B=()=>{_.value="pointer",P.value=window.performance.now()},D=()=>{_.value="keyboard",P.value=window.performance.now()},H=e=>new CustomEvent("focus-trap.focusout-prevented",{...R,detail:e});var M=a(r({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[K,N,"focusin","focusout","focusout-prevented","release-requested"],setup(a,{emit:r}){const l=s();let p,m;const{focusReason:E}=(e((()=>{0===C&&(document.addEventListener("mousedown",B),document.addEventListener("touchstart",B),document.addEventListener("keydown",D)),C++})),n((()=>{C--,C<=0&&(document.removeEventListener("mousedown",B),document.removeEventListener("touchstart",B),document.removeEventListener("keydown",D))})),{focusReason:_,lastUserFocusTimestamp:P,lastAutomatedFocusTimestamp:I});var y;y=e=>{a.trapped&&!w.paused&&r("release-requested",e)},e((()=>{0===h.length&&document.addEventListener("keydown",T),t&&h.push(y)})),n((()=>{h=h.filter((e=>e!==y)),0===h.length&&t&&document.removeEventListener("keydown",T)}));const w={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},L=e=>{if(!a.loop&&!a.trapped)return;if(w.paused)return;const{key:t,altKey:n,ctrlKey:s,metaKey:u,currentTarget:c,shiftKey:d}=e,{loop:i}=a,l=t===o.tab&&!n&&!s&&!u,f=document.activeElement;if(l&&f){const t=c,[n,o]=(e=>{const t=x(e);return[A(t,e),A(t.reverse(),e)]})(t);if(n&&o)if(d||f!==o){if(d&&[n,t].includes(f)){const t=H({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&j(o,!0))}}else{const t=H({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||(e.preventDefault(),i&&j(n,!0))}else if(f===t){const t=H({focusReason:E.value});r("focusout-prevented",t),t.defaultPrevented||e.preventDefault()}}};u(S,{focusTrapRef:l,onKeydown:L}),c((()=>a.focusTrapEl),(e=>{e&&(l.value=e)}),{immediate:!0}),c([l],(([e],[t])=>{e&&(e.addEventListener("keydown",L),e.addEventListener("focusin",O),e.addEventListener("focusout",q)),t&&(t.removeEventListener("keydown",L),t.removeEventListener("focusin",O),t.removeEventListener("focusout",q))}));const b=e=>{r(K,e)},R=e=>r(N,e),O=e=>{const t=d(l);if(!t)return;const n=e.target,o=e.relatedTarget,s=n&&t.contains(n);if(!a.trapped){o&&t.contains(o)||(p=o)}s&&r("focusin",e),w.paused||a.trapped&&(s?m=n:j(m,!0))},q=e=>{const t=d(l);if(!w.paused&&t)if(a.trapped){const n=e.relatedTarget;i(n)||t.contains(n)||setTimeout((()=>{if(!w.paused&&a.trapped){const e=H({focusReason:E.value});r("focusout-prevented",e),e.defaultPrevented||j(m,!0)}}),0)}else{const n=e.target;n&&t.contains(n)||r("focusout",e)}};async function M(){await f();const e=d(l);if(e){U.push(w);const t=e.contains(document.activeElement)?p:document.activeElement;p=t;if(!e.contains(t)){const n=new Event(k,F);e.addEventListener(k,b),e.dispatchEvent(n),n.defaultPrevented||f((()=>{let n=a.focusStartEl;v(n)||(j(n),document.activeElement!==n&&(n="first")),"first"===n&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(j(o,t),document.activeElement!==n)return})(x(e),!0),document.activeElement!==t&&"container"!==n||j(e)}))}}}function $(){const e=d(l);if(e){e.removeEventListener(k,b);const t=new CustomEvent(g,{...F,detail:{focusReason:E.value}});e.addEventListener(g,R),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=E.value&&P.value>I.value&&!e.contains(document.activeElement)||j(null!=p?p:document.body),e.removeEventListener(g,R),U.remove(w)}}return e((()=>{a.trapped&&M(),c((()=>a.trapped),(e=>{e?M():$()}))})),n((()=>{a.trapped&&$(),l.value&&(l.value.removeEventListener("keydown",L),l.value.removeEventListener("focusin",O),l.value.removeEventListener("focusout",q),l.value=void 0)})),{onKeydown:L}}}),[["render",function(e,t,n,o,s,a){return l(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const $=L(a(r({__name:"teleport",props:p({to:{type:m([String,Object]),required:!0},disabled:Boolean}),setup:e=>(e,t)=>e.disabled?l(e.$slots,"default",{key:0}):(E(),y(w,{key:1,to:e.to},[l(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{$ as E,S as F,M as a,b as i};
