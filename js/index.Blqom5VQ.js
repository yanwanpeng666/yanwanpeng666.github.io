import{d as e,r as l,S as t,o as a,a$ as i,e as o,h as s,B as r,l as n,w as u,g as p,W as d,X as m,V as c,f,p as _,D as y,aj as g,Q as v,R as b,aR as h,ax as j}from"./index.B3dxSiD7.js";import{v as w}from"./el-loading.B7o4b0lc.js";import{N as k,_ as V}from"./NoticeDetail.vue_vue_type_script_setup_true_lang.DPPBHdeB.js";import{E as x}from"./el-dialog.D6oMW22v.js";import"./el-overlay.C8JEKWt4.js";import{b as U,a as C}from"./el-radio-group.C7yK1p5a.js";/* empty css                 */import{_ as S}from"./index.vue_vue_type_script_setup_true_lang.CVDPQ1vL.js";import{_ as T}from"./style.css_vue_type_style_index_0_src_true_lang.5oUn1Bnf.js";import{E}from"./el-card.CESB3HCC.js";import{_ as N}from"./index.DWRjDNhJ.js";import{E as z,a as R}from"./el-table-column.DrPY5oBD.js";import"./el-checkbox.CHJINpiO.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.Do7wgyRT.js";import"./el-scrollbar.77hz2kPP.js";/* empty css               */import{_ as D}from"./DictLabel.vue_vue_type_script_setup_true_lang.Dt_-ADZ9.js";import{E as q,a as B}from"./el-form-item.CAdE3Br-.js";import{E as F}from"./el-button.DtCLgtx8.js";import{E as I,a as A}from"./el-select.D0-Fx5U4.js";import{E as O}from"./el-input.HjNHTvfR.js";import{E as P}from"./el-message-box.DBQScDQE.js";import{E as K}from"./index.CKvbCwjw.js";import"./el-descriptions-item.CYhSB-LB.js";import"./vnode.BPkFYv-a.js";import"./use-form-item.BphSJRP2.js";import"./index.ChqT_9Y2.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DxuMq_07.js";import"./refs.c6zq2KY3.js";import"./index.DSIYe2ZF.js";import"./scroll.CTku4j33.js";import"./index.Se5GGPah.js";import"./index.CNa-T-jy.js";import"./el-pagination.BWXtogyP.js";import"./isEqual.y_mDcI5o.js";import"./_Uint8Array.DubAtVHC.js";import"./_baseIteratee.3_u90P8w.js";import"./debounce.Cf0GYq-g.js";import"./index.pDjbOgVL.js";import"./castArray.g1trCJYT.js";import"./token.DWNpOE8r.js";import"./strings.fgEZ-t-O.js";import"./index.iG2iE8kL.js";import"./index.CNXW-bhB.js";import"./validator.WjsimOf7.js";const L={class:"app-container"},Q={class:"search-bar"},W={class:"flex-x-start"},X={key:0,class:"flex-x-start"},$={key:1,class:"flex-x-start"},M={class:"dialog-footer"},Z=e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const Z=l(q),G=l(q),H=l(),J=l(!1),Y=l([]),ee=l(0),le=t({pageNum:1,pageSize:10}),te=l([]),ae=l([]),ie=t({title:"",visible:!1}),oe=t({level:"L",targetType:1}),se=t({title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur",validator:(e,l,t)=>{l.replace(/<[^>]+>/g,"").trim()?t():t(new Error("请输入通知内容"))}}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}]});function re(){J.value=!0,k.getPage(le).then((e=>{ae.value=e.list,ee.value=e.total})).finally((()=>{J.value=!1}))}function ne(){Z.value.resetFields(),le.pageNum=1,re()}function ue(e){Y.value=e.map((e=>e.id))}function pe(e){h.getOptions().then((e=>{te.value=e})),ie.visible=!0,e?(ie.title="修改公告",k.getFormData(e).then((e=>{Object.assign(oe,e)}))):(Object.assign(oe,{level:0,targetType:0}),ie.title="新增公告")}function de(){ie.visible=!1,G.value.resetFields(),G.value.clearValidate(),oe.id=void 0,oe.targetType=1}function me(e){const l=[e||Y.value].join(",");l?P.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{J.value=!0,k.deleteByIds(l).then((()=>{j.success("删除成功"),ne()})).finally((()=>J.value=!1))}),(()=>{j.info("已取消删除")})):j.warning("请勾选删除项")}return a((()=>{re()})),(e,l)=>{const t=O,a=B,h=I,P=A,ce=F,fe=q,_e=z,ye=D,ge=K,ve=R,be=N,he=E,je=T,we=S,ke=U,Ve=C,xe=x,Ue=V,Ce=i("hasPerm"),Se=w;return o(),s("div",L,[r("div",Q,[n(fe,{ref_key:"queryFormRef",ref:Z,model:p(le),inline:!0,"label-suffix":":"},{default:u((()=>[n(a,{label:"标题",prop:"title"},{default:u((()=>[n(t,{modelValue:p(le).title,"onUpdate:modelValue":l[0]||(l[0]=e=>p(le).title=e),placeholder:"标题",clearable:"",onKeyup:l[1]||(l[1]=d((e=>re()),["enter"]))},null,8,["modelValue"])])),_:1}),n(a,{label:"发布状态",prop:"publishStatus"},{default:u((()=>[n(P,{modelValue:p(le).publishStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>p(le).publishStatus=e),class:"!w-[100px]",clearable:"",placeholder:"全部"},{default:u((()=>[n(h,{value:0,label:"未发布"}),n(h,{value:1,label:"已发布"}),n(h,{value:-1,label:"已撤回"})])),_:1},8,["modelValue"])])),_:1}),n(a,null,{default:u((()=>[n(ce,{type:"primary",icon:"search",onClick:l[3]||(l[3]=e=>re())},{default:u((()=>l[20]||(l[20]=[m("搜索")]))),_:1}),n(ce,{icon:"refresh",onClick:l[4]||(l[4]=e=>ne())},{default:u((()=>l[21]||(l[21]=[m("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),n(he,{shadow:"never",class:"table-wrapper"},{header:u((()=>[c((o(),f(ce,{type:"success",icon:"plus",onClick:l[5]||(l[5]=e=>pe())},{default:u((()=>l[22]||(l[22]=[m(" 新增通知 ")]))),_:1})),[[Ce,["sys:notice:add"]]]),c((o(),f(ce,{type:"danger",disabled:0===p(Y).length,icon:"delete",onClick:l[6]||(l[6]=e=>me())},{default:u((()=>l[23]||(l[23]=[m(" 删除 ")]))),_:1},8,["disabled"])),[[Ce,["sys:notice:delete"]]])])),default:u((()=>[c((o(),f(ve,{ref:"dataTableRef",data:p(ae),"highlight-current-row":"",onSelectionChange:ue},{default:u((()=>[n(_e,{type:"selection",width:"55",align:"center"}),n(_e,{type:"index",label:"序号",width:"60"}),n(_e,{label:"通知标题",prop:"title","min-width":"200"}),n(_e,{align:"center",label:"通知类型",width:"150"},{default:u((e=>[n(ye,{modelValue:e.row.type,"onUpdate:modelValue":l=>e.row.type=l,code:"notice_type"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),n(_e,{align:"center",label:"发布人",prop:"publisherName",width:"150"}),n(_e,{align:"center",label:"通知等级",width:"100"},{default:u((e=>[n(ye,{modelValue:e.row.level,"onUpdate:modelValue":l=>e.row.level=l,code:"notice_level"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),n(_e,{align:"center",label:"通告目标类型",prop:"targetType","min-width":"100"},{default:u((e=>[1==e.row.targetType?(o(),f(ge,{key:0,type:"warning"},{default:u((()=>l[24]||(l[24]=[m("全体")]))),_:1})):_("",!0),2==e.row.targetType?(o(),f(ge,{key:1,type:"success"},{default:u((()=>l[25]||(l[25]=[m("指定")]))),_:1})):_("",!0)])),_:1}),n(_e,{align:"center",label:"发布状态","min-width":"100"},{default:u((e=>[0==e.row.publishStatus?(o(),f(ge,{key:0,type:"info"},{default:u((()=>l[26]||(l[26]=[m("未发布")]))),_:1})):_("",!0),1==e.row.publishStatus?(o(),f(ge,{key:1,type:"success"},{default:u((()=>l[27]||(l[27]=[m("已发布")]))),_:1})):_("",!0),-1==e.row.publishStatus?(o(),f(ge,{key:2,type:"warning"},{default:u((()=>l[28]||(l[28]=[m("已撤回")]))),_:1})):_("",!0)])),_:1}),n(_e,{label:"操作时间",width:"250"},{default:u((e=>[r("div",W,[l[29]||(l[29]=r("span",null,"创建时间：",-1)),r("span",null,y(e.row.createTime||"-"),1)]),1===e.row.publishStatus?(o(),s("div",X,[l[30]||(l[30]=r("span",null,"发布时间：",-1)),r("span",null,y(e.row.publishTime||"-"),1)])):-1===e.row.publishStatus?(o(),s("div",$,[l[31]||(l[31]=r("span",null,"撤回时间：",-1)),r("span",null,y(e.row.revokeTime||"-"),1)])):_("",!0)])),_:1}),n(_e,{align:"center",fixed:"right",label:"操作",width:"150"},{default:u((e=>[n(ce,{type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void H.value.openNotice(t);var t}},{default:u((()=>l[32]||(l[32]=[m(" 查看 ")]))),_:2},1032,["onClick"]),1!=e.row.publishStatus?c((o(),f(ce,{key:0,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void k.publish(t).then((()=>{j.success("发布成功"),re()}));var t}},{default:u((()=>l[33]||(l[33]=[m(" 发布 ")]))),_:2},1032,["onClick"])),[[Ce,["sys:notice:publish"]]]):_("",!0),1==e.row.publishStatus?c((o(),f(ce,{key:1,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void k.revoke(t).then((()=>{j.success("撤回成功"),re()}));var t}},{default:u((()=>l[34]||(l[34]=[m(" 撤回 ")]))),_:2},1032,["onClick"])),[[Ce,["sys:notice:revoke"]]]):_("",!0),1!=e.row.publishStatus?c((o(),f(ce,{key:2,type:"primary",size:"small",link:"",onClick:l=>pe(e.row.id)},{default:u((()=>l[35]||(l[35]=[m(" 编辑 ")]))),_:2},1032,["onClick"])),[[Ce,["sys:notice:edit"]]]):_("",!0),1!=e.row.publishStatus?c((o(),f(ce,{key:3,type:"danger",size:"small",link:"",onClick:l=>me(e.row.id)},{default:u((()=>l[36]||(l[36]=[m(" 删除 ")]))),_:2},1032,["onClick"])),[[Ce,["sys:notice:delete"]]]):_("",!0)])),_:1})])),_:1},8,["data"])),[[Se,p(J)]]),p(ee)>0?(o(),f(be,{key:0,total:p(ee),"onUpdate:total":l[7]||(l[7]=e=>g(ee)?ee.value=e:null),page:p(le).pageNum,"onUpdate:page":l[8]||(l[8]=e=>p(le).pageNum=e),limit:p(le).pageSize,"onUpdate:limit":l[9]||(l[9]=e=>p(le).pageSize=e),onPagination:l[10]||(l[10]=e=>re())},null,8,["total","page","limit"])):_("",!0)])),_:1}),n(xe,{modelValue:p(ie).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>p(ie).visible=e),title:p(ie).title,top:"4vh",width:"1250",onClose:de},{footer:u((()=>[r("div",M,[n(ce,{type:"primary",onClick:l[17]||(l[17]=e=>{G.value.validate((e=>{if(e){J.value=!0;const e=oe.id;e?k.update(e,oe).then((()=>{j.success("修改成功"),de(),ne()})).finally((()=>J.value=!1)):k.add(oe).then((()=>{j.success("新增成功"),de(),ne()})).finally((()=>J.value=!1))}}))})},{default:u((()=>l[39]||(l[39]=[m("确定")]))),_:1}),n(ce,{onClick:l[18]||(l[18]=e=>de())},{default:u((()=>l[40]||(l[40]=[m("取消")]))),_:1})])])),default:u((()=>[n(fe,{ref_key:"dataFormRef",ref:G,model:p(oe),rules:p(se),"label-width":"100px"},{default:u((()=>[n(a,{label:"通知标题",prop:"title"},{default:u((()=>[n(t,{modelValue:p(oe).title,"onUpdate:modelValue":l[11]||(l[11]=e=>p(oe).title=e),placeholder:"通知标题",clearable:""},null,8,["modelValue"])])),_:1}),n(a,{label:"通知内容",prop:"content"},{default:u((()=>[n(je,{modelValue:p(oe).content,"onUpdate:modelValue":l[12]||(l[12]=e=>p(oe).content=e),style:{"min-height":"480px","max-height":"500px"}},null,8,["modelValue"])])),_:1}),n(a,{label:"通知类型",prop:"type"},{default:u((()=>[n(we,{modelValue:p(oe).type,"onUpdate:modelValue":l[13]||(l[13]=e=>p(oe).type=e),code:"notice_type"},null,8,["modelValue"])])),_:1}),n(a,{label:"通知等级",prop:"level"},{default:u((()=>[n(we,{modelValue:p(oe).level,"onUpdate:modelValue":l[14]||(l[14]=e=>p(oe).level=e),code:"notice_level"},null,8,["modelValue"])])),_:1}),n(a,{label:"目标类型",prop:"targetType"},{default:u((()=>[n(Ve,{modelValue:p(oe).targetType,"onUpdate:modelValue":l[15]||(l[15]=e=>p(oe).targetType=e)},{default:u((()=>[n(ke,{value:1},{default:u((()=>l[37]||(l[37]=[m("全体")]))),_:1}),n(ke,{value:2},{default:u((()=>l[38]||(l[38]=[m("指定")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),2==p(oe).targetType?(o(),f(a,{key:0,label:"指定用户",prop:"targetUserIds"},{default:u((()=>[n(P,{modelValue:p(oe).targetUserIds,"onUpdate:modelValue":l[16]||(l[16]=e=>p(oe).targetUserIds=e),multiple:"",search:"",placeholder:"请选择指定用户"},{default:u((()=>[(o(!0),s(v,null,b(p(te),(e=>(o(),f(h,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):_("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),n(Ue,{ref_key:"noticeDetailRef",ref:H},null,512)])}}});export{Z as default};
