import{d as e,r as a,R as l,o as t,cw as s,a as r,c as o,k as i,W as d,w as n,f as u,V as p,$ as m,T as c,l as f,aa as h,ax as y,aG as _,Y as b,Z as v}from"./index.BM8HYK7W.js";import{_ as j,a as g,E as k,b as w,c as V,d as C,e as x,v as E}from"./refresh.BU4WPd7d.js";import{E as I}from"./el-dialog.DOb72mWz.js";import{E as U}from"./el-input-number.B1aZbN5D.js";import{E as q}from"./el-tag.C9HAq4hI.js";import{E as F,a as R}from"./el-select.BXFPsYVq.js";import"./el-scrollbar.mIbHh7R4.js";import"./el-popper.DARfmJxr.js";import"./el-tree.BOV7JSyl.js";import{_ as T}from"./search.D9QYmBQ9.js";import{E as z}from"./el-tree-select.ZUgt5Nqn.js";import{E as A}from"./el-card.JvKkyGLr.js";import"./el-tooltip.l0sNRNKZ.js";import{_ as B}from"./plus.CKS9jjhi.js";import{E as O,a as P}from"./el-form-item.MoRrApRf.js";import{l as S,g as $,u as D,a as G,d as H,b as J}from"./index.DAPmwIyK.js";import"./_Uint8Array.Bk6YvMkU.js";import"./debounce.BCOJmmYb.js";import"./index.DDcUXN2j.js";import"./hasIn.BAQCL1fl.js";import"./use-dialog.IGiCrkwp.js";import"./isUndefined.DgmxjSXK.js";import"./refs.BIGcnKJG.js";import"./strings.Dq2gSJJ_.js";import"./isEqual.CKhcz8jC.js";import"./index.Bj4YjYf5.js";import"./castArray.CjaThbuf.js";const K={class:"app-container"},L={class:"search-container"},N={class:"dialog-footer"},Q=e({name:"Dept",inheritAttrs:!1,__name:"index",setup(e){const Q=a(O),W=a(O),Y=a(!1),Z=a([]),M=l({title:"",visible:!1}),X=l({}),ee=a(),ae=a(),le=l({status:1,parentId:0,sort:1}),te=l({parentId:[{required:!0,message:"上级部门不能为空",trigger:"blur"}],name:[{required:!0,message:"部门名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}]});function se(){Y.value=!0,S(X).then((({data:e})=>{ee.value=e,Y.value=!1}))}function re(){Q.value.resetFields(),se()}function oe(e){Z.value=e.map((e=>e.id))}async function ie(e,a){await async function(){J().then((e=>{ae.value=[{value:0,label:"顶级部门",children:e.data}]}))}(),M.visible=!0,a?(M.title="修改部门",$(a).then((({data:e})=>{Object.assign(le,e)}))):(M.title="新增部门",le.parentId=e??0)}function de(){W.value.validate((e=>{if(e){const e=le.id;Y.value=!0,e?D(e,le).then((()=>{y.success("修改成功"),ue(),se()})).finally((()=>Y.value=!1)):G(le).then((()=>{y.success("新增成功"),ue(),se()})).finally((()=>Y.value=!1))}}))}function ne(e){const a=[e||Z.value].join(",");a?_.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{H(a).then((()=>{y.success("删除成功"),re()}))})):y.warning("请勾选删除项")}function ue(){M.visible=!1,W.value.resetFields(),W.value.clearValidate(),le.id=void 0,le.parentId=0,le.status=1,le.sort=1}return t((()=>{se()})),(e,a)=>{const l=b,t=P,y=F,_=R,S=T,$=v,D=j,G=O,H=B,J=g,pe=k,me=q,ce=w,fe=V,he=A,ye=z,_e=U,be=C,ve=x,je=I,ge=s("hasPerm"),ke=E;return r(),o("div",K,[i("div",L,[d(G,{ref_key:"queryFormRef",ref:Q,model:u(X),inline:!0},{default:n((()=>[d(t,{label:"关键字",prop:"keywords"},{default:n((()=>[d(l,{modelValue:u(X).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>u(X).keywords=e),placeholder:"部门名称",onKeyup:p(se,["enter"])},null,8,["modelValue"])])),_:1}),d(t,{label:"部门状态",prop:"status"},{default:n((()=>[d(_,{modelValue:u(X).status,"onUpdate:modelValue":a[1]||(a[1]=e=>u(X).status=e),placeholder:"全部",clearable:"",class:"!w-[100px]"},{default:n((()=>[d(y,{value:1,label:"正常"}),d(y,{value:0,label:"禁用"})])),_:1},8,["modelValue"])])),_:1}),d(t,null,{default:n((()=>[d($,{class:"filter-item",type:"primary",onClick:se},{default:n((()=>[d(S),m(" 搜索 ")])),_:1}),d($,{onClick:re},{default:n((()=>[d(D),m("重置 ")])),_:1})])),_:1})])),_:1},8,["model"])]),d(he,{shadow:"never",class:"table-container"},{header:n((()=>[c((r(),f($,{type:"success",onClick:a[2]||(a[2]=e=>ie(0,void 0))},{default:n((()=>[d(H),m("新增")])),_:1})),[[ge,["sys:dept:add"]]]),c((r(),f($,{type:"danger",disabled:0===u(Z).length,onClick:a[3]||(a[3]=e=>ne())},{default:n((()=>[d(J),m("删除 ")])),_:1},8,["disabled"])),[[ge,["sys:dept:delete"]]])])),default:n((()=>[c((r(),f(fe,{data:u(ee),"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:oe},{default:n((()=>[d(pe,{type:"selection",width:"55",align:"center"}),d(pe,{prop:"name",label:"部门名称","min-width":"200"}),d(pe,{prop:"status",label:"状态",width:"100"},{default:n((e=>[1==e.row.status?(r(),f(me,{key:0,type:"success"},{default:n((()=>[m("正常")])),_:1})):(r(),f(me,{key:1,type:"info"},{default:n((()=>[m("禁用")])),_:1}))])),_:1}),d(pe,{prop:"sort",label:"排序",width:"100"}),d(pe,{label:"操作",fixed:"right",align:"left",width:"200"},{default:n((e=>[c((r(),f($,{type:"primary",link:"",size:"small",onClick:h((a=>ie(e.row.id,void 0)),["stop"])},{default:n((()=>[d(H),m("新增 ")])),_:2},1032,["onClick"])),[[ge,["sys:dept:add"]]]),c((r(),f($,{type:"primary",link:"",size:"small",onClick:h((a=>ie(e.row.parentId,e.row.id)),["stop"])},{default:n((()=>[d(ce),m("编辑 ")])),_:2},1032,["onClick"])),[[ge,["sys:dept:edit"]]]),c((r(),f($,{type:"primary",link:"",size:"small",onClick:h((a=>ne(e.row.id)),["stop"])},{default:n((()=>[d(J),m("删除 ")])),_:2},1032,["onClick"])),[[ge,["sys:dept:delete"]]])])),_:1})])),_:1},8,["data"])),[[ke,u(Y)]])])),_:1}),d(je,{modelValue:u(M).visible,"onUpdate:modelValue":a[8]||(a[8]=e=>u(M).visible=e),title:u(M).title,width:"600px",onClosed:ue},{footer:n((()=>[i("div",N,[d($,{type:"primary",onClick:de},{default:n((()=>[m(" 确 定 ")])),_:1}),d($,{onClick:ue},{default:n((()=>[m(" 取 消 ")])),_:1})])])),default:n((()=>[d(G,{ref_key:"deptFormRef",ref:W,model:u(le),rules:u(te),"label-width":"80px"},{default:n((()=>[d(t,{label:"上级部门",prop:"parentId"},{default:n((()=>[d(ye,{modelValue:u(le).parentId,"onUpdate:modelValue":a[4]||(a[4]=e=>u(le).parentId=e),placeholder:"选择上级部门",data:u(ae),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),d(t,{label:"部门名称",prop:"name"},{default:n((()=>[d(l,{modelValue:u(le).name,"onUpdate:modelValue":a[5]||(a[5]=e=>u(le).name=e),placeholder:"请输入部门名称"},null,8,["modelValue"])])),_:1}),d(t,{label:"显示排序",prop:"sort"},{default:n((()=>[d(_e,{modelValue:u(le).sort,"onUpdate:modelValue":a[6]||(a[6]=e=>u(le).sort=e),"controls-position":"right",style:{width:"100px"},min:0},null,8,["modelValue"])])),_:1}),d(t,{label:"部门状态"},{default:n((()=>[d(ve,{modelValue:u(le).status,"onUpdate:modelValue":a[7]||(a[7]=e=>u(le).status=e)},{default:n((()=>[d(be,{label:1},{default:n((()=>[m("正常")])),_:1}),d(be,{label:0},{default:n((()=>[m("禁用")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{Q as default};
