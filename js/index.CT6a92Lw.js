import{d as e,aC as a,r as l,W as t,c as o,aI as s,J as i,o as r,aK as n,g as u,f as d,D as c,m,w as p,$ as f,ag as v,i as b,ah as g,ai as _,ac as h,e as y,h as k,b7 as j,aT as V,aS as w,G as x,E as C,aZ as E,bL as S}from"./index.Dv9sjPYC.js";import{v as U}from"./loading.S8LTmobk.js";import{E as z}from"./drawer.BVgiL_Wv.js";import{E as N}from"./tree.Dcl2NF7B.js";import{E as R}from"./checkbox.Cq-dvxYE.js";import"./text.PvK_Xx8y.js";/* empty css                */import{E as q}from"./popper.m2lNosSJ.js";import{E as F}from"./input-number.sGCeKMc8.js";import{E as T,a as I}from"./radio-group.DKuTe-fa.js";import{E as O,a as B}from"./select.D46WCvpG.js";import"./scrollbar.DQblMs23.js";import{E as D}from"./card.UCV2TBx1.js";import{_ as K}from"./index.D-M2h4YD.js";import{a as M,E as P}from"./table-column.D28nzGFS.js";import{E as A,a as Q}from"./form-item.DgRMSZzs.js";import{R as Z}from"./role-api.CuRBb4fH.js";/* empty css                    */import{E as $}from"./index.BqKoy5Fw.js";import"./index.C5bLMH_j.js";import"./omit.B6E_lyF8.js";import"./_baseClone.Br4BWTY9.js";import"./index.BlULC2eY.js";import"./strings.BtizHOxT.js";import"./toNumber.P9ps2NTq.js";import"./castArray.D1K_WIrw.js";import"./_baseIteratee.DbpbFJtj.js";import"./index.8lkWLndA.js";import"./pagination.CWkEuBr5.js";import"./debounce.CITkvERZ.js";import"./raf.B6j8aosc.js";const G={class:"app-container"},J={class:"search-container"},L={class:"data-table__toolbar"},W={class:"data-table__toolbar--actions"},H={class:"dialog-footer"},X={class:"flex-x-between"},Y={class:"flex-center ml-5"},ee={class:"dialog-footer"},ae=e({name:"Role",inheritAttrs:!1,__name:"index",setup(e){const ae=a(),le=l(),te=l(),oe=l(),se=l(!1),ie=l([]),re=l(0),ne=t({pageNum:1,pageSize:10}),ue=l(),de=l([]),ce=t({title:"",visible:!1}),me=o(()=>ae.device===s.DESKTOP?"600px":"90%"),pe=t({sort:1,status:1}),fe=t({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),ve=l({}),be=l(!1),ge=l(""),_e=l(!0),he=l(!0);function ye(){se.value=!0,Z.getPage(ne).then(e=>{ue.value=e.list,re.value=e.total}).finally(()=>{se.value=!1})}function ke(){ne.pageNum=1,ye()}function je(){le.value.resetFields(),ne.pageNum=1,ye()}function Ve(e){ie.value=e.map(e=>e.id)}function we(e){ce.visible=!0,e?(ce.title="修改角色",Z.getFormData(e).then(e=>{Object.assign(pe,e)})):ce.title="新增角色"}function xe(){te.value.validate(e=>{if(e){se.value=!0;const e=pe.id;e?Z.update(e,pe).then(()=>{E.success("修改成功"),Ce(),je()}).finally(()=>se.value=!1):Z.create(pe).then(()=>{E.success("新增成功"),Ce(),je()}).finally(()=>se.value=!1)}})}function Ce(){ce.visible=!1,te.value.resetFields(),te.value.clearValidate(),pe.id=void 0,pe.sort=1,pe.status=1}function Ee(e){const a=[e||ie.value].join(",");a?$.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{se.value=!0,Z.deleteByIds(a).then(()=>{E.success("删除成功"),je()}).finally(()=>se.value=!1)},()=>{E.info("已取消删除")}):E.warning("请勾选删除项")}function Se(){const e=ve.value.id;if(e){const a=oe.value.getCheckedNodes(!1,!0).map(e=>e.value);se.value=!0,Z.updateRoleMenus(e,a).then(()=>{E.success("分配权限成功"),be.value=!1,je()}).finally(()=>{se.value=!1})}}function Ue(){_e.value=!_e.value,oe.value&&Object.values(oe.value.store.nodesMap).forEach(e=>{_e.value?e.expand():e.collapse()})}function ze(e,a){return!e||a.label.includes(e)}function Ne(e){he.value=e}return i(ge,e=>{oe.value.filter(e)}),r(()=>{ke()}),(e,a)=>{const l=f,t=A,o=g,s=Q,i=P,r=j,E=M,$=K,ae=D,Re=B,qe=O,Fe=I,Te=T,Ie=F,Oe=w,Be=n("Search"),De=n("Switch"),Ke=R,Me=n("QuestionFilled"),Pe=C,Ae=q,Qe=N,Ze=z,$e=U;return d(),u("div",G,[c("div",J,[m(s,{ref_key:"queryFormRef",ref:le,model:b(ne),inline:!0},{default:p(()=>[m(t,{prop:"keywords",label:"关键字"},{default:p(()=>[m(l,{modelValue:b(ne).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>b(ne).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:v(ke,["enter"])},null,8,["modelValue"])]),_:1}),m(t,{class:"search-buttons"},{default:p(()=>[m(o,{type:"primary",icon:"search",onClick:ke},{default:p(()=>[...a[16]||(a[16]=[_("搜索",-1)])]),_:1}),m(o,{icon:"refresh",onClick:je},{default:p(()=>[...a[17]||(a[17]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),m(ae,{shadow:"hover",class:"data-table"},{default:p(()=>[c("div",L,[c("div",W,[m(o,{type:"success",icon:"plus",onClick:a[1]||(a[1]=e=>we())},{default:p(()=>[...a[18]||(a[18]=[_("新增",-1)])]),_:1}),m(o,{type:"danger",disabled:0===b(ie).length,icon:"delete",onClick:a[2]||(a[2]=e=>Ee())},{default:p(()=>[...a[19]||(a[19]=[_(" 删除 ",-1)])]),_:1},8,["disabled"])])]),h((d(),y(E,{ref:"dataTableRef",data:b(ue),"highlight-current-row":"",border:"",class:"data-table__content",onSelectionChange:Ve},{default:p(()=>[m(i,{type:"selection",width:"55",align:"center"}),m(i,{label:"角色名称",prop:"name","min-width":"100"}),m(i,{label:"角色编码",prop:"code",width:"150"}),m(i,{label:"状态",align:"center",width:"100"},{default:p(e=>[1===e.row.status?(d(),y(r,{key:0,type:"success"},{default:p(()=>[...a[20]||(a[20]=[_("正常",-1)])]),_:1})):(d(),y(r,{key:1,type:"info"},{default:p(()=>[...a[21]||(a[21]=[_("禁用",-1)])]),_:1}))]),_:1}),m(i,{label:"排序",align:"center",width:"80",prop:"sort"}),m(i,{fixed:"right",label:"操作",width:"220"},{default:p(e=>[m(o,{type:"primary",size:"small",link:"",icon:"position",onClick:a=>async function(e){const a=e.id;a&&(be.value=!0,se.value=!0,ve.value.id=a,ve.value.name=e.name,de.value=await S.getOptions(),Z.getRoleMenuIds(a).then(e=>{e.forEach(e=>oe.value.setChecked(e,!0,!1))}).finally(()=>{se.value=!1}))}(e.row)},{default:p(()=>[...a[22]||(a[22]=[_(" 分配权限 ",-1)])]),_:1},8,["onClick"]),m(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:a=>we(e.row.id)},{default:p(()=>[...a[23]||(a[23]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),m(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:a=>Ee(e.row.id)},{default:p(()=>[...a[24]||(a[24]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$e,b(se)]]),b(re)>0?(d(),y($,{key:0,total:b(re),"onUpdate:total":a[3]||(a[3]=e=>V(re)?re.value=e:null),page:b(ne).pageNum,"onUpdate:page":a[4]||(a[4]=e=>b(ne).pageNum=e),limit:b(ne).pageSize,"onUpdate:limit":a[5]||(a[5]=e=>b(ne).pageSize=e),onPagination:ye},null,8,["total","page","limit"])):k("",!0)]),_:1}),m(Oe,{modelValue:b(ce).visible,"onUpdate:modelValue":a[11]||(a[11]=e=>b(ce).visible=e),title:b(ce).title,width:"500px",onClose:Ce},{footer:p(()=>[c("div",H,[m(o,{type:"primary",onClick:xe},{default:p(()=>[...a[27]||(a[27]=[_("确 定",-1)])]),_:1}),m(o,{onClick:Ce},{default:p(()=>[...a[28]||(a[28]=[_("取 消",-1)])]),_:1})])]),default:p(()=>[m(s,{ref_key:"roleFormRef",ref:te,model:b(pe),rules:b(fe),"label-width":"100px"},{default:p(()=>[m(t,{label:"角色名称",prop:"name"},{default:p(()=>[m(l,{modelValue:b(pe).name,"onUpdate:modelValue":a[6]||(a[6]=e=>b(pe).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),m(t,{label:"角色编码",prop:"code"},{default:p(()=>[m(l,{modelValue:b(pe).code,"onUpdate:modelValue":a[7]||(a[7]=e=>b(pe).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),m(t,{label:"数据权限",prop:"dataScope"},{default:p(()=>[m(qe,{modelValue:b(pe).dataScope,"onUpdate:modelValue":a[8]||(a[8]=e=>b(pe).dataScope=e)},{default:p(()=>[(d(),y(Re,{key:1,label:"全部数据",value:1})),(d(),y(Re,{key:2,label:"部门及子部门数据",value:2})),(d(),y(Re,{key:3,label:"本部门数据",value:3})),(d(),y(Re,{key:4,label:"本人数据",value:4}))]),_:1},8,["modelValue"])]),_:1}),m(t,{label:"状态",prop:"status"},{default:p(()=>[m(Te,{modelValue:b(pe).status,"onUpdate:modelValue":a[9]||(a[9]=e=>b(pe).status=e)},{default:p(()=>[m(Fe,{value:1},{default:p(()=>[...a[25]||(a[25]=[_("正常",-1)])]),_:1}),m(Fe,{value:0},{default:p(()=>[...a[26]||(a[26]=[_("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),m(t,{label:"排序",prop:"sort"},{default:p(()=>[m(Ie,{modelValue:b(pe).sort,"onUpdate:modelValue":a[10]||(a[10]=e=>b(pe).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),m(Ze,{modelValue:b(be),"onUpdate:modelValue":a[15]||(a[15]=e=>V(be)?be.value=e:null),title:"【"+b(ve).name+"】权限分配",size:b(me)},{footer:p(()=>[c("div",ee,[m(o,{type:"primary",onClick:Se},{default:p(()=>[...a[31]||(a[31]=[_("确 定",-1)])]),_:1}),m(o,{onClick:a[14]||(a[14]=e=>be.value=!1)},{default:p(()=>[...a[32]||(a[32]=[_("取 消",-1)])]),_:1})])]),default:p(()=>[c("div",X,[m(l,{modelValue:b(ge),"onUpdate:modelValue":a[12]||(a[12]=e=>V(ge)?ge.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:p(()=>[m(Be)]),_:1},8,["modelValue"]),c("div",Y,[m(o,{type:"primary",size:"small",plain:"",onClick:Ue},{icon:p(()=>[m(De)]),default:p(()=>[_(" "+x(b(_e)?"收缩":"展开"),1)]),_:1}),m(Ke,{modelValue:b(he),"onUpdate:modelValue":a[13]||(a[13]=e=>V(he)?he.value=e:null),class:"ml-5",onChange:Ne},{default:p(()=>[...a[29]||(a[29]=[_(" 父子联动 ",-1)])]),_:1},8,["modelValue"]),m(Ae,{placement:"bottom"},{content:p(()=>[...a[30]||(a[30]=[_(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ",-1)])]),default:p(()=>[m(Pe,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:p(()=>[m(Me)]),_:1})]),_:1})])]),m(Qe,{ref_key:"permTreeRef",ref:oe,"node-key":"value","show-checkbox":"",data:b(de),"filter-node-method":ze,"default-expand-all":!0,"check-strictly":!b(he),class:"mt-5"},{default:p(({data:e})=>[_(x(e.label),1)]),_:1},8,["data","check-strictly"])]),_:1},8,["modelValue","title","size"])])}}});export{ae as default};
