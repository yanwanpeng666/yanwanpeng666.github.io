import{d as e,aC as l,r as a,W as t,c as o,aI as r,o as s,aK as d,cp as u,g as i,f as n,D as p,m,w as c,$ as f,ag as y,i as v,ah as h,ai as _,ac as b,e as k,h as V,E as g,F as w,n as U,G as j,b7 as N,j as C,bO as T,S as E,V as x,bL as A,aZ as O}from"./index.Dv9sjPYC.js";import{v as L}from"./loading.S8LTmobk.js";import{E as I}from"./drawer.BVgiL_Wv.js";import{_ as M}from"./index.DctJaLJA.js";import{E as P}from"./input-number.sGCeKMc8.js";/* empty css                */import{E as G}from"./popper.m2lNosSJ.js";import{E as q,a as B}from"./radio-group.DKuTe-fa.js";import"./select.D46WCvpG.js";import"./scrollbar.DQblMs23.js";import"./tree.Dcl2NF7B.js";import"./checkbox.Cq-dvxYE.js";import"./text.PvK_Xx8y.js";import{E as F}from"./tree-select.BYKNxPD6.js";import{E as S}from"./card.UCV2TBx1.js";import{a as K,E as z}from"./table-column.D28nzGFS.js";import{E as R,a as X}from"./form-item.DgRMSZzs.js";/* empty css                    */import{E as D}from"./index.BqKoy5Fw.js";import"./popover.D-CR5ZXz.js";import"./dropdown.BJAt-r5X.js";import"./tab-pane.BbUdchER.js";import"./raf.B6j8aosc.js";import"./strings.BtizHOxT.js";import"./toNumber.P9ps2NTq.js";import"./index.BqoI6SeD.js";import"./omit.B6E_lyF8.js";import"./_baseClone.Br4BWTY9.js";import"./index.BlULC2eY.js";import"./castArray.D1K_WIrw.js";import"./_baseIteratee.DbpbFJtj.js";import"./index.8lkWLndA.js";import"./index.C5bLMH_j.js";import"./debounce.CITkvERZ.js";var $=(e=>(e[e.CATALOG=2]="CATALOG",e[e.MENU=1]="MENU",e[e.BUTTON=4]="BUTTON",e[e.EXTLINK=3]="EXTLINK",e))($||{});const Q={class:"app-container"},W={class:"search-container"},Z={class:"data-table__toolbar"},H={class:"data-table__toolbar--actions"},J={class:"flex-y-center"},Y={class:"flex-y-center"},ee={class:"flex-y-center"},le={class:"flex-y-center"},ae={key:0},te={key:1},oe={class:"flex-y-center"},re={class:"dialog-footer"},se=e({name:"SysMenu",inheritAttrs:!1,__name:"index",setup(e){const se=l(),de=a(),ue=a(),ie=a(!1),ne=t({title:"新增菜单",visible:!1}),pe=o(()=>se.device===r.DESKTOP?"600px":"90%"),me=t({}),ce=a([]),fe=a([]),ye=a({id:void 0,parentId:"0",visible:1,sort:1,type:$.MENU,alwaysShow:0,keepAlive:1,params:[]}),ve=a({...ye.value}),he=t({parentId:[{required:!0,message:"请选择父级菜单",trigger:"blur"}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],type:[{required:!0,message:"请选择菜单类型",trigger:"blur"}],routeName:[{required:!0,message:"请输入路由名称",trigger:"blur"}],routePath:[{required:!0,message:"请输入路由路径",trigger:"blur"}],component:[{required:!0,message:"请输入组件路径",trigger:"blur"}],visible:[{required:!0,message:"请选择显示状态",trigger:"change"}]}),_e=a();function be(){ie.value=!0,A.getList(me).then(e=>{ce.value=e}).finally(()=>{ie.value=!1})}function ke(){de.value.resetFields(),be()}function Ve(e){_e.value=e.id}function ge(e,l){A.getOptions(!0).then(e=>{fe.value=[{value:"0",label:"顶级菜单",children:e}]}).then(()=>{ne.visible=!0,l?(ne.title="编辑菜单",A.getFormData(l).then(e=>{ye.value={...e},ve.value=e})):(ne.title="新增菜单",ve.value.parentId=e?.toString())})}function we(){ve.value.type!==ye.value.type&&ve.value.type===$.MENU&&(ye.value.type===$.CATALOG?ve.value.component="":(ve.value.routePath=ye.value.routePath,ve.value.component=ye.value.component))}function Ue(){ue.value.validate(e=>{if(e){const e=ve.value.id;if(e){if(ve.value.parentId==e)return void O.error("父级菜单不能为当前菜单");A.update(e,ve.value).then(()=>{O.success("修改成功"),je(),be()})}else A.create(ve.value).then(()=>{O.success("新增成功"),je(),be()})}})}function je(){ne.visible=!1,ue.value.resetFields(),ue.value.clearValidate(),ve.value={id:void 0,parentId:"0",visible:1,sort:1,type:$.MENU,alwaysShow:0,keepAlive:1,params:[]}}return s(()=>{be()}),(e,l)=>{const a=f,t=R,o=h,r=X,s=g,se=z,ye=N,_e=K,Ne=S,Ce=F,Te=B,Ee=q,xe=d("QuestionFilled"),Ae=G,Oe=d("CirclePlusFilled"),Le=d("DeleteFilled"),Ie=P,Me=M,Pe=I,Ge=u("hasPerm"),qe=L;return n(),i("div",Q,[p("div",W,[m(r,{ref_key:"queryFormRef",ref:de,model:v(me),inline:!0},{default:c(()=>[m(t,{label:"关键字",prop:"keywords"},{default:c(()=>[m(a,{modelValue:v(me).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>v(me).keywords=e),placeholder:"菜单名称",clearable:"",onKeyup:y(be,["enter"])},null,8,["modelValue"])]),_:1}),m(t,{class:"search-buttons"},{default:c(()=>[m(o,{type:"primary",icon:"search",onClick:be},{default:c(()=>[...l[20]||(l[20]=[_("搜索",-1)])]),_:1}),m(o,{icon:"refresh",onClick:ke},{default:c(()=>[...l[21]||(l[21]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),m(Ne,{shadow:"hover",class:"data-table"},{default:c(()=>[p("div",Z,[p("div",H,[b((n(),k(o,{type:"success",icon:"plus",onClick:l[1]||(l[1]=e=>ge("0"))},{default:c(()=>[...l[22]||(l[22]=[_(" 新增 ",-1)])]),_:1})),[[Ge,["sys:menu:add"]]])])]),b((n(),k(_e,{ref:"dataTableRef","row-key":"id",data:v(ce),"tree-props":{children:"children",hasChildren:"hasChildren"},class:"data-table__content",onRowClick:Ve},{default:c(()=>[m(se,{label:"菜单名称","min-width":"200"},{default:c(e=>[e.row.icon&&e.row.icon.startsWith("el-icon")?(n(),k(s,{key:0,style:{"vertical-align":"-0.15em"}},{default:c(()=>[(n(),k(w(e.row.icon.replace("el-icon-",""))))]),_:2},1024)):e.row.icon?(n(),i("div",{key:1,class:U(`i-svg:${e.row.icon}`)},null,2)):V("",!0),_(" "+j(e.row.name),1)]),_:1}),m(se,{label:"类型",align:"center",width:"80"},{default:c(e=>[e.row.type===v($).CATALOG?(n(),k(ye,{key:0,type:"warning"},{default:c(()=>[...l[23]||(l[23]=[_("目录",-1)])]),_:1})):V("",!0),e.row.type===v($).MENU?(n(),k(ye,{key:1,type:"success"},{default:c(()=>[...l[24]||(l[24]=[_("菜单",-1)])]),_:1})):V("",!0),e.row.type===v($).BUTTON?(n(),k(ye,{key:2,type:"danger"},{default:c(()=>[...l[25]||(l[25]=[_("按钮",-1)])]),_:1})):V("",!0),e.row.type===v($).EXTLINK?(n(),k(ye,{key:3,type:"info"},{default:c(()=>[...l[26]||(l[26]=[_("外链",-1)])]),_:1})):V("",!0)]),_:1}),m(se,{label:"路由名称",align:"left",width:"150",prop:"routeName"}),m(se,{label:"路由路径",align:"left",width:"150",prop:"routePath"}),m(se,{label:"组件路径",align:"left",width:"250",prop:"component"}),m(se,{label:"权限标识",align:"center",width:"200",prop:"perm"}),m(se,{label:"状态",align:"center",width:"80"},{default:c(e=>[1===e.row.visible?(n(),k(ye,{key:0,type:"success"},{default:c(()=>[...l[27]||(l[27]=[_("显示",-1)])]),_:1})):(n(),k(ye,{key:1,type:"info"},{default:c(()=>[...l[28]||(l[28]=[_("隐藏",-1)])]),_:1}))]),_:1}),m(se,{label:"排序",align:"center",width:"80",prop:"sort"}),m(se,{fixed:"right",align:"center",label:"操作",width:"220"},{default:c(e=>[e.row.type==v($).CATALOG||e.row.type==v($).MENU?b((n(),k(o,{key:0,type:"primary",link:"",size:"small",icon:"plus",onClick:C(l=>ge(e.row.id),["stop"])},{default:c(()=>[...l[29]||(l[29]=[_(" 新增 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:add"]]]):V("",!0),b((n(),k(o,{type:"primary",link:"",size:"small",icon:"edit",onClick:C(l=>ge(void 0,e.row.id),["stop"])},{default:c(()=>[...l[30]||(l[30]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:edit"]]]),b((n(),k(o,{type:"danger",link:"",size:"small",icon:"delete",onClick:C(l=>function(e){if(!e)return O.warning("请勾选删除项"),!1;D.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ie.value=!0,A.deleteById(e).then(()=>{O.success("删除成功"),be()}).finally(()=>{ie.value=!1})},()=>{O.info("已取消删除")})}(e.row.id),["stop"])},{default:c(()=>[...l[31]||(l[31]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Ge,["sys:menu:delete"]]])]),_:1})]),_:1},8,["data"])),[[qe,v(ie)]])]),_:1}),m(Pe,{modelValue:v(ne).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>v(ne).visible=e),title:v(ne).title,size:v(pe),onClose:je},{footer:c(()=>[p("div",re,[m(o,{type:"primary",onClick:Ue},{default:c(()=>[...l[56]||(l[56]=[_("确 定",-1)])]),_:1}),m(o,{onClick:je},{default:c(()=>[...l[57]||(l[57]=[_("取 消",-1)])]),_:1})])]),default:c(()=>[m(r,{ref_key:"menuFormRef",ref:ue,model:v(ve),rules:v(he),"label-width":"100px"},{default:c(()=>[m(t,{label:"父级菜单",prop:"parentId"},{default:c(()=>[m(Ce,{modelValue:v(ve).parentId,"onUpdate:modelValue":l[2]||(l[2]=e=>v(ve).parentId=e),placeholder:"选择上级菜单",data:v(fe),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),m(t,{label:"菜单名称",prop:"name"},{default:c(()=>[m(a,{modelValue:v(ve).name,"onUpdate:modelValue":l[3]||(l[3]=e=>v(ve).name=e),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),m(t,{label:"菜单类型",prop:"type"},{default:c(()=>[m(Ee,{modelValue:v(ve).type,"onUpdate:modelValue":l[4]||(l[4]=e=>v(ve).type=e),onChange:we},{default:c(()=>[m(Te,{value:v($).CATALOG},{default:c(()=>[...l[32]||(l[32]=[_("目录",-1)])]),_:1},8,["value"]),m(Te,{value:v($).MENU},{default:c(()=>[...l[33]||(l[33]=[_("菜单",-1)])]),_:1},8,["value"]),m(Te,{value:v($).BUTTON},{default:c(()=>[...l[34]||(l[34]=[_("按钮",-1)])]),_:1},8,["value"]),m(Te,{value:v($).EXTLINK},{default:c(()=>[...l[35]||(l[35]=[_("外链",-1)])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),v(ve).type==v($).EXTLINK?(n(),k(t,{key:0,label:"外链地址",prop:"path"},{default:c(()=>[m(a,{modelValue:v(ve).routePath,"onUpdate:modelValue":l[5]||(l[5]=e=>v(ve).routePath=e),placeholder:"请输入外链完整路径"},null,8,["modelValue"])]),_:1})):V("",!0),v(ve).type==v($).MENU?(n(),k(t,{key:1,prop:"routeName"},{label:c(()=>[p("div",J,[l[37]||(l[37]=_(" 路由名称 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[36]||(l[36]=[_(" 如果需要开启缓存，需保证页面 defineOptions 中的 name 与此处一致，建议使用驼峰。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(xe)]),_:1})]),_:1})])]),default:c(()=>[m(a,{modelValue:v(ve).routeName,"onUpdate:modelValue":l[6]||(l[6]=e=>v(ve).routeName=e),placeholder:"User"},null,8,["modelValue"])]),_:1})):V("",!0),v(ve).type==v($).CATALOG||v(ve).type==v($).MENU?(n(),k(t,{key:2,prop:"routePath"},{label:c(()=>[p("div",Y,[l[39]||(l[39]=_(" 路由路径 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[38]||(l[38]=[_(" 定义应用中不同页面对应的 URL 路径，目录需以 / 开头，菜单项不用。例如：系统管理目录 /system，系统管理下的用户管理菜单 user。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(xe)]),_:1})]),_:1})])]),default:c(()=>[v(ve).type==v($).CATALOG?(n(),k(a,{key:0,modelValue:v(ve).routePath,"onUpdate:modelValue":l[7]||(l[7]=e=>v(ve).routePath=e),placeholder:"system"},null,8,["modelValue"])):(n(),k(a,{key:1,modelValue:v(ve).routePath,"onUpdate:modelValue":l[8]||(l[8]=e=>v(ve).routePath=e),placeholder:"user"},null,8,["modelValue"]))]),_:1})):V("",!0),v(ve).type==v($).MENU?(n(),k(t,{key:3,prop:"component"},{label:c(()=>[p("div",ee,[l[41]||(l[41]=_(" 组件路径 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[40]||(l[40]=[_(" 组件页面完整路径，相对于 src/views/，如 system/user/index，缺省后缀 .vue ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(xe)]),_:1})]),_:1})])]),default:c(()=>[m(a,{modelValue:v(ve).component,"onUpdate:modelValue":l[9]||(l[9]=e=>v(ve).component=e),placeholder:"system/user/index",style:{width:"95%"}},T({_:2},[v(ve).type==v($).MENU?{name:"prepend",fn:c(()=>[l[42]||(l[42]=_("src/views/",-1))]),key:"0"}:void 0,v(ve).type==v($).MENU?{name:"append",fn:c(()=>[l[43]||(l[43]=_(".vue",-1))]),key:"1"}:void 0]),1032,["modelValue"])]),_:1})):V("",!0),v(ve).type==v($).MENU?(n(),k(t,{key:4},{label:c(()=>[p("div",le,[l[45]||(l[45]=_(" 路由参数 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[44]||(l[44]=[_(" 组件页面使用 `useRoute().query.参数名` 获取路由参数值。 ",-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(xe)]),_:1})]),_:1})])]),default:c(()=>[v(ve).params&&0!==v(ve).params.length?(n(),i("div",te,[(n(!0),i(E,null,x(v(ve).params,(e,t)=>(n(),i("div",{key:t},[m(a,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,placeholder:"参数名",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[47]||(l[47]=p("span",{class:"mx-1"},"=",-1)),m(a,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"参数值",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),v(ve).params.indexOf(e)===v(ve).params.length-1?(n(),k(s,{key:0,class:"ml-2 cursor-pointer color-[var(--el-color-success)]",style:{"vertical-align":"-0.15em"},onClick:l[11]||(l[11]=e=>v(ve).params.push({key:"",value:""}))},{default:c(()=>[m(Oe)]),_:1})):V("",!0),m(s,{class:"ml-2 cursor-pointer color-[var(--el-color-danger)]",style:{"vertical-align":"-0.15em"},onClick:l=>v(ve).params.splice(v(ve).params.indexOf(e),1)},{default:c(()=>[m(Le)]),_:1},8,["onClick"])]))),128))])):(n(),i("div",ae,[m(o,{type:"success",plain:"",onClick:l[10]||(l[10]=e=>v(ve).params=[{key:"",value:""}])},{default:c(()=>[...l[46]||(l[46]=[_(" 添加路由参数 ",-1)])]),_:1})]))]),_:1})):V("",!0),v(ve).type!==v($).BUTTON?(n(),k(t,{key:5,prop:"visible",label:"显示状态"},{default:c(()=>[m(Ee,{modelValue:v(ve).visible,"onUpdate:modelValue":l[12]||(l[12]=e=>v(ve).visible=e)},{default:c(()=>[m(Te,{value:1},{default:c(()=>[...l[48]||(l[48]=[_("显示",-1)])]),_:1}),m(Te,{value:0},{default:c(()=>[...l[49]||(l[49]=[_("隐藏",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):V("",!0),v(ve).type===v($).CATALOG||v(ve).type===v($).MENU?(n(),k(t,{key:6},{label:c(()=>[p("div",oe,[l[51]||(l[51]=_(" 始终显示 ",-1)),m(Ae,{placement:"bottom",effect:"light"},{content:c(()=>[...l[50]||(l[50]=[_(' 选择"是"，即使目录或菜单下只有一个子节点，也会显示父节点。 ',-1),p("br",null,null,-1),_(' 选择"否"，如果目录或菜单下只有一个子节点，则只显示该子节点，隐藏父节点。 ',-1),p("br",null,null,-1),_(' 如果是叶子节点，请选择"否"。 ',-1)])]),default:c(()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c(()=>[m(xe)]),_:1})]),_:1})])]),default:c(()=>[m(Ee,{modelValue:v(ve).alwaysShow,"onUpdate:modelValue":l[13]||(l[13]=e=>v(ve).alwaysShow=e)},{default:c(()=>[m(Te,{value:1},{default:c(()=>[...l[52]||(l[52]=[_("是",-1)])]),_:1}),m(Te,{value:0},{default:c(()=>[...l[53]||(l[53]=[_("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):V("",!0),v(ve).type===v($).MENU?(n(),k(t,{key:7,label:"缓存页面"},{default:c(()=>[m(Ee,{modelValue:v(ve).keepAlive,"onUpdate:modelValue":l[14]||(l[14]=e=>v(ve).keepAlive=e)},{default:c(()=>[m(Te,{value:1},{default:c(()=>[...l[54]||(l[54]=[_("开启",-1)])]),_:1}),m(Te,{value:0},{default:c(()=>[...l[55]||(l[55]=[_("关闭",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):V("",!0),m(t,{label:"排序",prop:"sort"},{default:c(()=>[m(Ie,{modelValue:v(ve).sort,"onUpdate:modelValue":l[15]||(l[15]=e=>v(ve).sort=e),style:{width:"100px"},"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),v(ve).type==v($).BUTTON?(n(),k(t,{key:8,label:"权限标识",prop:"perm"},{default:c(()=>[m(a,{modelValue:v(ve).perm,"onUpdate:modelValue":l[16]||(l[16]=e=>v(ve).perm=e),placeholder:"sys:user:add"},null,8,["modelValue"])]),_:1})):V("",!0),v(ve).type!==v($).BUTTON?(n(),k(t,{key:9,label:"图标",prop:"icon"},{default:c(()=>[m(Me,{modelValue:v(ve).icon,"onUpdate:modelValue":l[17]||(l[17]=e=>v(ve).icon=e)},null,8,["modelValue"])]),_:1})):V("",!0),v(ve).type==v($).CATALOG?(n(),k(t,{key:10,label:"跳转路由"},{default:c(()=>[m(a,{modelValue:v(ve).redirect,"onUpdate:modelValue":l[18]||(l[18]=e=>v(ve).redirect=e),placeholder:"跳转路由"},null,8,["modelValue"])]),_:1})):V("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","size"])])}}});export{se as default};
