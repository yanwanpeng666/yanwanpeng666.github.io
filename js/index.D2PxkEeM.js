import{t as e,aQ as l,aM as a,v as s,z as t,d as r,b as i,r as o,c as d,M as n,J as u,I as m,e as p,h as c,n as f,g as b,f as v,w as y,C as _,E as g,k as w,i as k,_ as j,q as h,S as V,o as x,ae as P,l as E,aR as z,B as C,aS as I,X as U,D as q,p as A,ax as S}from"./index.B3d8Dmuj.js";import{E as M}from"./el-dialog.BIT_iI8z.js";import"./el-overlay.DFO6xjsR.js";import{a as F,E as Z}from"./el-form-item.Ccxqd9VX.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang.Cpgtlane.js";import{E as R}from"./el-input.g7qu-v5S.js";import{E as $,a as L}from"./el-tab-pane.DG6SXM34.js";import{a as N,E as O}from"./el-col.Co21xFTR.js";import{E as T}from"./el-card.t0aqapey.js";import{E as Q,a as X}from"./el-descriptions-item.DEcMx5bt.js";import{_ as D}from"./index.BBKno7pT.js";import{E as J}from"./el-button.Bv8Q2e7m.js";import{F as K}from"./index.DFQblB9S.js";import{_ as W}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.BEtNIXJ0.js";import"./refs.aVURMvDQ.js";import"./index.CBTk_erf.js";import"./vnode.CJ2I5vtx.js";import"./use-form-item.DH5ATW-n.js";import"./scroll.B1tgehxc.js";import"./castArray.BRUV2Qo0.js";import"./_Uint8Array.D4E2MRdn.js";import"./index.DNmsiJtL.js";import"./el-checkbox.C6eKdUkB.js";import"./isEqual.CWZuw94W.js";import"./el-radio-group.BsfhQCiu.js";/* empty css                 *//* empty css               */import"./el-select.CVxl-A_m.js";import"./el-popper.CBWrSz2w.js";import"./el-scrollbar.C2a-duqq.js";import"./index.AklDLJAR.js";import"./token.DWNpOE8r.js";import"./strings.CWMG2Kzx.js";import"./index.bRUuVa1a.js";import"./debounce.D7EHRBw6.js";import"./_baseIteratee.I3aVY8Vh.js";import"./index.ZW63jOM8.js";import"./index.fyX6um-q.js";import"./index.Csr3q4eJ.js";const G=e({size:{type:[Number,String],values:l,default:"",validator:e=>a(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:s},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:t(String),default:"cover"}}),H={error:e=>e instanceof Event},Y=r({name:"ElAvatar"});const ee=h(j(r({...Y,props:G,emits:H,setup(e,{emit:l}){const s=e,t=i("avatar"),r=o(!1),j=d((()=>{const{size:e,icon:l,shape:a}=s,r=[t.b()];return n(e)&&r.push(t.m(e)),l&&r.push(t.m("icon")),a&&r.push(t.m(a)),r})),h=d((()=>{const{size:e}=s;return a(e)?t.cssVarBlock({size:u(e)||""}):void 0})),V=d((()=>({objectFit:s.fit})));function x(e){r.value=!0,l("error",e)}return m((()=>s.src),(()=>r.value=!1)),(e,l)=>(p(),c("span",{class:k(b(j)),style:f(b(h))},[!e.src&&!e.srcSet||r.value?e.icon?(p(),v(b(g),{key:1},{default:y((()=>[(p(),v(_(e.icon)))])),_:1})):w(e.$slots,"default",{key:2}):(p(),c("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:f(b(V)),onError:x},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),le={class:"app-container"},ae={class:"w-full"},se={class:"relative w-100px h-100px flex-center"},te={class:"mt-5"},re={class:"text-14px mt-2"},ie={class:"mt-5"},oe={class:"text-14px mt-2"},de={key:0},ne={key:1},ue={class:"mt-5"},me={class:"text-14px mt-2"},pe={key:0},ce={key:1},fe={class:"dialog-footer"},be=W(r({__name:"index",setup(e){const l=o({}),a=V({visible:!1,title:"",type:""}),s=V({}),t=V({}),r=V({}),i=V({}),d=o(0),n=o(null),u=o(0),m=o(null),f={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},_={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},w={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},k=e=>{switch(a.type=e,a.visible=!0,e){case"account":a.title="账号资料",s.id=l.value.id,s.nickname=l.value.nickname,s.gender=l.value.gender;break;case"password":a.title="修改密码";break;case"mobile":a.title="绑定手机";break;case"email":a.title="绑定邮箱"}},j=async e=>{if("MOBILE"===e){if(!r.mobile)return void S.error("请输入手机号");if(!/^1[3-9]\d{9}$/.test(r.mobile))return void S.error("手机号格式不正确");d.value=60,n.value=setInterval((()=>{d.value>0?d.value-=1:clearInterval(n.value)}),1e3)}else if("EMAIL"===e){if(!i.email)return void S.error("请输入邮箱");if(!/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(i.email))return void S.error("邮箱格式不正确");u.value=60,m.value=setInterval((()=>{u.value>0?u.value-=1:clearInterval(m.value)}),1e3)}},h=async()=>{if("account"===a.type)z.updateProfile(s).then((()=>{S.success("账号资料修改成功"),a.visible=!1,Y()}));else if("password"===a.type){if(t.newPassword!==t.confirmPassword)return void S.error("两次输入的密码不一致");z.changePassword(t).then((()=>{S.success("密码修改成功"),a.visible=!1}))}else"mobile"===a.type?z.bindMobile(r).then((()=>{S.success("手机号绑定成功"),a.visible=!1,Y()})):"email"===a.type&&z.bindEmail(i).then((()=>{S.success("邮箱绑定成功"),a.visible=!1,Y()}))},W=o(null),G=()=>{var e;null==(e=W.value)||e.click()},H=async e=>{const a=e.target,s=a.files?a.files[0]:null;if(s)try{const e=await K.upload(s);l.value.avatar=e.url,await z.updateProfile({avatar:e.url})}catch(t){S.error("头像上传失败")}},Y=async()=>{const e=await z.getProfile();l.value=e};return x((async()=>{n.value&&clearInterval(n.value),m.value&&clearInterval(m.value),await Y()})),(e,o)=>{const n=ee,m=J,V=P("Edit"),x=g,z=P("User"),S=P("Male"),K=P("Female"),Y=Q,be=P("Phone"),ve=P("Message"),ye=D,_e=P("Timer"),ge=X,we=T,ke=L,je=N,he=O,Ve=$,xe=R,Pe=F,Ee=B,ze=Z,Ce=M;return p(),c("div",le,[E(Ve,{"tab-position":"left"},{default:y((()=>[E(ke,{label:"账号信息"},{default:y((()=>[C("div",ae,[E(we,null,{default:y((()=>[C("div",se,[E(n,{src:b(l).avatar,size:100},null,8,["src"]),E(m,{type:"info",class:"absolute bottom-0 right-0 cursor-pointer",circle:"",icon:b(I),size:"small",onClick:G},null,8,["icon"]),C("input",{ref_key:"fileInput",ref:W,type:"file",style:{display:"none"},onChange:H},null,544)]),C("div",te,[U(q(b(l).nickname)+" ",1),E(x,{class:"align-middle cursor-pointer",onClick:o[0]||(o[0]=e=>k("account"))},{default:y((()=>[E(V)])),_:1})]),E(ge,{column:1,class:"mt-10"},{default:y((()=>[E(Y,null,{label:y((()=>[E(x,{class:"align-middle"},{default:y((()=>[E(z)])),_:1}),o[19]||(o[19]=U(" 用户名 "))])),default:y((()=>[U(" "+q(b(l).username)+" ",1),1===b(l).gender?(p(),v(x,{key:0,class:"align-middle color-blue"},{default:y((()=>[E(S)])),_:1})):(p(),v(x,{key:1,class:"align-middle color-pink"},{default:y((()=>[E(K)])),_:1}))])),_:1}),E(Y,null,{label:y((()=>[E(x,{class:"align-middle"},{default:y((()=>[E(be)])),_:1}),o[20]||(o[20]=U(" 手机号码 "))])),default:y((()=>[U(" "+q(b(l).mobile),1)])),_:1}),E(Y,null,{label:y((()=>[E(x,{class:"align-middle"},{default:y((()=>[E(ve)])),_:1}),o[21]||(o[21]=U(" 邮箱 "))])),default:y((()=>[U(" "+q(b(l).email),1)])),_:1}),E(Y,null,{label:y((()=>[E(ye,{"icon-class":"tree"}),o[22]||(o[22]=U(" 部门 "))])),default:y((()=>[U(" "+q(b(l).deptName),1)])),_:1}),E(Y,null,{label:y((()=>[E(ye,{"icon-class":"role"}),o[23]||(o[23]=U(" 角色 "))])),default:y((()=>[U(" "+q(b(l).roleNames),1)])),_:1}),E(Y,null,{label:y((()=>[E(x,{class:"align-middle"},{default:y((()=>[E(_e)])),_:1}),o[24]||(o[24]=U(" 创建日期 "))])),default:y((()=>[U(" "+q(b(l).createTime),1)])),_:1})])),_:1})])),_:1})])])),_:1}),E(ke,{label:"安全设置"},{default:y((()=>[E(we,null,{default:y((()=>[E(he,null,{default:y((()=>[E(je,{span:16},{default:y((()=>[o[27]||(o[27]=C("div",{class:"font-bold"},"账户密码",-1)),C("div",re,[o[26]||(o[26]=U(" 定期修改密码有助于保护账户安全 ")),E(m,{type:"primary",plain:"",size:"small",class:"ml-5",onClick:o[1]||(o[1]=()=>k("password"))},{default:y((()=>o[25]||(o[25]=[U(" 修改 ")]))),_:1})])])),_:1})])),_:1}),C("div",ie,[o[30]||(o[30]=C("div",{class:"font-bold"},"绑定手机",-1)),C("div",oe,[b(l).mobile?(p(),c("span",de," 已绑定手机号："+q(b(l).mobile),1)):(p(),c("span",ne,"未绑定手机")),b(l).mobile?(p(),v(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:o[2]||(o[2]=()=>k("mobile"))},{default:y((()=>o[28]||(o[28]=[U(" 更换 ")]))),_:1})):(p(),v(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:o[3]||(o[3]=()=>k("mobile"))},{default:y((()=>o[29]||(o[29]=[U(" 绑定 ")]))),_:1}))])]),C("div",ue,[o[33]||(o[33]=C("div",{class:"font-bold"},"绑定邮箱",-1)),C("div",me,[b(l).email?(p(),c("span",pe," 已绑定邮箱："+q(b(l).email),1)):(p(),c("span",ce,"未绑定邮箱")),b(l).email?(p(),v(m,{key:2,type:"primary",plain:"",size:"small",class:"ml-5",onClick:o[4]||(o[4]=()=>k("email"))},{default:y((()=>o[31]||(o[31]=[U(" 更换 ")]))),_:1})):(p(),v(m,{key:3,type:"primary",plain:"",size:"small",class:"ml-5",onClick:o[5]||(o[5]=()=>k("email"))},{default:y((()=>o[32]||(o[32]=[U(" 绑定 ")]))),_:1}))])])])),_:1})])),_:1})])),_:1}),E(Ce,{modelValue:b(a).visible,"onUpdate:modelValue":o[18]||(o[18]=e=>b(a).visible=e),title:b(a).title,width:500},{footer:y((()=>[C("span",fe,[E(m,{onClick:o[17]||(o[17]=e=>b(a).visible=!1)},{default:y((()=>o[34]||(o[34]=[U("取消")]))),_:1}),E(m,{type:"primary",onClick:h},{default:y((()=>o[35]||(o[35]=[U("确定")]))),_:1})])])),default:y((()=>["account"===b(a).type?(p(),v(ze,{key:0,ref:"userProfileFormRef",model:b(s),"label-width":100},{default:y((()=>[E(Pe,{label:"昵称"},{default:y((()=>[E(xe,{modelValue:b(s).nickname,"onUpdate:modelValue":o[6]||(o[6]=e=>b(s).nickname=e)},null,8,["modelValue"])])),_:1}),E(Pe,{label:"性别"},{default:y((()=>[E(Ee,{modelValue:b(s).gender,"onUpdate:modelValue":o[7]||(o[7]=e=>b(s).gender=e),code:"gender"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0),"password"===b(a).type?(p(),v(ze,{key:1,ref:"passwordChangeFormRef",model:b(t),rules:f,"label-width":100},{default:y((()=>[E(Pe,{label:"原密码",prop:"oldPassword"},{default:y((()=>[E(xe,{modelValue:b(t).oldPassword,"onUpdate:modelValue":o[8]||(o[8]=e=>b(t).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),E(Pe,{label:"新密码",prop:"newPassword"},{default:y((()=>[E(xe,{modelValue:b(t).newPassword,"onUpdate:modelValue":o[9]||(o[9]=e=>b(t).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),E(Pe,{label:"确认密码",prop:"confirmPassword"},{default:y((()=>[E(xe,{modelValue:b(t).confirmPassword,"onUpdate:modelValue":o[10]||(o[10]=e=>b(t).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):"mobile"===b(a).type?(p(),v(ze,{key:2,ref:"mobileBindingFormRef",model:b(r),rules:_,"label-width":100},{default:y((()=>[E(Pe,{label:"手机号码",prop:"mobile"},{default:y((()=>[E(xe,{modelValue:b(r).mobile,"onUpdate:modelValue":o[11]||(o[11]=e=>b(r).mobile=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),E(Pe,{label:"验证码",prop:"code"},{default:y((()=>[E(xe,{modelValue:b(r).code,"onUpdate:modelValue":o[13]||(o[13]=e=>b(r).code=e),style:{width:"250px"}},{append:y((()=>[E(m,{class:"ml-5",disabled:b(d)>0,onClick:o[12]||(o[12]=e=>j("MOBILE"))},{default:y((()=>[U(q(b(d)>0?`${b(d)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):"email"===b(a).type?(p(),v(ze,{key:3,ref:"emailBindingFormRef",model:b(i),rules:w,"label-width":100},{default:y((()=>[E(Pe,{label:"邮箱",prop:"email"},{default:y((()=>[E(xe,{modelValue:b(i).email,"onUpdate:modelValue":o[14]||(o[14]=e=>b(i).email=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),E(Pe,{label:"验证码",prop:"code"},{default:y((()=>[E(xe,{modelValue:b(i).code,"onUpdate:modelValue":o[16]||(o[16]=e=>b(i).code=e),style:{width:"250px"}},{append:y((()=>[E(m,{class:"ml-5",disabled:b(u)>0,onClick:o[15]||(o[15]=e=>j("EMAIL"))},{default:y((()=>[U(q(b(u)>0?`${b(u)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-a7910b33"]]);export{be as default};
