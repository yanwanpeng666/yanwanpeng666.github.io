import{v as e,A as a,x as l,bn as s,bw as t,_ as r,d as i,b as o,r as d,c as u,N as n,K as c,J as m,g as p,f,e as v,l as b,k as y,i as _,w as g,F as w,E as k,n as h,q as V,bx as j,W as P,o as C,m as x,aS as z,by as F,D as E,ah as I,bz as S,G as U,aK as q,a$ as A,ai as Z,h as $,$ as N,aZ as R,aJ as B}from"./index.Dv9sjPYC.js";import{E as M,a as J}from"./form-item.DgRMSZzs.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang.DBPr1bj8.js";import{E as O,a as D}from"./col.BTxHlVsk.js";import{E as G,a as Q}from"./descriptions-item.Dx4SZjwy.js";import{E as T}from"./card.UCV2TBx1.js";import{F as W}from"./file-api.C9PIarN4.js";import"./castArray.D1K_WIrw.js";import"./_baseClone.Br4BWTY9.js";import"./checkbox.Cq-dvxYE.js";import"./omit.B6E_lyF8.js";/* empty css                       */import"./radio-group.DKuTe-fa.js";import"./select.D46WCvpG.js";import"./popper.m2lNosSJ.js";import"./scrollbar.DQblMs23.js";import"./strings.BtizHOxT.js";import"./toNumber.P9ps2NTq.js";import"./_baseIteratee.DbpbFJtj.js";import"./index.8lkWLndA.js";const H=e({size:{type:[Number,String],values:t,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:l},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),L={error:e=>e instanceof Event},X=i({name:"ElAvatar"});const Y=V(r(i({...X,props:H,emits:L,setup(e,{emit:a}){const l=e,t=o("avatar"),r=d(!1),i=u(()=>{const{size:e,icon:a,shape:s}=l,r=[t.b()];return n(e)&&r.push(t.m(e)),a&&r.push(t.m("icon")),s&&r.push(t.m(s)),r}),V=u(()=>{const{size:e}=l;return s(e)?t.cssVarBlock({size:c(e)}):void 0}),j=u(()=>({objectFit:l.fit}));function P(e){r.value=!0,a("error",e)}return m(()=>l.src,()=>r.value=!1),(e,a)=>(f(),p("span",{class:h(_(i)),style:y(_(V))},[!e.src&&!e.srcSet||r.value?e.icon?(f(),v(_(k),{key:1},{default:g(()=>[(f(),v(w(e.icon)))]),_:1})):b(e.$slots,"default",{key:2}):(f(),p("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:y(_(j)),onError:P},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),ee={class:"profile-container"},ae={class:"user-info"},le={class:"avatar-wrapper"},se={class:"user-name"},te={class:"nickname"},re={class:"user-role"},ie={class:"security-item"},oe={class:"dialog-footer"},de=B(i({__name:"index",setup(e){const a=j(),l=d({}),s=P({visible:!1,title:"",type:""}),t=d(),r=d(),i=d(),o=d(),u=P({}),n=P({}),c=P({}),m=P({}),b=d(0),y=d(),w=d(0),h=d(),V={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},B={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},H={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},L=e=>{switch(s.type=e,s.visible=!0,e){case"account":s.title="账号资料",u.id=l.value.id,u.nickname=l.value.nickname,u.gender=l.value.gender;break;case"password":s.title="修改密码";break;case"mobile":s.title="绑定手机";break;case"email":s.title="绑定邮箱"}};function X(){if(!c.mobile)return void R.error("请输入手机号");/^1[3-9]\d{9}$/.test(c.mobile)?F.sendMobileCode(c.mobile).then(()=>{R.success("验证码发送成功"),b.value=60,y.value=setInterval(()=>{b.value>0?b.value-=1:clearInterval(y.value)},1e3)}):R.error("手机号格式不正确")}function de(){if(!m.email)return void R.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(m.email)?F.sendEmailCode(m.email).then(()=>{R.success("验证码发送成功"),w.value=60,h.value=setInterval(()=>{w.value>0?w.value-=1:clearInterval(h.value)},1e3)}):R.error("邮箱格式不正确")}const ue=async()=>{if("account"===s.type)F.updateProfile(u).then(()=>{R.success("账号资料修改成功"),s.visible=!1,fe()});else if("password"===s.type){if(n.newPassword!==n.confirmPassword)return void R.error("两次输入的密码不一致");F.changePassword(n).then(()=>{R.success("密码修改成功"),s.visible=!1})}else"mobile"===s.type?F.bindOrChangeMobile(c).then(()=>{R.success("手机号绑定成功"),s.visible=!1,fe()}):"email"===s.type&&F.bindOrChangeEmail(m).then(()=>{R.success("邮箱绑定成功"),s.visible=!1,fe()})},ne=()=>{s.visible=!1,"account"===s.type?t.value?.resetFields():"password"===s.type?r.value?.resetFields():"mobile"===s.type?i.value?.resetFields():"email"===s.type&&o.value?.resetFields()},ce=d(null),me=()=>{ce.value?.click()},pe=async e=>{const l=e.target,s=l.files?l.files[0]:null;if(s)try{const e=await W.uploadFile(s);await F.updateProfile({avatar:e.url}),a.userInfo.avatar=e.url}catch(t){R.error("头像上传失败")}},fe=async()=>{const e=await F.getProfile();l.value=e};return C(async()=>{y.value&&clearInterval(y.value),h.value&&clearInterval(h.value),await fe()}),(e,d)=>{const y=Y,h=I,j=q("Edit"),P=k,C=A,F=T,R=D,W=q("Male"),fe=q("Female"),ve=Q,be=G,ye=O,_e=N,ge=M,we=K,ke=J,he=z;return f(),p("div",ee,[x(ye,{gutter:20},{default:g(()=>[x(R,{span:8},{default:g(()=>[x(F,{class:"user-card"},{default:g(()=>[E("div",ae,[E("div",le,[x(y,{src:_(a).userInfo.avatar,size:100},null,8,["src"]),x(h,{type:"info",class:"avatar-edit-btn",circle:"",icon:_(S),size:"small",onClick:me},null,8,["icon"]),E("input",{ref_key:"fileInput",ref:ce,type:"file",style:{display:"none"},accept:"image/*",onChange:pe},null,544)]),E("div",se,[E("span",te,U(_(l).nickname),1),x(P,{class:"edit-icon",onClick:d[0]||(d[0]=e=>L("account"))},{default:g(()=>[x(j)]),_:1})]),E("div",re,U(_(l).roleNames),1)]),x(C),d[16]||(d[16]=E("div",{class:"user-stats"},[E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"待办")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"消息")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"通知")])],-1))]),_:1})]),_:1}),x(R,{span:16},{default:g(()=>[x(F,{class:"info-card"},{header:g(()=>[...d[17]||(d[17]=[E("div",{class:"card-header"},[E("span",null,"账号信息")],-1)])]),default:g(()=>[x(be,{column:1,border:""},{default:g(()=>[x(ve,{label:"用户名"},{default:g(()=>[Z(U(_(l).username)+" ",1),1===_(l).gender?(f(),v(P,{key:0,class:"gender-icon male"},{default:g(()=>[x(W)]),_:1})):(f(),v(P,{key:1,class:"gender-icon female"},{default:g(()=>[x(fe)]),_:1}))]),_:1}),x(ve,{label:"手机号码"},{default:g(()=>[Z(U(_(l).mobile||"未绑定")+" ",1),_(l).mobile?(f(),v(h,{key:0,type:"primary",link:"",onClick:d[1]||(d[1]=()=>L("mobile"))},{default:g(()=>[...d[18]||(d[18]=[Z(" 更换 ",-1)])]),_:1})):(f(),v(h,{key:1,type:"primary",link:"",onClick:d[2]||(d[2]=()=>L("mobile"))},{default:g(()=>[...d[19]||(d[19]=[Z(" 绑定 ",-1)])]),_:1}))]),_:1}),x(ve,{label:"邮箱"},{default:g(()=>[Z(U(_(l).email||"未绑定")+" ",1),_(l).email?(f(),v(h,{key:0,type:"primary",link:"",onClick:d[3]||(d[3]=()=>L("email"))},{default:g(()=>[...d[20]||(d[20]=[Z(" 更换 ",-1)])]),_:1})):(f(),v(h,{key:1,type:"primary",link:"",onClick:d[4]||(d[4]=()=>L("email"))},{default:g(()=>[...d[21]||(d[21]=[Z(" 绑定 ",-1)])]),_:1}))]),_:1}),x(ve,{label:"部门"},{default:g(()=>[Z(U(_(l).deptName),1)]),_:1}),x(ve,{label:"创建时间"},{default:g(()=>[Z(U(_(l).createTime),1)]),_:1})]),_:1})]),_:1}),x(F,{class:"security-card"},{header:g(()=>[...d[22]||(d[22]=[E("div",{class:"card-header"},[E("span",null,"安全设置")],-1)])]),default:g(()=>[E("div",ie,[d[24]||(d[24]=E("div",{class:"security-info"},[E("div",{class:"security-title"},"账户密码"),E("div",{class:"security-desc"},"定期修改密码有助于保护账户安全")],-1)),x(h,{type:"primary",link:"",onClick:d[5]||(d[5]=()=>L("password"))},{default:g(()=>[...d[23]||(d[23]=[Z(" 修改 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1}),x(he,{modelValue:_(s).visible,"onUpdate:modelValue":d[15]||(d[15]=e=>_(s).visible=e),title:_(s).title,width:500},{footer:g(()=>[E("span",oe,[x(h,{onClick:ne},{default:g(()=>[...d[25]||(d[25]=[Z("取消",-1)])]),_:1}),x(h,{type:"primary",onClick:ue},{default:g(()=>[...d[26]||(d[26]=[Z("确定",-1)])]),_:1})])]),default:g(()=>["account"===_(s).type?(f(),v(ke,{key:0,ref_key:"userProfileFormRef",ref:t,model:_(u),"label-width":100},{default:g(()=>[x(ge,{label:"昵称"},{default:g(()=>[x(_e,{modelValue:_(u).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>_(u).nickname=e)},null,8,["modelValue"])]),_:1}),x(ge,{label:"性别"},{default:g(()=>[x(we,{modelValue:_(u).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>_(u).gender=e),code:"gender"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):$("",!0),"password"===_(s).type?(f(),v(ke,{key:1,ref_key:"passwordChangeFormRef",ref:r,model:_(n),rules:V,"label-width":100},{default:g(()=>[x(ge,{label:"原密码",prop:"oldPassword"},{default:g(()=>[x(_e,{modelValue:_(n).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>_(n).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),x(ge,{label:"新密码",prop:"newPassword"},{default:g(()=>[x(_e,{modelValue:_(n).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>_(n).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),x(ge,{label:"确认密码",prop:"confirmPassword"},{default:g(()=>[x(_e,{modelValue:_(n).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>_(n).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):"mobile"===_(s).type?(f(),v(ke,{key:2,ref_key:"mobileBindingFormRef",ref:i,model:_(c),rules:B,"label-width":100},{default:g(()=>[x(ge,{label:"手机号码",prop:"mobile"},{default:g(()=>[x(_e,{modelValue:_(c).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>_(c).mobile=e),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),x(ge,{label:"验证码",prop:"code"},{default:g(()=>[x(_e,{modelValue:_(c).code,"onUpdate:modelValue":d[12]||(d[12]=e=>_(c).code=e),style:{width:"250px"}},{append:g(()=>[x(h,{disabled:_(b)>0,onClick:X},{default:g(()=>[Z(U(_(b)>0?`${_(b)}s后重新发送`:"发送验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):"email"===_(s).type?(f(),v(ke,{key:3,ref_key:"emailBindingFormRef",ref:o,model:_(m),rules:H,"label-width":100},{default:g(()=>[x(ge,{label:"邮箱",prop:"email"},{default:g(()=>[x(_e,{modelValue:_(m).email,"onUpdate:modelValue":d[13]||(d[13]=e=>_(m).email=e),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),x(ge,{label:"验证码",prop:"code"},{default:g(()=>[x(_e,{modelValue:_(m).code,"onUpdate:modelValue":d[14]||(d[14]=e=>_(m).code=e),style:{width:"250px"}},{append:g(()=>[x(h,{disabled:_(w)>0,onClick:de},{default:g(()=>[Z(U(_(w)>0?`${_(w)}s后重新发送`:"发送验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):$("",!0)]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-77100819"]]);export{de as default};
