import{d as e,r as l,W as a,J as t,o,aM as i,g as s,f as u,D as n,m as r,w as d,$ as c,ag as p,i as m,ah as f,ai as v,ac as g,e as h,h as b,aL as y,G as _,E as k,aU as V,aY as j,bV as w}from"./index.-2dSJvT_.js";import{v as x}from"./el-loading.DfcQG7DK.js";import{E as C}from"./el-drawer.CcqLZPAW.js";import{E}from"./el-tree.cbGAGcQx.js";import{E as U}from"./el-checkbox.5kbAoqEu.js";import"./el-text.B9WyMWJL.js";import"./el-tooltip.hAP85Bn3.js";import{E as S}from"./el-scrollbar.h6wvvJ8y.js";import{E as z}from"./el-dialog.Kkc-pGkQ.js";import{E as R}from"./el-input-number.Dw40aG4L.js";import{E as q,a as F,b as N,c as T}from"./el-select.D5K2M6II.js";import{E as B,a as I}from"./el-tag.CL_KEoGm.js";import{E as M}from"./el-card.BXatHMm7.js";import{_ as O}from"./index.oCg5ROL0.js";import{E as D,a as P}from"./el-table-column.CXF3oDjy.js";import{R as A}from"./role.api.DTGhN7tE.js";import{E as G}from"./index.6v8T4Dn9.js";import"./index.DNWtI2fw.js";import"./use-dialog.DWCABKHh.js";import"./index.tPmf0Yfg.js";import"./refs.Cw5r5QN8.js";import"./index.CsCgWOBa.js";import"./_baseIteratee.Jw5YRMh2.js";import"./index.od3oxRLs.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";const K={class:"app-container"},L={class:"search-bar"},J={class:"mb-10px"},Q={class:"dialog-footer"},W={class:"flex-x-between"},Y={class:"flex-center ml-5"},$={class:"dialog-footer"},H=e({name:"Role",inheritAttrs:!1,__name:"index",setup(e){const H=l(),X=l(),Z=l(),ee=l(!1),le=l([]),ae=l(0),te=a({pageNum:1,pageSize:10}),oe=l(),ie=l([]),se=a({title:"",visible:!1}),ue=a({sort:1,status:1}),ne=a({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),re=l({}),de=l(!1),ce=l(""),pe=l(!0),me=l(!0);function fe(){ee.value=!0,A.getPage(te).then(e=>{oe.value=e.list,ae.value=e.total}).finally(()=>{ee.value=!1})}function ve(){H.value.resetFields(),te.pageNum=1,fe()}function ge(e){le.value=e.map(e=>e.id)}function he(e){se.visible=!0,e?(se.title="修改角色",A.getFormData(e).then(e=>{Object.assign(ue,e)})):se.title="新增角色"}function be(){X.value.validate(e=>{if(e){ee.value=!0;const e=ue.id;e?A.update(e,ue).then(()=>{V.success("修改成功"),ye(),ve()}).finally(()=>ee.value=!1):A.create(ue).then(()=>{V.success("新增成功"),ye(),ve()}).finally(()=>ee.value=!1)}})}function ye(){se.visible=!1,X.value.resetFields(),X.value.clearValidate(),ue.id=void 0,ue.sort=1,ue.status=1}function _e(e){const l=[e||le.value].join(",");l?j.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ee.value=!0,A.deleteByIds(l).then(()=>{V.success("删除成功"),ve()}).finally(()=>ee.value=!1)},()=>{V.info("已取消删除")}):V.warning("请勾选删除项")}function ke(){const e=re.value.id;if(e){const l=Z.value.getCheckedNodes(!1,!0).map(e=>e.value);ee.value=!0,A.updateRoleMenus(e,l).then(()=>{V.success("分配权限成功"),de.value=!1,ve()}).finally(()=>{ee.value=!1})}}function Ve(){pe.value=!pe.value,Z.value&&Object.values(Z.value.store.nodesMap).forEach(e=>{pe.value?e.expand():e.collapse()})}function je(e,l){return!e||l.label.includes(e)}function we(e){me.value=e}return t(ce,e=>{Z.value.filter(e)}),o(()=>{fe()}),(e,l)=>{const a=c,t=B,o=f,V=I,j=P,xe=G,Ce=D,Ee=O,Ue=M,Se=F,ze=q,Re=T,qe=N,Fe=R,Ne=z,Te=i("Search"),Be=i("Switch"),Ie=U,Me=i("QuestionFilled"),Oe=k,De=S,Pe=E,Ae=C,Ge=x;return u(),s("div",K,[n("div",L,[r(V,{ref_key:"queryFormRef",ref:H,model:m(te),inline:!0},{default:d(()=>[r(t,{prop:"keywords",label:"关键字"},{default:d(()=>[r(a,{modelValue:m(te).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>m(te).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:p(fe,["enter"])},null,8,["modelValue"])]),_:1}),r(t,null,{default:d(()=>[r(o,{type:"primary",icon:"search",onClick:fe},{default:d(()=>[...l[16]||(l[16]=[v("搜索",-1)])]),_:1}),r(o,{icon:"refresh",onClick:ve},{default:d(()=>[...l[17]||(l[17]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),r(Ue,{shadow:"never"},{default:d(()=>[n("div",J,[r(o,{type:"success",icon:"plus",onClick:l[1]||(l[1]=e=>he())},{default:d(()=>[...l[18]||(l[18]=[v("新增",-1)])]),_:1}),r(o,{type:"danger",disabled:0===m(le).length,icon:"delete",onClick:l[2]||(l[2]=e=>_e())},{default:d(()=>[...l[19]||(l[19]=[v(" 删除 ",-1)])]),_:1},8,["disabled"])]),g((u(),h(Ce,{ref:"dataTableRef",data:m(oe),"highlight-current-row":"",border:"",onSelectionChange:ge},{default:d(()=>[r(j,{type:"selection",width:"55",align:"center"}),r(j,{label:"角色名称",prop:"name","min-width":"100"}),r(j,{label:"角色编码",prop:"code",width:"150"}),r(j,{label:"状态",align:"center",width:"100"},{default:d(e=>[1===e.row.status?(u(),h(xe,{key:0,type:"success"},{default:d(()=>[...l[20]||(l[20]=[v("正常",-1)])]),_:1})):(u(),h(xe,{key:1,type:"info"},{default:d(()=>[...l[21]||(l[21]=[v("禁用",-1)])]),_:1}))]),_:1}),r(j,{label:"排序",align:"center",width:"80",prop:"sort"}),r(j,{fixed:"right",label:"操作",width:"220"},{default:d(e=>[r(o,{type:"primary",size:"small",link:"",icon:"position",onClick:l=>async function(e){const l=e.id;l&&(de.value=!0,ee.value=!0,re.value.id=l,re.value.name=e.name,ie.value=await w.getOptions(),A.getRoleMenuIds(l).then(e=>{e.forEach(e=>Z.value.setChecked(e,!0,!1))}).finally(()=>{ee.value=!1}))}(e.row)},{default:d(()=>[...l[22]||(l[22]=[v(" 分配权限 ",-1)])]),_:1},8,["onClick"]),r(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:l=>he(e.row.id)},{default:d(()=>[...l[23]||(l[23]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),r(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:l=>_e(e.row.id)},{default:d(()=>[...l[24]||(l[24]=[v(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ge,m(ee)]]),m(ae)>0?(u(),h(Ee,{key:0,total:m(ae),"onUpdate:total":l[3]||(l[3]=e=>y(ae)?ae.value=e:null),page:m(te).pageNum,"onUpdate:page":l[4]||(l[4]=e=>m(te).pageNum=e),limit:m(te).pageSize,"onUpdate:limit":l[5]||(l[5]=e=>m(te).pageSize=e),onPagination:fe},null,8,["total","page","limit"])):b("",!0)]),_:1}),r(Ne,{modelValue:m(se).visible,"onUpdate:modelValue":l[11]||(l[11]=e=>m(se).visible=e),title:m(se).title,width:"500px",onClose:ye},{footer:d(()=>[n("div",Q,[r(o,{type:"primary",onClick:be},{default:d(()=>[...l[27]||(l[27]=[v("确 定",-1)])]),_:1}),r(o,{onClick:ye},{default:d(()=>[...l[28]||(l[28]=[v("取 消",-1)])]),_:1})])]),default:d(()=>[r(V,{ref_key:"roleFormRef",ref:X,model:m(ue),rules:m(ne),"label-width":"100px"},{default:d(()=>[r(t,{label:"角色名称",prop:"name"},{default:d(()=>[r(a,{modelValue:m(ue).name,"onUpdate:modelValue":l[6]||(l[6]=e=>m(ue).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),r(t,{label:"角色编码",prop:"code"},{default:d(()=>[r(a,{modelValue:m(ue).code,"onUpdate:modelValue":l[7]||(l[7]=e=>m(ue).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])]),_:1}),r(t,{label:"数据权限",prop:"dataScope"},{default:d(()=>[r(ze,{modelValue:m(ue).dataScope,"onUpdate:modelValue":l[8]||(l[8]=e=>m(ue).dataScope=e)},{default:d(()=>[(u(),h(Se,{key:1,label:"全部数据",value:1})),(u(),h(Se,{key:2,label:"部门及子部门数据",value:2})),(u(),h(Se,{key:3,label:"本部门数据",value:3})),(u(),h(Se,{key:4,label:"本人数据",value:4}))]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"状态",prop:"status"},{default:d(()=>[r(qe,{modelValue:m(ue).status,"onUpdate:modelValue":l[9]||(l[9]=e=>m(ue).status=e)},{default:d(()=>[r(Re,{value:1},{default:d(()=>[...l[25]||(l[25]=[v("正常",-1)])]),_:1}),r(Re,{value:0},{default:d(()=>[...l[26]||(l[26]=[v("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"排序",prop:"sort"},{default:d(()=>[r(Fe,{modelValue:m(ue).sort,"onUpdate:modelValue":l[10]||(l[10]=e=>m(ue).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),r(Ae,{modelValue:m(de),"onUpdate:modelValue":l[15]||(l[15]=e=>y(de)?de.value=e:null),title:"【"+m(re).name+"】权限分配",size:"500"},{footer:d(()=>[n("div",$,[r(o,{type:"primary",onClick:ke},{default:d(()=>[...l[31]||(l[31]=[v("确 定",-1)])]),_:1}),r(o,{onClick:l[14]||(l[14]=e=>de.value=!1)},{default:d(()=>[...l[32]||(l[32]=[v("取 消",-1)])]),_:1})])]),default:d(()=>[n("div",W,[r(a,{modelValue:m(ce),"onUpdate:modelValue":l[12]||(l[12]=e=>y(ce)?ce.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:d(()=>[r(Te)]),_:1},8,["modelValue"]),n("div",Y,[r(o,{type:"primary",size:"small",plain:"",onClick:Ve},{icon:d(()=>[r(Be)]),default:d(()=>[v(" "+_(m(pe)?"收缩":"展开"),1)]),_:1}),r(Ie,{modelValue:m(me),"onUpdate:modelValue":l[13]||(l[13]=e=>y(me)?me.value=e:null),class:"ml-5",onChange:we},{default:d(()=>[...l[29]||(l[29]=[v(" 父子联动 ",-1)])]),_:1},8,["modelValue"]),r(De,{placement:"bottom"},{content:d(()=>[...l[30]||(l[30]=[v(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ",-1)])]),default:d(()=>[r(Oe,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:d(()=>[r(Me)]),_:1})]),_:1})])]),r(Pe,{ref_key:"permTreeRef",ref:Z,"node-key":"value","show-checkbox":"",data:m(ie),"filter-node-method":je,"default-expand-all":!0,"check-strictly":!m(me),class:"mt-5"},{default:d(({data:e})=>[v(_(e.label),1)]),_:1},8,["data","check-strictly"])]),_:1},8,["modelValue","title"])])}}});export{H as default};
