import{d as e,r as a,W as l,o as t,g as u,f as o,D as s,m as r,w as d,$ as n,ag as i,ah as p,ai as c,ac as m,e as f,h as v,b7 as b,G as _,bA as y,aS as g,bB as h,aJ as w}from"./index.Dv9sjPYC.js";import{v as k}from"./loading.S8LTmobk.js";import{E as x,a as j}from"./descriptions-item.Dx4SZjwy.js";import{E as S}from"./card.UCV2TBx1.js";import{_ as V}from"./index.D-M2h4YD.js";import{a as A,E as T}from"./table-column.D28nzGFS.js";import"./checkbox.Cq-dvxYE.js";/* empty css                */import"./popper.m2lNosSJ.js";import"./scrollbar.DQblMs23.js";import{E as C,a as I}from"./form-item.DgRMSZzs.js";import{E as U}from"./date-picker-panel.BOvuOK0w.js";import{E as D,a as N}from"./select.D46WCvpG.js";import"./pagination.CWkEuBr5.js";import"./_baseClone.Br4BWTY9.js";import"./omit.B6E_lyF8.js";import"./_baseIteratee.DbpbFJtj.js";import"./castArray.D1K_WIrw.js";import"./debounce.CITkvERZ.js";import"./toNumber.P9ps2NTq.js";import"./raf.B6j8aosc.js";import"./dayjs.min.nvYJnoDs.js";import"./index.BlULC2eY.js";import"./index.8lkWLndA.js";import"./strings.BtizHOxT.js";const z={class:"app-container"},E={class:"search-container"},R={key:1},M={key:1},q={key:0},F={key:1},P={key:0},Y={key:1},J={key:1},O={key:1},G={key:0},K={key:1},B=w(e({name:"AiCommandRecord",inheritAttrs:!1,__name:"index",setup(e){const w=a(),B=a(!1),Q=a(0),W=l({pageNum:1,pageSize:10,keywords:"",provider:"",model:"",parseSuccess:void 0,executeStatus:"",isDangerous:void 0,createTime:["",""]}),$=a([]),H=a(!1),L=a(),X={pending:"待执行",success:"成功",failed:"失败"},Z={pending:"info",success:"success",failed:"danger"};function ee(){B.value=!0,h.getCommandRecordPage(W).then(e=>{$.value=e.list||[],Q.value=e.total||0}).finally(()=>{B.value=!1})}function ae(){W.pageNum=1,ee()}function le(){w.value?.resetFields(),W.pageNum=1,ee()}function te(e){if(!e)return"-";try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}}function ue(e){return null==e||""===e?"-":e}return t(()=>{ee()}),(e,a)=>{const l=n,t=C,h=N,oe=D,se=U,re=p,de=I,ne=T,ie=b,pe=A,ce=V,me=S,fe=j,ve=y,be=x,_e=g,ye=k;return o(),u("div",z,[s("div",E,[r(de,{ref_key:"queryFormRef",ref:w,model:W,inline:!0},{default:d(()=>[r(t,{prop:"keywords",label:"关键字"},{default:d(()=>[r(l,{modelValue:W.keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>W.keywords=e),placeholder:"原始命令/函数名称/用户名",clearable:"",style:{width:"220px"},onKeyup:i(ae,["enter"])},null,8,["modelValue"])]),_:1}),r(t,{prop:"provider",label:"AI提供商"},{default:d(()=>[r(oe,{modelValue:W.provider,"onUpdate:modelValue":a[1]||(a[1]=e=>W.provider=e),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:d(()=>[r(h,{label:"通义千问",value:"qwen"}),r(h,{label:"OpenAI",value:"openai"}),r(h,{label:"DeepSeek",value:"deepseek"}),r(h,{label:"Gemini",value:"gemini"})]),_:1},8,["modelValue"])]),_:1}),r(t,{prop:"model",label:"AI模型"},{default:d(()=>[r(l,{modelValue:W.model,"onUpdate:modelValue":a[2]||(a[2]=e=>W.model=e),placeholder:"如 qwen-plus",clearable:"",style:{width:"160px"},onKeyup:i(ae,["enter"])},null,8,["modelValue"])]),_:1}),r(t,{prop:"parseSuccess",label:"解析状态"},{default:d(()=>[r(oe,{modelValue:W.parseSuccess,"onUpdate:modelValue":a[3]||(a[3]=e=>W.parseSuccess=e),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:d(()=>[r(h,{label:"成功",value:!0}),r(h,{label:"失败",value:!1})]),_:1},8,["modelValue"])]),_:1}),r(t,{prop:"executeStatus",label:"执行状态"},{default:d(()=>[r(oe,{modelValue:W.executeStatus,"onUpdate:modelValue":a[4]||(a[4]=e=>W.executeStatus=e),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:d(()=>[r(h,{label:"待执行",value:"pending"}),r(h,{label:"成功",value:"success"}),r(h,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),r(t,{prop:"isDangerous",label:"风险操作"},{default:d(()=>[r(oe,{modelValue:W.isDangerous,"onUpdate:modelValue":a[5]||(a[5]=e=>W.isDangerous=e),placeholder:"请选择",clearable:"",style:{width:"140px"}},{default:d(()=>[r(h,{label:"是",value:!0}),r(h,{label:"否",value:!1})]),_:1},8,["modelValue"])]),_:1}),r(t,{prop:"createTime",label:"创建时间"},{default:d(()=>[r(se,{modelValue:W.createTime,"onUpdate:modelValue":a[6]||(a[6]=e=>W.createTime=e),editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD",style:{width:"260px"}},null,8,["modelValue"])]),_:1}),r(t,{class:"search-buttons"},{default:d(()=>[r(re,{type:"primary",icon:"Search",onClick:ae},{default:d(()=>[...a[12]||(a[12]=[c("搜索",-1)])]),_:1}),r(re,{icon:"Refresh",onClick:le},{default:d(()=>[...a[13]||(a[13]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),r(me,{shadow:"hover",class:"data-table"},{default:d(()=>[m((o(),f(pe,{data:$.value,"highlight-current-row":"",border:"",class:"data-table__content"},{default:d(()=>[r(ne,{label:"创建时间",prop:"createTime",width:"180"}),r(ne,{label:"用户名",prop:"username",width:"120"}),r(ne,{label:"原始命令",prop:"originalCommand","min-width":"220","show-overflow-tooltip":""}),r(ne,{label:"函数名称",prop:"functionName","min-width":"160","show-overflow-tooltip":""}),r(ne,{label:"AI提供商",prop:"provider",width:"120"}),r(ne,{label:"AI模型",prop:"model",width:"160","show-overflow-tooltip":""}),r(ne,{label:"解析状态",width:"110",align:"center"},{default:d(({row:e})=>[r(ie,{type:e.parseSuccess?"success":"danger",size:"small"},{default:d(()=>[c(_(e.parseSuccess?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),r(ne,{label:"执行状态",width:"110",align:"center"},{default:d(({row:e})=>[e.executeStatus?(o(),f(ie,{key:0,type:Z[e.executeStatus],size:"small"},{default:d(()=>[c(_(X[e.executeStatus]),1)]),_:2},1032,["type"])):(o(),u("span",R,"-"))]),_:1}),r(ne,{label:"风险",width:"90",align:"center"},{default:d(({row:e})=>[e.isDangerous?(o(),f(ie,{key:0,type:"warning",size:"small"},{default:d(()=>[...a[14]||(a[14]=[c("风险",-1)])]),_:1})):(o(),u("span",M,"-"))]),_:1}),r(ne,{label:"置信度",prop:"confidence",width:"100",align:"center"},{default:d(({row:e})=>[void 0!==e.confidence&&null!==e.confidence?(o(),u("span",q,_((100*e.confidence).toFixed(0))+"% ",1)):(o(),u("span",F,"-"))]),_:1}),r(ne,{label:"解析耗时(ms)",prop:"parseTime",width:"120",align:"center"}),r(ne,{label:"执行耗时(ms)",prop:"executionTime",width:"120",align:"center"}),r(ne,{label:"IP地址",prop:"ipAddress",width:"140"}),r(ne,{label:"操作",width:"100",align:"center",fixed:"right"},{default:d(({row:e})=>[r(re,{type:"primary",link:"",size:"small",onClick:a=>function(e){L.value=e,H.value=!0}(e)},{default:d(()=>[...a[15]||(a[15]=[c(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,B.value]]),Q.value>0?(o(),f(ce,{key:0,total:Q.value,"onUpdate:total":a[7]||(a[7]=e=>Q.value=e),page:W.pageNum,"onUpdate:page":a[8]||(a[8]=e=>W.pageNum=e),limit:W.pageSize,"onUpdate:limit":a[9]||(a[9]=e=>W.pageSize=e),onPagination:ee},null,8,["total","page","limit"])):v("",!0)]),_:1}),r(_e,{modelValue:H.value,"onUpdate:modelValue":a[11]||(a[11]=e=>H.value=e),title:"AI 命令记录详情",width:"880px","append-to-body":""},{footer:d(()=>[r(re,{onClick:a[10]||(a[10]=e=>H.value=!1)},{default:d(()=>[...a[17]||(a[17]=[c("关闭",-1)])]),_:1})]),default:d(()=>[L.value?(o(),f(be,{key:0,column:2,border:""},{default:d(()=>[r(fe,{label:"记录ID"},{default:d(()=>[c(_(L.value.id),1)]),_:1}),r(fe,{label:"用户名"},{default:d(()=>[c(_(L.value.username),1)]),_:1}),r(fe,{label:"AI提供商"},{default:d(()=>[c(_(L.value.provider||"-"),1)]),_:1}),r(fe,{label:"AI模型"},{default:d(()=>[c(_(L.value.model||"-"),1)]),_:1}),r(fe,{label:"解析状态"},{default:d(()=>[r(ie,{type:L.value.parseSuccess?"success":"danger",size:"small"},{default:d(()=>[c(_(L.value.parseSuccess?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),r(fe,{label:"置信度"},{default:d(()=>[void 0!==L.value.confidence&&null!==L.value.confidence?(o(),u("span",P,_((100*L.value.confidence).toFixed(0))+"% ",1)):(o(),u("span",Y,"-"))]),_:1}),r(fe,{label:"解析耗时"},{default:d(()=>[c(_(ue(L.value.parseTime))+" ms ",1)]),_:1}),r(fe,{label:"Token统计"},{default:d(()=>[c(" 输入 "+_(L.value.inputTokens||0)+" / 输出 "+_(L.value.outputTokens||0)+" / 总计 "+_(L.value.totalTokens||0),1)]),_:1}),r(fe,{label:"原始命令",span:2},{default:d(()=>[r(l,{"model-value":L.value.originalCommand,type:"textarea",rows:2,readonly:""},null,8,["model-value"])]),_:1}),L.value.explanation?(o(),f(fe,{key:0,label:"AI说明",span:2},{default:d(()=>[c(_(L.value.explanation),1)]),_:1})):v("",!0),L.value.functionCalls?(o(),f(fe,{key:1,label:"函数调用",span:2},{default:d(()=>[r(l,{"model-value":te(L.value.functionCalls),type:"textarea",rows:6,readonly:""},null,8,["model-value"])]),_:1})):v("",!0),L.value.parseErrorMessage?(o(),f(fe,{key:2,label:"解析错误",span:2},{default:d(()=>[r(ve,{title:L.value.parseErrorMessage,type:"error",closable:!1},null,8,["title"])]),_:1})):v("",!0),r(fe,{label:"函数名称"},{default:d(()=>[c(_(L.value.functionName||"-"),1)]),_:1}),r(fe,{label:"执行状态"},{default:d(()=>[L.value.executeStatus?(o(),f(ie,{key:0,type:Z[L.value.executeStatus],size:"small"},{default:d(()=>[c(_(X[L.value.executeStatus]),1)]),_:1},8,["type"])):(o(),u("span",J,"-"))]),_:1}),r(fe,{label:"执行耗时"},{default:d(()=>[c(_(ue(L.value.executionTime))+" ms ",1)]),_:1}),r(fe,{label:"影响行数"},{default:d(()=>[c(_(ue(L.value.affectedRows)),1)]),_:1}),L.value.functionArguments?(o(),f(fe,{key:3,label:"执行参数",span:2},{default:d(()=>[r(l,{"model-value":te(L.value.functionArguments),type:"textarea",rows:4,readonly:""},null,8,["model-value"])]),_:1})):v("",!0),L.value.executeResult?(o(),f(fe,{key:4,label:"执行结果",span:2},{default:d(()=>[r(l,{"model-value":te(L.value.executeResult),type:"textarea",rows:4,readonly:""},null,8,["model-value"])]),_:1})):v("",!0),L.value.executeErrorMessage?(o(),f(fe,{key:5,label:"执行错误",span:2},{default:d(()=>[r(ve,{title:L.value.executeErrorMessage,type:"error",closable:!1},null,8,["title"])]),_:1})):v("",!0),r(fe,{label:"风险操作"},{default:d(()=>[L.value.isDangerous?(o(),f(ie,{key:0,type:"warning",size:"small"},{default:d(()=>[...a[16]||(a[16]=[c("风险操作",-1)])]),_:1})):(o(),u("span",O,"-"))]),_:1}),r(fe,{label:"是否确认"},{default:d(()=>[L.value.requiresConfirmation?(o(),u("span",G,_(L.value.userConfirmed?"已确认":"待确认"),1)):(o(),u("span",K,"-"))]),_:1}),r(fe,{label:"IP地址"},{default:d(()=>[c(_(L.value.ipAddress||"-"),1)]),_:1}),r(fe,{label:"页面路由"},{default:d(()=>[c(_(L.value.currentRoute||"-"),1)]),_:1}),r(fe,{label:"User-Agent",span:2},{default:d(()=>[c(_(L.value.userAgent||"-"),1)]),_:1}),r(fe,{label:"创建时间"},{default:d(()=>[c(_(L.value.createTime),1)]),_:1}),r(fe,{label:"更新时间"},{default:d(()=>[c(_(L.value.updateTime||"-"),1)]),_:1}),r(fe,{label:"备注",span:2},{default:d(()=>[c(_(L.value.remark||"-"),1)]),_:1})]),_:1})):v("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c37905bb"]]);export{B as default};
