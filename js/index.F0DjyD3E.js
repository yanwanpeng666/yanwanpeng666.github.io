import{d as e,r as l,S as a,aT as o,I as t,ax as u,o as n,ae as i,e as d,h as r,B as s,l as m,w as p,g as f,W as c,X as v,V as h,f as b,p as g,aj as y,D as w,$ as V,Q as _,R as j,aU as k,U as N,aV as U,aW as C,E as x}from"./index.BpxBvkg6.js";import{v as E}from"./el-loading.Ckdo4-xF.js";import{E as S}from"./el-drawer.6_yK94Ed.js";import"./el-overlay.BFPSRcdb.js";import{E as I}from"./el-link.Dioijf7e.js";import{E as T}from"./el-scrollbar.CK5T237J.js";import{E as q}from"./el-tree.BnON9R1v.js";import{E as F}from"./el-checkbox.Cx2Qfsbr.js";import{_ as Q}from"./index.DoMFwLGe.js";/* empty css               */import{E as R,a as L}from"./el-select.8K-AN9hS.js";import{E as z}from"./el-popper.SJe5T32R.js";import{E as W}from"./el-tree-select.DdAZLgVX.js";import"./el-tooltip.l0sNRNKZ.js";import{a as G,E as A}from"./el-col.CjvKnLzd.js";import{F as D,E as B,a as M,S as P}from"./FormTypeEnum.56zzV1q7.js";import{E as $}from"./el-card.BTP4EuJ3.js";import{_ as O}from"./index.CFcbfxSQ.js";import{E as X,a as H}from"./el-table-column.DNWzwYtN.js";import{E as K,a as Y}from"./el-form-item.CxywRNiP.js";import{E as Z}from"./el-button.C6IsoxHh.js";import{E as J}from"./el-input.eKHZd0Zj.js";import{Q as ee,G as le}from"./index.CJJKyoey.js";import{E as ae}from"./el-message-box.W8NNTKNI.js";import"./index.CMMidXFv.js";import"./index.r1onNpzy.js";import"./vnode.70VA7JcV.js";import"./event.CIKxL71l.js";import"./use-form-item.DHnwY37Z.js";import"./scroll.Bzt3SYYQ.js";import"./index.B_DhyVRv.js";import"./token.DWNpOE8r.js";import"./index.GNe710hF.js";import"./isEqual.Ow3Z9Fhn.js";import"./_Uint8Array.CFvYgvXX.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.PM9aGSXQ.js";import"./strings.CcvLkPOn.js";import"./castArray.iOOpqcij.js";import"./index.DhqT0CfD.js";import"./debounce.Cyc6wZO_.js";import"./_baseIteratee.CCCpDyS7.js";import"./index.1_ZPQ0em.js";import"./index.Dr94w0zg.js";import"./el-pagination.B0qiGXMa.js";import"./index.tqjEEzm2.js";import"./validator.DNcJ3ITu.js";const oe={class:"app-container"},te={class:"search-bar"},ue={class:"mt-5"},ne={class:"flex-y-between"},ie={class:"elTableCustom"},de={class:"flex-y-center"},re={class:"flex-y-center"},se={class:"flex-y-center"},me={key:1},pe={key:1},fe={key:1},ce={key:1},ve={class:"ml-1"},he={class:"absolute-rt z-36 right-5 top-2"},be=e({name:"Codegen",__name:"index",setup(e){const be=l([]),ge=l(K),ye=a({pageNum:1,pageSize:10}),we=l(!1),Ve=l("loading..."),_e=l([]),je=l(0),ke=D,Ne=ee,Ue=l(),Ce=l([]),xe=l({fieldConfigs:[]}),Ee={tableName:[{required:!0,message:"请输入表名",trigger:"blur"}],businessName:[{required:!0,message:"请输入业务名",trigger:"blur"}],packageName:[{required:!0,message:"请输入包名",trigger:"blur"}],moduleName:[{required:!0,message:"请输入模块名",trigger:"blur"}],entityName:[{required:!0,message:"请输入实体名",trigger:"blur"}]},Se=a({visible:!1,title:""}),{copy:Ie,copied:Te}=o(),qe=l(),Fe=l(),Qe={mode:"text/javascript"},Re=l(""),Le=l("下一步，字段配置"),ze=l(0),We=l(""),Ge=l(),Ae=l(!1),De=l(!1),Be=l(!1);t(ze,(e=>{0===e?Le.value="下一步，字段配置":1===e?(Re.value="上一步，基础配置",Le.value="下一步，确认生成"):2===e&&(Re.value="上一步，字段配置",Le.value="下载代码")})),t(Te,(()=>{Te.value&&u.success("复制成功")})),t((()=>xe.value.fieldConfigs),(e=>{e.forEach((e=>{e.fieldType&&e.fieldType.includes("Date")&&1===e.isShowInQuery&&(e.queryType=ee.BETWEEN.value)}))}),{deep:!0,immediate:!0});const Me=()=>{if(Ge.value)return;const e=document.querySelector(".elTableCustom .el-table__body-wrapper tbody");Ge.value=P.create(e,{group:"shared",animation:150,ghostClass:"sortable-ghost",handle:".sortable-handle",easing:"cubic-bezier(1, 0, 0, 1)",onStart:e=>{},onEnd:e=>{Pe(e.oldIndex,e.newIndex)}})},Pe=(e,l)=>{let a=Object.assign([],xe.value.fieldConfigs);const o=a.splice(e,1)[0];a.splice(l,0,o),a.forEach(((e,l)=>{e.fieldSort=l+1})),xe.value.fieldConfigs=[],N((async()=>{xe.value.fieldConfigs=a}))};function $e(){2===ze.value&&(xe.value={fieldConfigs:[]},N((()=>{we.value=!0,le.getGenConfig(We.value).then((e=>{xe.value=e})).finally((()=>{we.value=!1}))})),Me()),ze.value--<=0&&(ze.value=0)}function Oe(){if(0===ze.value){const{tableName:e,packageName:l,businessName:a,moduleName:o,entityName:t}=xe.value;if(!(e&&l&&a&&o&&t))return void u.error("表名、业务名、包名、模块名、实体名不能为空");Me()}if(1===ze.value){const e=xe.value.tableName;if(!e)return void u.error("表名不能为空");we.value=!0,Ve.value="代码生成中，请稍后...",le.saveGenConfig(e,xe.value).then((()=>{Ze(e)})).then((()=>{ze.value++>=2&&(ze.value=2)})).finally((()=>{we.value=!1,Ve.value="loading..."}))}else if(ze.value++>=2&&(ze.value=2),2===ze.value){const e=xe.value.tableName;if(!e)return void u.error("表名不能为空");le.download(e)}}function Xe(){we.value=!0,le.getTablePage(ye).then((e=>{_e.value=e.list,je.value=e.total})).finally((()=>{we.value=!1}))}function He(){ge.value.resetFields(),ye.pageNum=1,Xe()}const Ke=(e,l)=>{var a;const o=null==(a=xe.value)?void 0:a.fieldConfigs;o&&o.forEach((a=>{a[e]=l?1:0}))},Ye=(e,l)=>{var a;const o=(null==(a=xe.value)?void 0:a.fieldConfigs)||[];l.value=o.every((l=>1===l[e]))};function Ze(e){be.value=[],le.getPreviewData(e).then((l=>{Se.title=`代码生成 ${e}`;const a=function(e){const l={label:"前后端代码",children:[]};return e.forEach((e=>{var a;const o=e.path.includes("/")?"/":"\\",t=e.path.split(o),u=["src"+o+"main","java",xe.value.backendAppName,xe.value.frontendAppName,(xe.value.packageName+"."+xe.value.moduleName).replace(/\./g,o)],n=[];let i=[];t.forEach((e=>{i.push(e);const l=i.join(o);u.includes(l)&&(n.push(l),i=[])})),n.forEach(((e,l)=>{n[l]=e.replace(/\\/g,"/")})),i.length>0&&n.push(...i);let d=l;n.forEach((e=>{var l,a;let o=null==(l=d.children)?void 0:l.find((l=>l.label===e));o||(o={label:e,children:[]},null==(a=d.children)||a.push(o)),d=o})),null==(a=d.children)||a.push({label:e.fileName,content:null==e?void 0:e.content})})),l}(l);be.value=[a];const o=Je(a);o&&(qe.value=o.content||"")})).catch((()=>{ze.value=0}))}function Je(e){if(!e.children||0===e.children.length)return e;for(const l of e.children){const e=Je(l);if(e)return e}return null}function el(e){e.children&&0!==e.children.length||(qe.value=e.content||"")}const ll=()=>{qe.value&&Ie(qe.value)};return n((()=>{var e;Xe(),null==(e=Fe.value)||e.destroy()})),(e,l)=>{const a=J,o=Y,t=i("Search"),n=Z,N=i("Refresh"),P=K,ee=X,Ie=i("MagicStick"),Te=i("RefreshLeft"),Ge=H,Me=O,Pe=$,Je=B,al=M,ol=G,tl=A,ul=i("QuestionFilled"),nl=x,il=z,dl=W,rl=i("Rank"),sl=F,ml=R,pl=L,fl=Q,cl=q,vl=T,hl=i("CopyDocument"),bl=I,gl=i("Back"),yl=i("Right"),wl=i("Download"),Vl=S,_l=E;return d(),r("div",oe,[s("div",te,[m(P,{ref_key:"queryFormRef",ref:ge,model:f(ye),inline:!0},{default:p((()=>[m(o,{prop:"keywords",label:"关键字"},{default:p((()=>[m(a,{modelValue:f(ye).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>f(ye).keywords=e),placeholder:"表名",clearable:"",onKeyup:c(Xe,["enter"])},null,8,["modelValue"])])),_:1}),m(o,null,{default:p((()=>[m(n,{type:"primary",onClick:Xe},{icon:p((()=>[m(t)])),default:p((()=>[l[20]||(l[20]=v(" 搜索 "))])),_:1}),m(n,{onClick:He},{icon:p((()=>[m(N)])),default:p((()=>[l[21]||(l[21]=v(" 重置 "))])),_:1})])),_:1})])),_:1},8,["model"])]),m(Pe,{shadow:"never",class:"table-container"},{default:p((()=>[h((d(),b(Ge,{ref:"dataTableRef",data:f(_e),"highlight-current-row":"",border:""},{default:p((()=>[m(ee,{type:"selection",width:"55",align:"center"}),m(ee,{label:"表名",prop:"tableName","min-width":"100"}),m(ee,{label:"描述",prop:"tableComment",width:"150"}),m(ee,{label:"存储引擎",align:"center",prop:"engine"}),m(ee,{label:"排序规则",align:"center",prop:"tableCollation"}),m(ee,{label:"创建时间",align:"center",prop:"createTime"}),m(ee,{fixed:"right",label:"操作",width:"200"},{default:p((e=>[m(n,{type:"primary",size:"small",link:"",onClick:l=>async function(e){Se.visible=!0,ze.value=0,Ce.value=await U.getOptions(!0),We.value=e,C.getList().then((l=>{Ue.value=l.map((e=>({label:e.name,value:e.dictCode}))),we.value=!0,le.getGenConfig(e).then((l=>{Se.title=`${e} 代码生成`,xe.value=l,Ye("isShowInQuery",Ae),Ye("isShowInList",De),Ye("isShowInForm",Be),xe.value.id?(ze.value=2,Ze(e)):ze.value=0})).finally((()=>{we.value=!1}))}))}(e.row.tableName)},{icon:p((()=>[m(Ie)])),default:p((()=>[l[22]||(l[22]=v(" 生成代码 "))])),_:2},1032,["onClick"]),1===e.row.isConfigured?(d(),b(n,{key:0,type:"danger",size:"small",link:"",onClick:l=>{return a=e.row.tableName,void ae.confirm("确定要重置配置吗？","提示",{type:"warning"}).then((()=>{le.resetGenConfig(a).then((()=>{u.success("重置成功"),Xe()}))}));var a}},{icon:p((()=>[m(Te)])),default:p((()=>[l[23]||(l[23]=v(" 重置配置 "))])),_:2},1032,["onClick"])):g("",!0)])),_:1})])),_:1},8,["data"])),[[_l,f(we)]]),f(je)>0?(d(),b(Me,{key:0,total:f(je),"onUpdate:total":l[1]||(l[1]=e=>y(je)?je.value=e:null),page:f(ye).pageNum,"onUpdate:page":l[2]||(l[2]=e=>f(ye).pageNum=e),limit:f(ye).pageSize,"onUpdate:limit":l[3]||(l[3]=e=>f(ye).pageSize=e),onPagination:Xe},null,8,["total","page","limit"])):g("",!0)])),_:1}),m(Vl,{modelValue:f(Se).visible,"onUpdate:modelValue":l[18]||(l[18]=e=>f(Se).visible=e),title:f(Se).title,size:"80%",onClose:l[19]||(l[19]=e=>f(Se).visible=!1)},{footer:p((()=>[0!==f(ze)?(d(),b(n,{key:0,type:"success",onClick:$e},{default:p((()=>[m(nl,null,{default:p((()=>[m(gl)])),_:1}),v(" "+w(f(Re)),1)])),_:1})):g("",!0),m(n,{type:"primary",onClick:Oe},{default:p((()=>[v(w(f(Le))+" ",1),2!==f(ze)?(d(),b(nl,{key:0},{default:p((()=>[m(yl)])),_:1})):(d(),b(nl,{key:1},{default:p((()=>[m(wl)])),_:1}))])),_:1})])),default:p((()=>[m(al,{active:f(ze),"align-center":"","finish-status":"success",simple:""},{default:p((()=>[m(Je,{title:"基础配置"}),m(Je,{title:"字段配置"}),m(Je,{title:"预览生成"})])),_:1},8,["active"]),s("div",ue,[h(m(P,{model:f(xe),"label-width":100,rules:Ee},{default:p((()=>[m(tl,null,{default:p((()=>[m(ol,{span:12},{default:p((()=>[m(o,{label:"表名",prop:"tableName"},{default:p((()=>[m(a,{modelValue:f(xe).tableName,"onUpdate:modelValue":l[4]||(l[4]=e=>f(xe).tableName=e),readonly:""},null,8,["modelValue"])])),_:1})])),_:1}),m(ol,{span:12},{default:p((()=>[m(o,{label:"业务名",prop:"businessName"},{default:p((()=>[m(a,{modelValue:f(xe).businessName,"onUpdate:modelValue":l[5]||(l[5]=e=>f(xe).businessName=e),placeholder:"用户"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(tl,null,{default:p((()=>[m(ol,{span:12},{default:p((()=>[m(o,{label:"包名",prop:"packageName"},{default:p((()=>[m(a,{modelValue:f(xe).packageName,"onUpdate:modelValue":l[6]||(l[6]=e=>f(xe).packageName=e),placeholder:"com.youlai.boot"},null,8,["modelValue"])])),_:1})])),_:1}),m(ol,{span:12},{default:p((()=>[m(o,{label:"模块名",prop:"moduleName"},{default:p((()=>[m(a,{modelValue:f(xe).moduleName,"onUpdate:modelValue":l[7]||(l[7]=e=>f(xe).moduleName=e),placeholder:"system"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(tl,null,{default:p((()=>[m(ol,{span:12},{default:p((()=>[m(o,{label:"实体名",prop:"entityName"},{default:p((()=>[m(a,{modelValue:f(xe).entityName,"onUpdate:modelValue":l[8]||(l[8]=e=>f(xe).entityName=e),placeholder:"User"},null,8,["modelValue"])])),_:1})])),_:1}),m(ol,{span:12},{default:p((()=>[m(o,{label:"作者"},{default:p((()=>[m(a,{modelValue:f(xe).author,"onUpdate:modelValue":l[9]||(l[9]=e=>f(xe).author=e),placeholder:"youlai"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),m(tl,null,{default:p((()=>[m(ol,{span:12},{default:p((()=>[m(o,null,{label:p((()=>[s("div",ne,[l[25]||(l[25]=s("span",null,"上级菜单",-1)),m(il,{effect:"dark"},{content:p((()=>l[24]||(l[24]=[v(" 选择上级菜单，生成代码后会自动创建对应菜单。 "),s("br",null,null,-1),v(" 注意1：生成菜单后需分配权限给角色，否则菜单将无法显示。 "),s("br",null,null,-1),v(" 注意2：演示环境默认不生成菜单，如需生成，请在本地部署数据库。 ")]))),default:p((()=>[m(nl,{class:"cursor-pointer"},{default:p((()=>[m(ul)])),_:1})])),_:1})])])),default:p((()=>[m(dl,{modelValue:f(xe).parentMenuId,"onUpdate:modelValue":l[10]||(l[10]=e=>f(xe).parentMenuId=e),placeholder:"选择上级菜单",data:f(Ce),"check-strictly":"","render-after-expand":!1,filterable:"",clearable:""},null,8,["modelValue","data"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),[[V,0==f(ze)]]),h(s("div",ie,[h((d(),b(Ge,{"row-key":"id","element-loading-text":f(Ve),"highlight--currentrow":"",data:f(xe).fieldConfigs},{default:p((()=>[m(ee,{width:"55",align:"center"},{default:p((()=>[m(nl,{class:"cursor-move sortable-handle"},{default:p((()=>[m(rl)])),_:1})])),_:1}),m(ee,{label:"列名",width:"110"},{default:p((e=>[v(w(e.row.columnName),1)])),_:1}),m(ee,{label:"列类型",width:"80"},{default:p((e=>[v(w(e.row.columnType),1)])),_:1}),m(ee,{label:"字段名",width:"120"},{default:p((e=>[m(a,{modelValue:e.row.fieldName,"onUpdate:modelValue":l=>e.row.fieldName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{label:"字段类型",width:"80"},{default:p((e=>[v(w(e.row.fieldType),1)])),_:1}),m(ee,{label:"字段注释","min-width":"100"},{default:p((e=>[m(a,{modelValue:e.row.fieldComment,"onUpdate:modelValue":l=>e.row.fieldComment=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{label:"最大长度",width:"80"},{default:p((e=>[m(a,{modelValue:e.row.maxLength,"onUpdate:modelValue":l=>e.row.maxLength=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{width:"70"},{header:p((()=>[s("div",de,[l[26]||(l[26]=s("span",null,"查询",-1)),m(sl,{modelValue:f(Ae),"onUpdate:modelValue":l[11]||(l[11]=e=>y(Ae)?Ae.value=e:null),class:"ml-1",onChange:l[12]||(l[12]=e=>Ke("isShowInQuery",f(Ae)))},null,8,["modelValue"])])])),default:p((e=>[m(sl,{modelValue:e.row.isShowInQuery,"onUpdate:modelValue":l=>e.row.isShowInQuery=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{width:"70"},{header:p((()=>[s("div",re,[l[27]||(l[27]=s("span",null,"列表",-1)),m(sl,{modelValue:f(De),"onUpdate:modelValue":l[13]||(l[13]=e=>y(De)?De.value=e:null),class:"ml-1",onChange:l[14]||(l[14]=e=>Ke("isShowInList",f(De)))},null,8,["modelValue"])])])),default:p((e=>[m(sl,{modelValue:e.row.isShowInList,"onUpdate:modelValue":l=>e.row.isShowInList=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{width:"70"},{header:p((()=>[s("div",se,[l[28]||(l[28]=s("span",null,"表单",-1)),m(sl,{modelValue:f(Be),"onUpdate:modelValue":l[15]||(l[15]=e=>y(Be)?Be.value=e:null),class:"ml-1",onChange:l[16]||(l[16]=e=>Ke("isShowInForm",f(Be)))},null,8,["modelValue"])])])),default:p((e=>[m(sl,{modelValue:e.row.isShowInForm,"onUpdate:modelValue":l=>e.row.isShowInForm=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),m(ee,{label:"必填",width:"70"},{default:p((e=>[1==e.row.isShowInForm?(d(),b(sl,{key:0,modelValue:e.row.isRequired,"onUpdate:modelValue":l=>e.row.isRequired=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])):(d(),r("span",me,"-"))])),_:1}),m(ee,{label:"查询方式","min-width":"120"},{default:p((e=>[1===e.row.isShowInQuery?(d(),b(pl,{key:0,modelValue:e.row.queryType,"onUpdate:modelValue":l=>e.row.queryType=l,placeholder:"请选择"},{default:p((()=>[(d(!0),r(_,null,j(f(Ne),((e,l)=>(d(),b(ml,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),r("span",pe,"-"))])),_:1}),m(ee,{label:"表单类型","min-width":"120"},{default:p((e=>[1===e.row.isShowInQuery||1===e.row.isShowInForm?(d(),b(pl,{key:0,modelValue:e.row.formType,"onUpdate:modelValue":l=>e.row.formType=l,placeholder:"请选择"},{default:p((()=>[(d(!0),r(_,null,j(f(ke),((e,l)=>(d(),b(ml,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),r("span",fe,"-"))])),_:1}),m(ee,{label:"字典类型","min-width":"100"},{default:p((e=>[e.row.formType===f(D).SELECT.value?(d(),b(pl,{key:0,modelValue:e.row.dictType,"onUpdate:modelValue":l=>e.row.dictType=l,placeholder:"请选择",clearable:""},{default:p((()=>[(d(!0),r(_,null,j(f(Ue),(e=>(d(),b(ml,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),r("span",ce,"-"))])),_:1})])),_:1},8,["element-loading-text","data"])),[[_l,f(we)]])],512),[[V,1==f(ze)]]),h(m(tl,null,{default:p((()=>[m(ol,{span:6},{default:p((()=>[m(vl,{"max-height":"72vh"},{default:p((()=>[m(cl,{data:f(be),"default-expand-all":"","highlight-current":"",onNodeClick:el},{default:p((({data:e})=>{return[m(fl,{"icon-class":(l=e.label,l.endsWith(".java")?"java":l.endsWith(".html")?"html":l.endsWith(".vue")?"vue":l.endsWith(".ts")?"typescript":l.endsWith(".xml")?"xml":"file")},null,8,["icon-class"]),s("span",ve,w(e.label),1)];var l})),_:1},8,["data"])])),_:1})])),_:1}),m(ol,{span:18},{default:p((()=>[m(vl,{"max-height":"72vh"},{default:p((()=>[s("div",he,[m(bl,{type:"primary",onClick:ll},{default:p((()=>[m(nl,null,{default:p((()=>[m(hl)])),_:1}),l[29]||(l[29]=v(" 一键复制 "))])),_:1})]),m(f(k),{ref_key:"cmRef",ref:Fe,value:f(qe),"onUpdate:value":l[17]||(l[17]=e=>y(qe)?qe.value=e:null),options:Qe,border:"",readonly:!0,height:"100%",width:"100%"},null,8,["value"])])),_:1})])),_:1})])),_:1},512),[[V,2==f(ze)]])])])),_:1},8,["modelValue","title"])])}}});export{be as default};
