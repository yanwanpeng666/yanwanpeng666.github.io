import{d as e,r as l,S as a,aT as t,I as o,o as u,ae as n,h as i,B as d,l as r,w as s,g as m,e as p,W as f,X as c,V as v,f as h,p as g,aj as b,D as y,$ as w,Q as V,R as _,aU as j,ax as k,U as N,aV as U,aW as x,E as C}from"./index.D_QSJYsl.js";import{v as E}from"./el-loading._KqTsM-B.js";import{E as S}from"./el-drawer.DueyomvI.js";import"./el-overlay.Dhsra1-x.js";import{E as I}from"./el-link.Bw76TBkJ.js";import{E as T}from"./el-scrollbar.BoGuQ_YI.js";import{E as q}from"./el-tree.D4gfJARj.js";import{E as F}from"./el-checkbox.CEBwfQau.js";import{_ as Q}from"./index.BieV__2C.js";/* empty css               */import{E as R,a as L}from"./el-select.DC1h_FUz.js";import{E as z}from"./el-popper.DKqv0zrb.js";import{E as W}from"./el-tree-select.DVyrlPyY.js";import"./el-tooltip.l0sNRNKZ.js";import{a as D,E as G}from"./el-col.BGZTpXFL.js";import{F as A,E as P,a as B,S as M}from"./FormTypeEnum.DQSOtj5C.js";import{E as $}from"./el-card.By4j4syX.js";import{_ as O}from"./index.D8PK28SR.js";import{E as K,a as X}from"./el-table-column.B0xSElgG.js";import{E as H,a as Z}from"./el-form-item.CqZkxdvL.js";import{E as J}from"./el-button.DHJ0WrCN.js";import{E as Y}from"./el-input.DoYwyLAs.js";import{G as ee,Q as le}from"./index.DuBDy2O_.js";import{E as ae}from"./el-message-box.tZ-J3hTm.js";import"./index.CNdeHcq7.js";import"./index.DxtlaFw4.js";import"./vnode.BmjJ-nYA.js";import"./use-form-item.CIyZU-1C.js";import"./scroll.DbNYepUn.js";import"./index.DHTQwj-k.js";import"./token.DWNpOE8r.js";import"./index.BevjTxEK.js";import"./isEqual.CxON6d9P.js";import"./_Uint8Array.BXuv5HTU.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.CS7ldtbZ.js";import"./strings.BaZxU9je.js";import"./castArray.BRlXenMr.js";import"./index.Ddvjems4.js";import"./debounce.CPg49gac.js";import"./_baseIteratee.BdihAaWh.js";import"./index.DaF98UHt.js";import"./index.qJP1IqzF.js";import"./el-pagination.5XY2b5kn.js";import"./index.DtZzBez1.js";import"./validator.pOeBc5qo.js";const te={class:"app-container"},oe={class:"search-bar"},ue={class:"mt-5"},ne={class:"flex-y-between"},ie={class:"elTableCustom"},de={class:"flex-y-center"},re={class:"flex-y-center"},se={class:"flex-y-center"},me={key:1},pe={key:1},fe={key:1},ce={key:1},ve={class:"ml-1"},he={class:"absolute-rt z-36 right-5 top-2"},ge=e({name:"Codegen",__name:"index",setup(e){const ge=l([]),be=l(H),ye=a({pageNum:1,pageSize:10}),we=l(!1),Ve=l("loading..."),_e=l([]),je=l(0),ke=A,Ne=le,Ue=l(),xe=l([]),Ce=l({fieldConfigs:[]}),Ee={tableName:[{required:!0,message:"请输入表名",trigger:"blur"}],businessName:[{required:!0,message:"请输入业务名",trigger:"blur"}],packageName:[{required:!0,message:"请输入包名",trigger:"blur"}],moduleName:[{required:!0,message:"请输入模块名",trigger:"blur"}],entityName:[{required:!0,message:"请输入实体名",trigger:"blur"}]},Se=a({visible:!1,title:""}),{copy:Ie,copied:Te}=t(),qe=l(),Fe=l(),Qe={mode:"text/javascript"},Re=l(""),Le=l("下一步，字段配置"),ze=l(0),We=l(""),De=l(),Ge=l(!1),Ae=l(!1),Pe=l(!1);o(ze,(e=>{0===e?Le.value="下一步，字段配置":1===e?(Re.value="上一步，基础配置",Le.value="下一步，确认生成"):2===e&&(Re.value="上一步，字段配置",Le.value="下载代码")})),o(Te,(()=>{Te.value&&k.success("复制成功")})),o((()=>Ce.value.fieldConfigs),(e=>{e.forEach((e=>{e.fieldType&&e.fieldType.includes("Date")&&1===e.isShowInQuery&&(e.queryType=le.BETWEEN.value)}))}),{deep:!0,immediate:!0});const Be=()=>{if(De.value)return;const e=document.querySelector(".elTableCustom .el-table__body-wrapper tbody");De.value=M.create(e,{group:"shared",animation:150,ghostClass:"sortable-ghost",handle:".sortable-handle",easing:"cubic-bezier(1, 0, 0, 1)",onStart:e=>{},onEnd:e=>{Me(e.oldIndex,e.newIndex)}})},Me=(e,l)=>{let a=Object.assign([],Ce.value.fieldConfigs);const t=a.splice(e,1)[0];a.splice(l,0,t),a.forEach(((e,l)=>{e.fieldSort=l+1})),Ce.value.fieldConfigs=[],N((async()=>{Ce.value.fieldConfigs=a}))};function $e(){2===ze.value&&(Ce.value={fieldConfigs:[]},N((()=>{we.value=!0,ee.getGenConfig(We.value).then((e=>{Ce.value=e})).finally((()=>{we.value=!1}))})),Be()),ze.value--<=0&&(ze.value=0)}function Oe(){if(0===ze.value){const{tableName:e,packageName:l,businessName:a,moduleName:t,entityName:o}=Ce.value;if(!(e&&l&&a&&t&&o))return void k.error("表名、业务名、包名、模块名、实体名不能为空");Be()}if(1===ze.value){const e=Ce.value.tableName;if(!e)return void k.error("表名不能为空");we.value=!0,Ve.value="代码生成中，请稍后...",ee.saveGenConfig(e,Ce.value).then((()=>{Je(e)})).then((()=>{ze.value++>=2&&(ze.value=2)})).finally((()=>{we.value=!1,Ve.value="loading..."}))}else if(ze.value++>=2&&(ze.value=2),2===ze.value){const e=Ce.value.tableName;if(!e)return void k.error("表名不能为空");ee.download(e)}}function Ke(){we.value=!0,ee.getTablePage(ye).then((e=>{_e.value=e.list,je.value=e.total})).finally((()=>{we.value=!1}))}function Xe(){be.value.resetFields(),ye.pageNum=1,Ke()}const He=(e,l)=>{var a;const t=null==(a=Ce.value)?void 0:a.fieldConfigs;t&&t.forEach((a=>{a[e]=l?1:0}))},Ze=(e,l)=>{var a;const t=(null==(a=Ce.value)?void 0:a.fieldConfigs)||[];l.value=t.every((l=>1===l[e]))};function Je(e){ge.value=[],ee.getPreviewData(e).then((l=>{Se.title=`代码生成 ${e}`;const a=function(e){const l={label:"前后端代码",children:[]};return e.forEach((e=>{var a;const t=e.path.includes("/")?"/":"\\",o=e.path.split(t),u=["src"+t+"main","java",Ce.value.backendAppName,Ce.value.frontendAppName,(Ce.value.packageName+"."+Ce.value.moduleName).replace(/\./g,t)],n=[];let i=[];o.forEach((e=>{i.push(e);const l=i.join(t);u.includes(l)&&(n.push(l),i=[])})),n.forEach(((e,l)=>{n[l]=e.replace(/\\/g,"/")})),i.length>0&&n.push(...i);let d=l;n.forEach((e=>{var l,a;let t=null==(l=d.children)?void 0:l.find((l=>l.label===e));t||(t={label:e,children:[]},null==(a=d.children)||a.push(t)),d=t})),null==(a=d.children)||a.push({label:e.fileName,content:null==e?void 0:e.content})})),l}(l);ge.value=[a];const t=Ye(a);t&&(qe.value=t.content||"")})).catch((()=>{ze.value=0}))}function Ye(e){if(!e.children||0===e.children.length)return e;for(const l of e.children){const e=Ye(l);if(e)return e}return null}function el(e){e.children&&0!==e.children.length||(qe.value=e.content||"")}const ll=()=>{qe.value&&Ie(qe.value)};return u((()=>{var e;Ke(),null==(e=Fe.value)||e.destroy()})),(e,l)=>{const a=Y,t=Z,o=n("Search"),u=J,N=n("Refresh"),M=H,le=n("Plus"),Ie=K,Te=n("MagicStick"),De=n("RefreshLeft"),Be=X,Me=O,Ye=$,al=P,tl=B,ol=D,ul=G,nl=n("QuestionFilled"),il=C,dl=z,rl=W,sl=n("Rank"),ml=F,pl=L,fl=R,cl=Q,vl=q,hl=T,gl=n("CopyDocument"),bl=I,yl=n("Back"),wl=n("Right"),Vl=n("Download"),_l=S,jl=E;return p(),i("div",te,[d("div",oe,[r(M,{ref_key:"queryFormRef",ref:be,model:m(ye),inline:!0},{default:s((()=>[r(t,{prop:"keywords",label:"关键字"},{default:s((()=>[r(a,{modelValue:m(ye).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>m(ye).keywords=e),placeholder:"表名",clearable:"",onKeyup:f(Ke,["enter"])},null,8,["modelValue"])])),_:1}),r(t,null,{default:s((()=>[r(u,{type:"primary",onClick:Ke},{icon:s((()=>[r(o)])),default:s((()=>[l[20]||(l[20]=c(" 搜索 "))])),_:1}),r(u,{onClick:Xe},{icon:s((()=>[r(N)])),default:s((()=>[l[21]||(l[21]=c(" 重置 "))])),_:1})])),_:1})])),_:1},8,["model"])]),r(Ye,{shadow:"never",class:"table-container"},{default:s((()=>[d("div",null,[r(u,{type:"primary",style:{"margin-bottom":"20px"}},{icon:s((()=>[r(le)])),default:s((()=>[l[22]||(l[22]=c(" 新增 "))])),_:1})]),v((p(),h(Be,{ref:"dataTableRef",data:m(_e),"highlight-current-row":"",border:""},{default:s((()=>[r(Ie,{type:"selection",width:"55",align:"center"}),r(Ie,{label:"表名",prop:"tableName","min-width":"100"}),r(Ie,{label:"描述",prop:"tableComment",width:"150"}),r(Ie,{label:"存储引擎",align:"center",prop:"engine"}),r(Ie,{label:"排序规则",align:"center",prop:"tableCollation"}),r(Ie,{label:"创建时间",align:"center",prop:"createTime"}),r(Ie,{fixed:"right",label:"操作",width:"200"},{default:s((e=>[r(u,{type:"primary",size:"small",link:"",onClick:l=>async function(e){Se.visible=!0,ze.value=0,xe.value=await U.getOptions(!0),We.value=e,x.getList().then((l=>{Ue.value=l.map((e=>({label:e.name,value:e.dictCode}))),we.value=!0,ee.getGenConfig(e).then((l=>{Se.title=`${e} 代码生成`,Ce.value=l,Ze("isShowInQuery",Ge),Ze("isShowInList",Ae),Ze("isShowInForm",Pe),Ce.value.id?(ze.value=2,Je(e)):ze.value=0})).finally((()=>{we.value=!1}))}))}(e.row.tableName)},{icon:s((()=>[r(Te)])),default:s((()=>[l[23]||(l[23]=c(" 生成代码 "))])),_:2},1032,["onClick"]),1===e.row.isConfigured?(p(),h(u,{key:0,type:"danger",size:"small",link:"",onClick:l=>{return a=e.row.tableName,void ae.confirm("确定要重置配置吗？","提示",{type:"warning"}).then((()=>{ee.resetGenConfig(a).then((()=>{k.success("重置成功"),Ke()}))}));var a}},{icon:s((()=>[r(De)])),default:s((()=>[l[24]||(l[24]=c(" 重置配置 "))])),_:2},1032,["onClick"])):g("",!0)])),_:1})])),_:1},8,["data"])),[[jl,m(we)]]),m(je)>0?(p(),h(Me,{key:0,total:m(je),"onUpdate:total":l[1]||(l[1]=e=>b(je)?je.value=e:null),page:m(ye).pageNum,"onUpdate:page":l[2]||(l[2]=e=>m(ye).pageNum=e),limit:m(ye).pageSize,"onUpdate:limit":l[3]||(l[3]=e=>m(ye).pageSize=e),onPagination:Ke},null,8,["total","page","limit"])):g("",!0)])),_:1}),r(_l,{modelValue:m(Se).visible,"onUpdate:modelValue":l[18]||(l[18]=e=>m(Se).visible=e),title:m(Se).title,size:"80%",onClose:l[19]||(l[19]=e=>m(Se).visible=!1)},{footer:s((()=>[0!==m(ze)?(p(),h(u,{key:0,type:"success",onClick:$e},{default:s((()=>[r(il,null,{default:s((()=>[r(yl)])),_:1}),c(" "+y(m(Re)),1)])),_:1})):g("",!0),r(u,{type:"primary",onClick:Oe},{default:s((()=>[c(y(m(Le))+" ",1),2!==m(ze)?(p(),h(il,{key:0},{default:s((()=>[r(wl)])),_:1})):(p(),h(il,{key:1},{default:s((()=>[r(Vl)])),_:1}))])),_:1})])),default:s((()=>[r(tl,{active:m(ze),"align-center":"","finish-status":"success",simple:""},{default:s((()=>[r(al,{title:"基础配置"}),r(al,{title:"字段配置"}),r(al,{title:"预览生成"})])),_:1},8,["active"]),d("div",ue,[v(r(M,{model:m(Ce),"label-width":100,rules:Ee},{default:s((()=>[r(ul,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(t,{label:"表名",prop:"tableName"},{default:s((()=>[r(a,{modelValue:m(Ce).tableName,"onUpdate:modelValue":l[4]||(l[4]=e=>m(Ce).tableName=e),readonly:""},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(t,{label:"业务名",prop:"businessName"},{default:s((()=>[r(a,{modelValue:m(Ce).businessName,"onUpdate:modelValue":l[5]||(l[5]=e=>m(Ce).businessName=e),placeholder:"用户"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(ul,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(t,{label:"包名",prop:"packageName"},{default:s((()=>[r(a,{modelValue:m(Ce).packageName,"onUpdate:modelValue":l[6]||(l[6]=e=>m(Ce).packageName=e),placeholder:"com.youlai.boot"},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(t,{label:"模块名",prop:"moduleName"},{default:s((()=>[r(a,{modelValue:m(Ce).moduleName,"onUpdate:modelValue":l[7]||(l[7]=e=>m(Ce).moduleName=e),placeholder:"system"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(ul,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(t,{label:"实体名",prop:"entityName"},{default:s((()=>[r(a,{modelValue:m(Ce).entityName,"onUpdate:modelValue":l[8]||(l[8]=e=>m(Ce).entityName=e),placeholder:"User"},null,8,["modelValue"])])),_:1})])),_:1}),r(ol,{span:12},{default:s((()=>[r(t,{label:"作者"},{default:s((()=>[r(a,{modelValue:m(Ce).author,"onUpdate:modelValue":l[9]||(l[9]=e=>m(Ce).author=e),placeholder:"youlai"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),r(ul,null,{default:s((()=>[r(ol,{span:12},{default:s((()=>[r(t,null,{label:s((()=>[d("div",ne,[l[26]||(l[26]=d("span",null,"上级菜单",-1)),r(dl,{effect:"dark"},{content:s((()=>l[25]||(l[25]=[c(" 选择上级菜单，生成代码后会自动创建对应菜单。 "),d("br",null,null,-1),c(" 注意1：生成菜单后需分配权限给角色，否则菜单将无法显示。 "),d("br",null,null,-1),c(" 注意2：演示环境默认不生成菜单，如需生成，请在本地部署数据库。 ")]))),default:s((()=>[r(il,{class:"cursor-pointer"},{default:s((()=>[r(nl)])),_:1})])),_:1})])])),default:s((()=>[r(rl,{modelValue:m(Ce).parentMenuId,"onUpdate:modelValue":l[10]||(l[10]=e=>m(Ce).parentMenuId=e),placeholder:"选择上级菜单",data:m(xe),"check-strictly":"","render-after-expand":!1,filterable:"",clearable:""},null,8,["modelValue","data"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"]),[[w,0==m(ze)]]),v(d("div",ie,[v((p(),h(Be,{"row-key":"id","element-loading-text":m(Ve),"highlight--currentrow":"",data:m(Ce).fieldConfigs},{default:s((()=>[r(Ie,{width:"55",align:"center"},{default:s((()=>[r(il,{class:"cursor-move sortable-handle"},{default:s((()=>[r(sl)])),_:1})])),_:1}),r(Ie,{label:"列名",width:"110"},{default:s((e=>[c(y(e.row.columnName),1)])),_:1}),r(Ie,{label:"列类型",width:"80"},{default:s((e=>[c(y(e.row.columnType),1)])),_:1}),r(Ie,{label:"字段名",width:"120"},{default:s((e=>[r(a,{modelValue:e.row.fieldName,"onUpdate:modelValue":l=>e.row.fieldName=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{label:"字段类型",width:"80"},{default:s((e=>[c(y(e.row.fieldType),1)])),_:1}),r(Ie,{label:"字段注释","min-width":"100"},{default:s((e=>[r(a,{modelValue:e.row.fieldComment,"onUpdate:modelValue":l=>e.row.fieldComment=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{label:"最大长度",width:"80"},{default:s((e=>[r(a,{modelValue:e.row.maxLength,"onUpdate:modelValue":l=>e.row.maxLength=l},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{width:"70"},{header:s((()=>[d("div",de,[l[27]||(l[27]=d("span",null,"查询",-1)),r(ml,{modelValue:m(Ge),"onUpdate:modelValue":l[11]||(l[11]=e=>b(Ge)?Ge.value=e:null),class:"ml-1",onChange:l[12]||(l[12]=e=>He("isShowInQuery",m(Ge)))},null,8,["modelValue"])])])),default:s((e=>[r(ml,{modelValue:e.row.isShowInQuery,"onUpdate:modelValue":l=>e.row.isShowInQuery=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{width:"70"},{header:s((()=>[d("div",re,[l[28]||(l[28]=d("span",null,"列表",-1)),r(ml,{modelValue:m(Ae),"onUpdate:modelValue":l[13]||(l[13]=e=>b(Ae)?Ae.value=e:null),class:"ml-1",onChange:l[14]||(l[14]=e=>He("isShowInList",m(Ae)))},null,8,["modelValue"])])])),default:s((e=>[r(ml,{modelValue:e.row.isShowInList,"onUpdate:modelValue":l=>e.row.isShowInList=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{width:"70"},{header:s((()=>[d("div",se,[l[29]||(l[29]=d("span",null,"表单",-1)),r(ml,{modelValue:m(Pe),"onUpdate:modelValue":l[15]||(l[15]=e=>b(Pe)?Pe.value=e:null),class:"ml-1",onChange:l[16]||(l[16]=e=>He("isShowInForm",m(Pe)))},null,8,["modelValue"])])])),default:s((e=>[r(ml,{modelValue:e.row.isShowInForm,"onUpdate:modelValue":l=>e.row.isShowInForm=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),r(Ie,{label:"必填",width:"70"},{default:s((e=>[1==e.row.isShowInForm?(p(),h(ml,{key:0,modelValue:e.row.isRequired,"onUpdate:modelValue":l=>e.row.isRequired=l,"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])):(p(),i("span",me,"-"))])),_:1}),r(Ie,{label:"查询方式","min-width":"120"},{default:s((e=>[1===e.row.isShowInQuery?(p(),h(fl,{key:0,modelValue:e.row.queryType,"onUpdate:modelValue":l=>e.row.queryType=l,placeholder:"请选择"},{default:s((()=>[(p(!0),i(V,null,_(m(Ne),((e,l)=>(p(),h(pl,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),i("span",pe,"-"))])),_:1}),r(Ie,{label:"表单类型","min-width":"120"},{default:s((e=>[1===e.row.isShowInQuery||1===e.row.isShowInForm?(p(),h(fl,{key:0,modelValue:e.row.formType,"onUpdate:modelValue":l=>e.row.formType=l,placeholder:"请选择"},{default:s((()=>[(p(!0),i(V,null,_(m(ke),((e,l)=>(p(),h(pl,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),i("span",fe,"-"))])),_:1}),r(Ie,{label:"字典类型","min-width":"100"},{default:s((e=>[e.row.formType===m(A).SELECT.value?(p(),h(fl,{key:0,modelValue:e.row.dictType,"onUpdate:modelValue":l=>e.row.dictType=l,placeholder:"请选择",clearable:""},{default:s((()=>[(p(!0),i(V,null,_(m(Ue),(e=>(p(),h(pl,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):(p(),i("span",ce,"-"))])),_:1})])),_:1},8,["element-loading-text","data"])),[[jl,m(we)]])],512),[[w,1==m(ze)]]),v(r(ul,null,{default:s((()=>[r(ol,{span:6},{default:s((()=>[r(hl,{"max-height":"72vh"},{default:s((()=>[r(vl,{data:m(ge),"default-expand-all":"","highlight-current":"",onNodeClick:el},{default:s((({data:e})=>{return[r(cl,{"icon-class":(l=e.label,l.endsWith(".java")?"java":l.endsWith(".html")?"html":l.endsWith(".vue")?"vue":l.endsWith(".ts")?"typescript":l.endsWith(".xml")?"xml":"file")},null,8,["icon-class"]),d("span",ve,y(e.label),1)];var l})),_:1},8,["data"])])),_:1})])),_:1}),r(ol,{span:18},{default:s((()=>[r(hl,{"max-height":"72vh"},{default:s((()=>[d("div",he,[r(bl,{type:"primary",onClick:ll},{default:s((()=>[r(il,null,{default:s((()=>[r(gl)])),_:1}),l[30]||(l[30]=c(" 一键复制 "))])),_:1})]),r(m(j),{ref_key:"cmRef",ref:Fe,value:m(qe),"onUpdate:value":l[17]||(l[17]=e=>b(qe)?qe.value=e:null),options:Qe,border:"",readonly:!0,height:"100%",width:"100%"},null,8,["value"])])),_:1})])),_:1})])),_:1},512),[[w,2==m(ze)]])])])),_:1},8,["modelValue","title"])])}}});export{ge as default};
