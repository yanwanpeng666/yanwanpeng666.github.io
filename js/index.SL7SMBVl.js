import{d as e,r as l,W as a,o as t,aK as i,cp as o,g as s,f as r,D as u,m as n,w as d,$ as p,ag as c,i as m,ah as f,ai as b,ac as _,e as y,h as v,b7 as g,G as h,aT as w,S as k,V,aS as j,by as x,aZ as C}from"./index.Dv9sjPYC.js";import{v as S}from"./loading.S8LTmobk.js";import{E as T,a as U}from"./descriptions-item.Dx4SZjwy.js";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang.D8O6uDUg.js";import{E,a as z}from"./radio-group.DKuTe-fa.js";import{_ as q}from"./index.vue_vue_type_script_setup_true_lang.DBPr1bj8.js";import{E as F}from"./card.UCV2TBx1.js";import{_ as I}from"./index.D-M2h4YD.js";import{a as D,E as L}from"./table-column.D28nzGFS.js";import"./checkbox.Cq-dvxYE.js";/* empty css                */import"./popper.m2lNosSJ.js";import"./scrollbar.DQblMs23.js";import{_ as B}from"./DictLabel.vue_vue_type_script_setup_true_lang.CielTJsp.js";import{E as O,a as P}from"./form-item.DgRMSZzs.js";import{E as R,a as A}from"./select.D46WCvpG.js";import{N as H}from"./notice-api.CdKsW-zX.js";/* empty css                    */import{E as K}from"./index.BqKoy5Fw.js";import"./file-api.C9PIarN4.js";import"./omit.B6E_lyF8.js";import"./_baseClone.Br4BWTY9.js";/* empty css                       */import"./pagination.CWkEuBr5.js";import"./_baseIteratee.DbpbFJtj.js";import"./castArray.D1K_WIrw.js";import"./debounce.CITkvERZ.js";import"./toNumber.P9ps2NTq.js";import"./raf.B6j8aosc.js";import"./strings.BtizHOxT.js";import"./index.8lkWLndA.js";const M={class:"app-container"},W={class:"search-container"},Z={class:"data-table__toolbar"},G={class:"data-table__toolbar--actions"},Q={class:"flex-x-start"},X={key:0,class:"flex-x-start"},$={key:1,class:"flex-x-start"},J={class:"dialog-footer"},Y={class:"flex-x-between"},ee={class:"dialog-toolbar"},le=["innerHTML"],ae=e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const ae=l(),te=l(),ie=l(!1),oe=l([]),se=l(0),re=a({pageNum:1,pageSize:10}),ue=l([]),ne=l([]),de=a({title:"",visible:!1}),pe=a({level:"L",targetType:1}),ce=a({title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur",validator:(e,l,a)=>{l.replace(/<[^>]+>/g,"").trim()?a():a(new Error("请输入通知内容"))}}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}]}),me=a({visible:!1}),fe=l({});function be(){re.pageNum=1,_e()}function _e(){ie.value=!0,H.getPage(re).then(e=>{ne.value=e.list,se.value=e.total}).finally(()=>{ie.value=!1})}function ye(){ae.value.resetFields(),re.pageNum=1,be()}function ve(e){oe.value=e.map(e=>e.id)}function ge(e){x.getOptions().then(e=>{ue.value=e}),de.visible=!0,e?(de.title="修改公告",H.getFormData(e).then(e=>{Object.assign(pe,e)})):(Object.assign(pe,{level:0,targetType:0}),de.title="新增公告")}function he(){de.visible=!1,te.value.resetFields(),te.value.clearValidate(),pe.id=void 0,pe.targetType=1}function we(e){const l=[e||oe.value].join(",");l?K.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ie.value=!0,H.deleteByIds(l).then(()=>{C.success("删除成功"),ye()}).finally(()=>ie.value=!1)},()=>{C.info("已取消删除")}):C.warning("请勾选删除项")}const ke=()=>{me.visible=!1};return t(()=>{be()}),(e,l)=>{const a=p,t=O,x=A,K=R,Ve=f,je=P,xe=L,Ce=B,Se=g,Te=D,Ue=I,Ne=F,Ee=q,ze=z,qe=E,Fe=N,Ie=j,De=i("Close"),Le=U,Be=T,Oe=o("hasPerm"),Pe=S;return r(),s("div",M,[u("div",W,[n(je,{ref_key:"queryFormRef",ref:ae,model:m(re),inline:!0,"label-suffix":":"},{default:d(()=>[n(t,{label:"标题123",prop:"title"},{default:d(()=>[n(a,{modelValue:m(re).title,"onUpdate:modelValue":l[0]||(l[0]=e=>m(re).title=e),placeholder:"标题",clearable:"",onKeyup:l[1]||(l[1]=c(e=>be(),["enter"]))},null,8,["modelValue"])]),_:1}),n(t,{label:"发布状态",prop:"publishStatus"},{default:d(()=>[n(K,{modelValue:m(re).publishStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>m(re).publishStatus=e),clearable:"",placeholder:"全部",style:{width:"100px"}},{default:d(()=>[n(x,{value:0,label:"未发布"}),n(x,{value:1,label:"已发布"}),n(x,{value:-1,label:"已撤回"})]),_:1},8,["modelValue"])]),_:1}),n(t,{class:"search-buttons"},{default:d(()=>[n(Ve,{type:"primary",icon:"search",onClick:l[3]||(l[3]=e=>be())},{default:d(()=>[...l[21]||(l[21]=[b("搜索",-1)])]),_:1}),n(Ve,{icon:"refresh",onClick:l[4]||(l[4]=e=>ye())},{default:d(()=>[...l[22]||(l[22]=[b("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),n(Ne,{shadow:"hover",class:"data-table"},{default:d(()=>[u("div",Z,[u("div",G,[_((r(),y(Ve,{type:"success",icon:"plus",onClick:l[5]||(l[5]=e=>ge())},{default:d(()=>[...l[23]||(l[23]=[b(" 新增通知 ",-1)])]),_:1})),[[Oe,["sys:notice:add"]]]),_((r(),y(Ve,{type:"danger",disabled:0===m(oe).length,icon:"delete",onClick:l[6]||(l[6]=e=>we())},{default:d(()=>[...l[24]||(l[24]=[b(" 删除 ",-1)])]),_:1},8,["disabled"])),[[Oe,["sys:notice:delete"]]])])]),_((r(),y(Te,{ref:"dataTableRef",data:m(ne),"highlight-current-row":"",class:"data-table__content",onSelectionChange:ve},{default:d(()=>[n(xe,{type:"selection",width:"55",align:"center"}),n(xe,{type:"index",label:"序号",width:"60"}),n(xe,{label:"通知标题",prop:"title","min-width":"200"}),n(xe,{align:"center",label:"通知类型",width:"150"},{default:d(e=>[n(Ce,{modelValue:e.row.type,"onUpdate:modelValue":l=>e.row.type=l,code:"notice_type"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(xe,{align:"center",label:"发布人",prop:"publisherName",width:"150"}),n(xe,{align:"center",label:"通知等级",width:"100"},{default:d(e=>[n(Ce,{modelValue:e.row.level,"onUpdate:modelValue":l=>e.row.level=l,code:"notice_level"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(xe,{align:"center",label:"通告目标类型",prop:"targetType","min-width":"100"},{default:d(e=>[1==e.row.targetType?(r(),y(Se,{key:0,type:"warning"},{default:d(()=>[...l[25]||(l[25]=[b("全体",-1)])]),_:1})):v("",!0),2==e.row.targetType?(r(),y(Se,{key:1,type:"success"},{default:d(()=>[...l[26]||(l[26]=[b("指定",-1)])]),_:1})):v("",!0)]),_:1}),n(xe,{align:"center",label:"发布状态","min-width":"100"},{default:d(e=>[0==e.row.publishStatus?(r(),y(Se,{key:0,type:"info"},{default:d(()=>[...l[27]||(l[27]=[b("未发布",-1)])]),_:1})):v("",!0),1==e.row.publishStatus?(r(),y(Se,{key:1,type:"success"},{default:d(()=>[...l[28]||(l[28]=[b("已发布",-1)])]),_:1})):v("",!0),-1==e.row.publishStatus?(r(),y(Se,{key:2,type:"warning"},{default:d(()=>[...l[29]||(l[29]=[b("已撤回",-1)])]),_:1})):v("",!0)]),_:1}),n(xe,{label:"操作时间",width:"250"},{default:d(e=>[u("div",Q,[l[30]||(l[30]=u("span",null,"创建时间：",-1)),u("span",null,h(e.row.createTime||"-"),1)]),1===e.row.publishStatus?(r(),s("div",X,[l[31]||(l[31]=u("span",null,"发布时间：",-1)),u("span",null,h(e.row.publishTime||"-"),1)])):-1===e.row.publishStatus?(r(),s("div",$,[l[32]||(l[32]=u("span",null,"撤回时间：",-1)),u("span",null,h(e.row.revokeTime||"-"),1)])):v("",!0)]),_:1}),n(xe,{align:"center",fixed:"right",label:"操作",width:"150"},{default:d(e=>[n(Ve,{type:"primary",size:"small",link:"",onClick:l=>(async e=>{const l=await H.getDetail(e);fe.value=l,me.visible=!0})(e.row.id)},{default:d(()=>[...l[33]||(l[33]=[b(" 查看 ",-1)])]),_:1},8,["onClick"]),1!=e.row.publishStatus?_((r(),y(Ve,{key:0,type:"primary",size:"small",link:"",onClick:l=>{return a=e.row.id,void H.publish(a).then(()=>{C.success("发布成功"),be()});var a}},{default:d(()=>[...l[34]||(l[34]=[b(" 发布 ",-1)])]),_:1},8,["onClick"])),[[Oe,["sys:notice:publish"]]]):v("",!0),1==e.row.publishStatus?_((r(),y(Ve,{key:1,type:"primary",size:"small",link:"",onClick:l=>{return a=e.row.id,void H.revoke(a).then(()=>{C.success("撤回成功"),be()});var a}},{default:d(()=>[...l[35]||(l[35]=[b(" 撤回 ",-1)])]),_:1},8,["onClick"])),[[Oe,["sys:notice:revoke"]]]):v("",!0),1!=e.row.publishStatus?_((r(),y(Ve,{key:2,type:"primary",size:"small",link:"",onClick:l=>ge(e.row.id)},{default:d(()=>[...l[36]||(l[36]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[Oe,["sys:notice:edit"]]]):v("",!0),1!=e.row.publishStatus?_((r(),y(Ve,{key:3,type:"danger",size:"small",link:"",onClick:l=>we(e.row.id)},{default:d(()=>[...l[37]||(l[37]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])),[[Oe,["sys:notice:delete"]]]):v("",!0)]),_:1})]),_:1},8,["data"])),[[Pe,m(ie)]]),m(se)>0?(r(),y(Ue,{key:0,total:m(se),"onUpdate:total":l[7]||(l[7]=e=>w(se)?se.value=e:null),page:m(re).pageNum,"onUpdate:page":l[8]||(l[8]=e=>m(re).pageNum=e),limit:m(re).pageSize,"onUpdate:limit":l[9]||(l[9]=e=>m(re).pageSize=e),onPagination:l[10]||(l[10]=e=>_e())},null,8,["total","page","limit"])):v("",!0)]),_:1}),n(Ie,{modelValue:m(de).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>m(de).visible=e),title:m(de).title,top:"3vh",width:"80%",onClose:he},{footer:d(()=>[u("div",J,[n(Ve,{type:"primary",onClick:l[17]||(l[17]=e=>{te.value.validate(e=>{if(e){ie.value=!0;const e=pe.id;e?H.update(e,pe).then(()=>{C.success("修改成功"),he(),ye()}).finally(()=>ie.value=!1):H.create(pe).then(()=>{C.success("新增成功"),he(),ye()}).finally(()=>ie.value=!1)}})})},{default:d(()=>[...l[40]||(l[40]=[b("确定",-1)])]),_:1}),n(Ve,{onClick:l[18]||(l[18]=e=>he())},{default:d(()=>[...l[41]||(l[41]=[b("取消",-1)])]),_:1})])]),default:d(()=>[n(je,{ref_key:"dataFormRef",ref:te,model:m(pe),rules:m(ce),"label-width":"100px"},{default:d(()=>[n(t,{label:"通知标题",prop:"title"},{default:d(()=>[n(a,{modelValue:m(pe).title,"onUpdate:modelValue":l[11]||(l[11]=e=>m(pe).title=e),placeholder:"通知标题",clearable:""},null,8,["modelValue"])]),_:1}),n(t,{label:"通知类型",prop:"type"},{default:d(()=>[n(Ee,{modelValue:m(pe).type,"onUpdate:modelValue":l[12]||(l[12]=e=>m(pe).type=e),code:"notice_type"},null,8,["modelValue"])]),_:1}),n(t,{label:"通知等级",prop:"level"},{default:d(()=>[n(Ee,{modelValue:m(pe).level,"onUpdate:modelValue":l[13]||(l[13]=e=>m(pe).level=e),code:"notice_level"},null,8,["modelValue"])]),_:1}),n(t,{label:"目标类型",prop:"targetType"},{default:d(()=>[n(qe,{modelValue:m(pe).targetType,"onUpdate:modelValue":l[14]||(l[14]=e=>m(pe).targetType=e)},{default:d(()=>[n(ze,{value:1},{default:d(()=>[...l[38]||(l[38]=[b("全体",-1)])]),_:1}),n(ze,{value:2},{default:d(()=>[...l[39]||(l[39]=[b("指定",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),2==m(pe).targetType?(r(),y(t,{key:0,label:"指定用户",prop:"targetUserIds"},{default:d(()=>[n(K,{modelValue:m(pe).targetUserIds,"onUpdate:modelValue":l[15]||(l[15]=e=>m(pe).targetUserIds=e),multiple:"",search:"",placeholder:"请选择指定用户"},{default:d(()=>[(r(!0),s(k,null,V(m(ue),e=>(r(),y(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("",!0),n(t,{label:"通知内容",prop:"content"},{default:d(()=>[n(Fe,{modelValue:m(pe).content,"onUpdate:modelValue":l[16]||(l[16]=e=>m(pe).content=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),n(Ie,{modelValue:m(me).visible,"onUpdate:modelValue":l[20]||(l[20]=e=>m(me).visible=e),"show-close":!1,width:"50%","append-to-body":"",onClose:ke},{header:d(()=>[u("div",Y,[l[42]||(l[42]=u("span",null,"通知公告详情",-1)),u("div",ee,[n(Ve,{circle:"",onClick:ke},{icon:d(()=>[n(De)]),_:1})])])]),default:d(()=>[n(Be,{column:1},{default:d(()=>[n(Le,{label:"标题："},{default:d(()=>[b(h(m(fe).title),1)]),_:1}),n(Le,{label:"发布状态："},{default:d(()=>[0==m(fe).publishStatus?(r(),y(Se,{key:0,type:"info"},{default:d(()=>[...l[43]||(l[43]=[b("未发布",-1)])]),_:1})):1==m(fe).publishStatus?(r(),y(Se,{key:1,type:"success"},{default:d(()=>[...l[44]||(l[44]=[b("已发布",-1)])]),_:1})):-1==m(fe).publishStatus?(r(),y(Se,{key:2,type:"warning"},{default:d(()=>[...l[45]||(l[45]=[b("已撤回",-1)])]),_:1})):v("",!0)]),_:1}),n(Le,{label:"发布人："},{default:d(()=>[b(h(m(fe).publisherName),1)]),_:1}),n(Le,{label:"发布时间："},{default:d(()=>[b(h(m(fe).publishTime),1)]),_:1}),n(Le,{label:"公告内容："},{default:d(()=>[u("div",{class:"notice-content",innerHTML:m(fe).content},null,8,le)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ae as default};
