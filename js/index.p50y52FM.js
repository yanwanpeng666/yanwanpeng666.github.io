import{d as e,r as l,W as a,o as t,bC as s,g as o,f as d,D as i,m as r,w as n,$ as u,ag as p,i as m,ah as c,ai as f,ac as h,e as b,j as y,aU as _,aY as g}from"./index.-2dSJvT_.js";import{v}from"./el-loading.DfcQG7DK.js";import{E as j}from"./el-dialog.Kkc-pGkQ.js";import{E as k,a as w,b as V,c as x}from"./el-select.D5K2M6II.js";import{E as C}from"./el-input-number.Dw40aG4L.js";import{E as I,a as E}from"./el-tag.CL_KEoGm.js";import"./el-scrollbar.h6wvvJ8y.js";import"./el-tree.cbGAGcQx.js";import"./el-checkbox.5kbAoqEu.js";import"./el-text.B9WyMWJL.js";import{E as U}from"./el-tree-select.DVjsJ2O-.js";import{E as q}from"./el-card.BXatHMm7.js";import{E as D,a as F}from"./el-table-column.CXF3oDjy.js";import"./el-tooltip.hAP85Bn3.js";import{D as z}from"./dept.api.DX1-UM4r.js";import{E as B}from"./index.6v8T4Dn9.js";import"./index.DNWtI2fw.js";import"./use-dialog.DWCABKHh.js";import"./refs.Cw5r5QN8.js";import"./_baseIteratee.Jw5YRMh2.js";import"./index.od3oxRLs.js";import"./index.CsCgWOBa.js";import"./index.tPmf0Yfg.js";const O={class:"app-container"},R={class:"search-bar"},T={class:"mb-10px"},A={class:"dialog-footer"},K=e({name:"Dept",inheritAttrs:!1,__name:"index",setup(e){const K=l(),L=l(),P=l(!1),S=l([]),G=a({}),N=a({title:"",visible:!1}),Q=l(),W=l(),Y=a({status:1,parentId:"0",sort:1}),$=a({parentId:[{required:!0,message:"上级部门不能为空",trigger:"change"}],name:[{required:!0,message:"部门名称不能为空",trigger:"blur"}],code:[{required:!0,message:"部门编号不能为空",trigger:"blur"}],sort:[{required:!0,message:"显示排序不能为空",trigger:"blur"}]});function H(){P.value=!0,z.getList(G).then(e=>{Q.value=e,P.value=!1})}function J(){K.value.resetFields(),H()}function M(e){S.value=e.map(e=>e.id)}async function X(e,l){const a=await z.getOptions();W.value=[{value:"0",label:"顶级部门",children:a}],N.visible=!0,l?(N.title="修改部门",z.getFormData(l).then(e=>{Object.assign(Y,e)})):(N.title="新增部门",Y.parentId=e||"0")}function Z(){L.value.validate(e=>{if(e){P.value=!0;const e=Y.id;e?z.update(e,Y).then(()=>{_.success("修改成功"),le(),H()}).finally(()=>P.value=!1):z.create(Y).then(()=>{_.success("新增成功"),le(),H()}).finally(()=>P.value=!1)}})}function ee(e){const l=[e||S.value].join(",");l?g.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{P.value=!0,z.deleteByIds(l).then(()=>{_.success("删除成功"),J()}).finally(()=>P.value=!1)},()=>{_.info("已取消删除")}):_.warning("请勾选删除项")}function le(){N.visible=!1,L.value.resetFields(),L.value.clearValidate(),Y.id=void 0,Y.parentId="0",Y.status=1,Y.sort=1}return t(()=>{H()}),(e,l)=>{const a=u,t=I,_=w,g=k,z=c,ae=E,te=F,se=B,oe=D,de=q,ie=U,re=C,ne=x,ue=V,pe=j,me=s("hasPerm"),ce=v;return d(),o("div",O,[i("div",R,[r(ae,{ref_key:"queryFormRef",ref:K,model:m(G),inline:!0},{default:n(()=>[r(t,{label:"关键字",prop:"keywords"},{default:n(()=>[r(a,{modelValue:m(G).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>m(G).keywords=e),placeholder:"部门名称",onKeyup:p(H,["enter"])},null,8,["modelValue"])]),_:1}),r(t,{label:"部门状态",prop:"status"},{default:n(()=>[r(g,{modelValue:m(G).status,"onUpdate:modelValue":l[1]||(l[1]=e=>m(G).status=e),placeholder:"全部",clearable:"",class:"!w-[100px]"},{default:n(()=>[r(_,{value:1,label:"正常"}),r(_,{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),r(t,null,{default:n(()=>[r(z,{class:"filter-item",type:"primary",icon:"search",onClick:H},{default:n(()=>[...l[10]||(l[10]=[f(" 搜索 ",-1)])]),_:1}),r(z,{icon:"refresh",onClick:J},{default:n(()=>[...l[11]||(l[11]=[f("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),r(de,{shadow:"never"},{default:n(()=>[i("div",T,[h((d(),b(z,{type:"success",icon:"plus",onClick:l[2]||(l[2]=e=>X())},{default:n(()=>[...l[12]||(l[12]=[f(" 新增 ",-1)])]),_:1})),[[me,["sys:dept:add"]]]),h((d(),b(z,{type:"danger",disabled:0===m(S).length,icon:"delete",onClick:l[3]||(l[3]=e=>ee())},{default:n(()=>[...l[13]||(l[13]=[f(" 删除 ",-1)])]),_:1},8,["disabled"])),[[me,["sys:dept:delete"]]])]),h((d(),b(oe,{data:m(Q),"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:M},{default:n(()=>[r(te,{type:"selection",width:"55",align:"center"}),r(te,{prop:"name",label:"部门名称","min-width":"200"}),r(te,{prop:"code",label:"部门编号",width:"200"}),r(te,{prop:"status",label:"状态",width:"100"},{default:n(e=>[1==e.row.status?(d(),b(se,{key:0,type:"success"},{default:n(()=>[...l[14]||(l[14]=[f("正常",-1)])]),_:1})):(d(),b(se,{key:1,type:"info"},{default:n(()=>[...l[15]||(l[15]=[f("禁用",-1)])]),_:1}))]),_:1}),r(te,{prop:"sort",label:"排序",width:"100"}),r(te,{label:"操作",fixed:"right",align:"left",width:"200"},{default:n(e=>[h((d(),b(z,{type:"primary",link:"",size:"small",icon:"plus",onClick:y(l=>X(e.row.id,void 0),["stop"])},{default:n(()=>[...l[16]||(l[16]=[f(" 新增 ",-1)])]),_:1},8,["onClick"])),[[me,["sys:dept:add"]]]),h((d(),b(z,{type:"primary",link:"",size:"small",icon:"edit",onClick:y(l=>X(e.row.parentId,e.row.id),["stop"])},{default:n(()=>[...l[17]||(l[17]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[me,["sys:dept:edit"]]]),h((d(),b(z,{type:"danger",link:"",size:"small",icon:"delete",onClick:y(l=>ee(e.row.id),["stop"])},{default:n(()=>[...l[18]||(l[18]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])),[[me,["sys:dept:delete"]]])]),_:1})]),_:1},8,["data"])),[[ce,m(P)]])]),_:1}),r(pe,{modelValue:m(N).visible,"onUpdate:modelValue":l[9]||(l[9]=e=>m(N).visible=e),title:m(N).title,width:"600px",onClosed:le},{footer:n(()=>[i("div",A,[r(z,{type:"primary",onClick:Z},{default:n(()=>[...l[21]||(l[21]=[f("确 定",-1)])]),_:1}),r(z,{onClick:le},{default:n(()=>[...l[22]||(l[22]=[f("取 消",-1)])]),_:1})])]),default:n(()=>[r(ae,{ref_key:"deptFormRef",ref:L,model:m(Y),rules:m($),"label-width":"80px"},{default:n(()=>[r(t,{label:"上级部门",prop:"parentId"},{default:n(()=>[r(ie,{modelValue:m(Y).parentId,"onUpdate:modelValue":l[4]||(l[4]=e=>m(Y).parentId=e),placeholder:"选择上级部门",data:m(W),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])]),_:1}),r(t,{label:"部门名称",prop:"name"},{default:n(()=>[r(a,{modelValue:m(Y).name,"onUpdate:modelValue":l[5]||(l[5]=e=>m(Y).name=e),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),r(t,{label:"部门编号",prop:"code"},{default:n(()=>[r(a,{modelValue:m(Y).code,"onUpdate:modelValue":l[6]||(l[6]=e=>m(Y).code=e),placeholder:"请输入部门编号"},null,8,["modelValue"])]),_:1}),r(t,{label:"显示排序",prop:"sort"},{default:n(()=>[r(re,{modelValue:m(Y).sort,"onUpdate:modelValue":l[7]||(l[7]=e=>m(Y).sort=e),"controls-position":"right",style:{width:"100px"},min:0},null,8,["modelValue"])]),_:1}),r(t,{label:"部门状态"},{default:n(()=>[r(ue,{modelValue:m(Y).status,"onUpdate:modelValue":l[8]||(l[8]=e=>m(Y).status=e)},{default:n(()=>[r(ne,{value:1},{default:n(()=>[...l[19]||(l[19]=[f("正常",-1)])]),_:1}),r(ne,{value:0},{default:n(()=>[...l[20]||(l[20]=[f("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{K as default};
