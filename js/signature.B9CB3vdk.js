import{d as e,r as t,o as a,g as n,f as o,D as s,h as l,m as c,w as i,ai as r,ah as u,j as h,i as d,aZ as f,aJ as v}from"./index.Dv9sjPYC.js";import{F as p}from"./file-api.C9PIarN4.js";const g={class:"canvas-dom"},m=["src"],w=v(e({__name:"signature",setup(e){const v=t(""),w=t();let y,k=!1;const _=e=>{let t;if(e.offsetX){const{offsetX:a,offsetY:n}=e;t=[a,n]}else{const{top:a,left:n}=w.value.getBoundingClientRect();t=[e.touches[0].clientX-n,e.touches[0].clientY-a]}return t};let C=0,R=0;const D=e=>{[C,R]=_(e),k=!0},T=e=>{if(k){const[t,a]=_(e);!function(e,t,a,n,o){o.beginPath(),o.globalAlpha=1,o.lineWidth=2,o.strokeStyle="#000",o.moveTo(e,t),o.lineTo(a,n),o.closePath(),o.stroke()}(C,R,t,a,y),C=t,R=a}},U=()=>{k&&(k=!1)};a(()=>{y=w.value.getContext("2d")});const E=async()=>{if(M(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=j(w.value.toDataURL(),"签名.png");if(!e)return;const t=await p.uploadFile(e);L(),v.value=t.url},L=()=>{y.clearRect(0,0,w.value.width,w.value.height)},M=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},b=()=>{if(M(w.value))return void f({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=w.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},j=(e,t)=>{const a=e.split(",");if(!a.length)return;const n=a[0].match(/:(.*?);/);if(n){const e=atob(a[1]);let o=e.length;const s=new Uint8Array(o);for(;o--;)s[o]=e.charCodeAt(o);return new File([s],t,{type:n[1]})}};return(e,t)=>{const a=u;return o(),n("div",g,[t[3]||(t[3]=s("h3",null,"基于canvas实现的签名组件",-1)),s("header",null,[c(a,{type:"primary",onClick:b},{default:i(()=>[...t[0]||(t[0]=[r("保存为图片",-1)])]),_:1}),c(a,{onClick:E},{default:i(()=>[...t[1]||(t[1]=[r("保存到后端",-1)])]),_:1}),c(a,{onClick:L},{default:i(()=>[...t[2]||(t[2]=[r("清空签名",-1)])]),_:1})]),s("canvas",{ref_key:"canvas",ref:w,height:"200",width:"500",onMousedown:D,onMousemove:h(T,["stop","prevent"]),onMouseup:U,onTouchstart:D,onTouchmove:h(T,["stop","prevent"]),onTouchend:U},null,544),d(v)?(o(),n("img",{key:0,src:d(v),alt:"签名"},null,8,m)):l("",!0)])}}}),[["__scopeId","data-v-e049ea72"]]);export{w as default};
