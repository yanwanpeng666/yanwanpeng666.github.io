import{d as t,r as e,o as a,a as n,c as o,k as s,W as c,w as l,$ as r,aa as i,f as u,X as d,ax as h,Z as f,aM as v,aN as p}from"./index.BM8HYK7W.js";import{u as m}from"./index.e4ljorWg.js";import{_ as g}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w={class:"canvas-dom"},_=(t=>(v("data-v-18dcb207"),t=t(),p(),t))((()=>s("h3",null,"基于canvas实现的签名组件",-1))),y=["src"],k=g(t({__name:"signature",setup(t){const v=e(""),p=e();let g,k=!1;const x=t=>{let e;if(t.offsetX){const{offsetX:a,offsetY:n}=t;e=[a,n]}else{const{top:a,left:n}=p.value.getBoundingClientRect();e=[t.touches[0].clientX-n,t.touches[0].clientY-a]}return e};let C=0,R=0;const b=t=>{[C,R]=x(t),k=!0},M=t=>{if(k){const[e,a]=x(t);!function(t,e,a,n,o){o.beginPath(),o.globalAlpha=1,o.lineWidth=2,o.strokeStyle="#000",o.moveTo(t,e),o.lineTo(a,n),o.closePath(),o.stroke()}(C,R,e,a,g),C=e,R=a}},T=()=>{k&&(k=!1)};a((()=>{g=p.value.getContext("2d")}));const U=async()=>{if(E(p.value))return void h({type:"warning",message:"当前签名文件为空"});const t=X(p.value.toDataURL(),"签名.png");if(!t)return;const{data:e}=await m(t);D(),v.value=e.url},D=()=>{g.clearRect(0,0,p.value.width,p.value.height)},E=t=>{const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.toDataURL()==e.toDataURL()},L=()=>{if(E(p.value))return void h({type:"warning",message:"当前签名文件为空"});const t=document.createElement("a");t.href=p.value.toDataURL(),t.download="签名";const e=new MouseEvent("click");t.dispatchEvent(e)},X=(t,e)=>{const a=t.split(",");if(!a.length)return;const n=a[0].match(/:(.*?);/);if(n){const t=atob(a[1]);let o=t.length;const s=new Uint8Array(o);for(;o--;)s[o]=t.charCodeAt(o);return new File([s],e,{type:n[1]})}};return(t,e)=>{const a=f;return n(),o("div",w,[_,s("header",null,[c(a,{type:"primary",onClick:L},{default:l((()=>[r("保存为图片")])),_:1}),c(a,{onClick:U},{default:l((()=>[r(" 保存到后端 ")])),_:1}),c(a,{onClick:D},{default:l((()=>[r(" 清空签名 ")])),_:1})]),s("canvas",{ref_key:"canvas",ref:p,height:"200",width:"500",onMousedown:b,onMousemove:i(M,["stop","prevent"]),onMouseup:T,onTouchstart:b,onTouchmove:i(M,["stop","prevent"]),onTouchend:T},null,544),u(v)?(n(),o("img",{key:0,src:u(v),alt:"签名"},null,8,y)):d("",!0)])}}}),[["__scopeId","data-v-18dcb207"]]);export{k as default};
