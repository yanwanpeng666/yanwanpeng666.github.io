import{d as e,r as t,o as n,e as o,h as a,B as s,l,w as r,X as c,j as i,g as u,p as d,ax as h}from"./index.DLIlyPl-.js";import{E as f}from"./el-button.DTalRruu.js";import{F as p}from"./index.DB30ZUFl.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.DlUwyd6C.js";import"./use-form-item.h287A-2q.js";const v={class:"canvas-dom"},g=["src"],w=m(e({__name:"signature",setup(e){const m=t(""),w=t();let _,y=!1;const k=e=>{let t;if(e.offsetX){const{offsetX:n,offsetY:o}=e;t=[n,o]}else{const{top:n,left:o}=w.value.getBoundingClientRect();t=[e.touches[0].clientX-o,e.touches[0].clientY-n]}return t};let j=0,x=0;const C=e=>{[j,x]=k(e),y=!0},R=e=>{if(y){const[t,n]=k(e);!function(e,t,n,o,a){a.beginPath(),a.globalAlpha=1,a.lineWidth=2,a.strokeStyle="#000",a.moveTo(e,t),a.lineTo(n,o),a.closePath(),a.stroke()}(j,x,t,n,_),j=t,x=n}},E=()=>{y&&(y=!1)};n((()=>{_=w.value.getContext("2d")}));const T=async()=>{if(b(w.value))return void h({type:"warning",message:"当前签名文件为空"});const e=L(w.value.toDataURL(),"签名.png");if(!e)return;const t=await p.upload(e);U(),m.value=t.url},U=()=>{_.clearRect(0,0,w.value.width,w.value.height)},b=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()==t.toDataURL()},D=()=>{if(b(w.value))return void h({type:"warning",message:"当前签名文件为空"});const e=document.createElement("a");e.href=w.value.toDataURL(),e.download="签名";const t=new MouseEvent("click");e.dispatchEvent(t)},L=(e,t)=>{const n=e.split(",");if(!n.length)return;const o=n[0].match(/:(.*?);/);if(o){const e=atob(n[1]);let a=e.length;const s=new Uint8Array(a);for(;a--;)s[a]=e.charCodeAt(a);return new File([s],t,{type:o[1]})}};return(e,t)=>{const n=f;return o(),a("div",v,[t[3]||(t[3]=s("h3",null,"基于canvas实现的签名组件",-1)),s("header",null,[l(n,{type:"primary",onClick:D},{default:r((()=>t[0]||(t[0]=[c("保存为图片")]))),_:1}),l(n,{onClick:T},{default:r((()=>t[1]||(t[1]=[c("保存到后端")]))),_:1}),l(n,{onClick:U},{default:r((()=>t[2]||(t[2]=[c("清空签名")]))),_:1})]),s("canvas",{ref_key:"canvas",ref:w,height:"200",width:"500",onMousedown:C,onMousemove:i(R,["stop","prevent"]),onMouseup:E,onTouchstart:C,onTouchmove:i(R,["stop","prevent"]),onTouchend:E},null,544),u(m)?(o(),a("img",{key:0,src:u(m),alt:"签名"},null,8,g)):d("",!0)])}}}),[["__scopeId","data-v-18a13f8a"]]);export{w as default};
