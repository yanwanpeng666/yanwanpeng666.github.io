import{E as e,a as t,s as l}from"./select.D46WCvpG.js";import{E as a}from"./tree.Dcl2NF7B.js";import{b as s,J as o,o as n,u as d,L as r,M as c,Z as u,c as i,aa as v,b8 as p,U as h,d as f,C as k,at as y,bY as C,O as m,bZ as b,b_ as N,B as g,I as x,_ as K,r as O,W as E,aq as V,q as S}from"./index.Dv9sjPYC.js";import{e as M}from"./strings.BtizHOxT.js";const w=f({extends:t,setup(e,l){const a=t.setup(e,l);delete a.selectOptionClick;const s=k().proxy;return u(()=>{a.select.states.cachedOptions.get(s.value)||a.select.onOptionCreate(s)}),o(()=>l.attrs.visible,e=>{u(()=>{a.states.visible=e})},{immediate:!0}),a},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||0===e}function A(e){return y(e)&&e.length}function L(e){return y(e)?e:j(e)?[e]:[]}function $(e,t,l,a,s){for(let o=0;o<e.length;o++){const n=e[o];if(t(n,o,e,s))return a?a(n,o,e,s):n;{const e=l(n);if(A(e)){const s=$(e,t,l,a,n);if(s)return s}}}}function q(e,t,l,a){for(let s=0;s<e.length;s++){const o=e[s];t(o,s,e,a);const n=l(o);A(n)&&q(n,t,l,o)}}var H=f({props:{data:{type:Array,default:()=>[]}},setup(e){const t=g(l);return o(()=>e.data,()=>{var l;e.data.forEach(e=>{t.states.cachedOptions.has(e.value)||t.states.cachedOptions.set(e.value,e)});const a=(null==(l=t.selectRef)?void 0:l.querySelectorAll("input"))||[];x&&!Array.from(a).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const R=S(K(f({name:"ElTreeSelect",inheritAttrs:!1,props:{...e.props,...a.props,cacheData:{type:Array,default:()=>[]}},setup(t,l){const{slots:f,expose:k}=l,y=O(),g=O(),x=i(()=>t.nodeKey||t.valueKey||"value"),K=((t,{attrs:l,emit:a},{select:f,tree:k,key:y})=>{const C=s("tree-select");o(()=>t.data,()=>{t.filterable&&u(()=>{var e,t;null==(t=k.value)||t.filter(null==(e=f.value)?void 0:e.states.inputValue)})},{flush:"post"});const m=e=>{var t;const l=e.at(-1);if(!l.expanded||!l.childNodes.at(-1)){const l=null==(t=k.value.el$)?void 0:t.querySelector(`[data-key="${e.at(-1).key}"]`);return void(null==l||l.focus({preventScroll:!0}))}m([l.childNodes.at(-1)])};return n(()=>{d(()=>{var e;return null==(e=f.value)?void 0:e.$el},"keydown",async e=>{const t=r(e),{dropdownMenuVisible:l}=f.value;[c.down,c.up].includes(t)&&l&&(await u(),setTimeout(()=>{var e,l,a;if(c.up===t){const e=k.value.store.root.childNodes;return void m(e)}null==(a=null==(l=null==(e=f.value.optionsArray[f.value.states.hoveringIndex].$el)?void 0:e.parentNode)?void 0:l.parentNode)||a.focus({preventScroll:!0})}))},{capture:!0})}),{...v(p(t),Object.keys(e.props)),...l,class:i(()=>l.class),style:i(()=>l.style),"onUpdate:modelValue":e=>a(h,e),valueKey:y,popperClass:i(()=>{const e=[C.e("popper")];return t.popperClass&&e.push(t.popperClass),e.join(" ")}),filterMethod:(e="")=>{var l;t.filterMethod?t.filterMethod(e):t.remoteMethod?t.remoteMethod(e):null==(l=k.value)||l.filter(e)}}})(t,l,{select:y,tree:g,key:x}),{cacheOptions:S,...R}=((e,{attrs:t,slots:l,emit:s},{select:n,tree:d,key:r})=>{o([()=>e.modelValue,d],()=>{e.showCheckbox&&u(()=>{const t=d.value;t&&!N(t.getCheckedKeys(),L(e.modelValue))&&t.setCheckedKeys(L(e.modelValue))})},{immediate:!0,deep:!0});const c=i(()=>({value:r.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),f=(e,t)=>{var l;const a=c.value[e];return b(a)?a(t,null==(l=d.value)?void 0:l.getNode(f("value",t))):t[a]},k=L(e.modelValue).map(t=>$(e.data||[],e=>f("value",e)===t,e=>f("children",e),(e,t,l,a)=>a&&f("value",a))).filter(e=>j(e)),y=i(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return q(e.data.concat(e.cacheData),e=>{const l=f("value",e);t.push({value:l,currentLabel:f("label",e),isDisabled:f("disabled",e)})},e=>f("children",e)),t}),g=()=>{var e;return null==(e=d.value)?void 0:e.getCheckedKeys().filter(e=>{var t;const l=null==(t=d.value)?void 0:t.getNode(e);return!m(l)&&C(l.childNodes)})};return{...v(p(e),Object.keys(a.props)),...t,nodeKey:r,expandOnClickNode:i(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:i(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(k):k),renderContent:(t,{node:a,data:s,store:o})=>t(w,{value:f("value",s),label:f("label",s),disabled:f("disabled",s),visible:a.visible},e.renderContent?()=>e.renderContent(t,{node:a,data:s,store:o}):l.default?()=>l.default({node:a,data:s,store:o}):void 0),filterNodeMethod:(t,l,a)=>e.filterNodeMethod?e.filterNodeMethod(t,l,a):!t||new RegExp(M(t),"i").test(f("label",l)||""),onNodeClick:(l,a,s)=>{var o,d,r;if(null==(o=t.onNodeClick)||o.call(t,l,a,s),!e.showCheckbox||!e.checkOnClickNode)if(e.showCheckbox||!e.checkStrictly&&!a.isLeaf)e.expandOnClickNode&&s.proxy.handleExpandIconClick();else if(!f("disabled",l)){const e=null==(d=n.value)?void 0:d.states.options.get(f("value",l));null==(r=n.value)||r.handleOptionSelect(e)}},onCheck:(l,a)=>{var o;if(!e.showCheckbox)return;const r=f("value",l),c={};q([d.value.store.root],e=>c[e.key]=e,e=>e.childNodes);const i=a.checkedKeys,v=e.multiple?L(e.modelValue).filter(e=>!(e in c)&&!i.includes(e)):[],p=v.concat(i);if(e.checkStrictly)s(h,e.multiple?p:p.includes(r)?r:void 0);else if(e.multiple){const e=g();s(h,v.concat(e))}else{const t=$([l],e=>!A(f("children",e))&&!f("disabled",e),e=>f("children",e)),a=t?f("value",t):void 0,o=j(e.modelValue)&&!!$([l],t=>f("value",t)===e.modelValue,e=>f("children",e));s(h,a===e.modelValue||o?void 0:a)}u(()=>{var a;const s=L(e.modelValue);d.value.setCheckedKeys(s),null==(a=t.onCheck)||a.call(t,l,{checkedKeys:d.value.getCheckedKeys(),checkedNodes:d.value.getCheckedNodes(),halfCheckedKeys:d.value.getHalfCheckedKeys(),halfCheckedNodes:d.value.getHalfCheckedNodes()})}),null==(o=n.value)||o.focus()},onNodeExpand:(l,a,o)=>{var n;null==(n=t.onNodeExpand)||n.call(t,l,a,o),u(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&a.checked){const t={},l=d.value.getCheckedKeys();q([d.value.store.root],e=>t[e.key]=e,e=>e.childNodes);const a=L(e.modelValue).filter(e=>!(e in t)&&!l.includes(e)),o=g();s(h,a.concat(o))}})},cacheOptions:y}})(t,l,{select:y,tree:g,key:x}),_=E({});return k(_),n(()=>{Object.assign(_,{...v(g.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...v(y.value,["focus","blur","selectedLabel"]),treeRef:g.value,selectRef:y.value})}),()=>V(e,E({...K,ref:e=>y.value=e}),{...f,default:()=>[V(H,{data:S.value}),V(a,E({...R,ref:e=>g.value=e}))]})}}),[["__file","tree-select.vue"]]));export{R as E};
