import{d as e,cl as l,cm as a,r as t,J as s,aK as i,g as u,f as n,m as r,k as o,i as d,aT as p,w as c,ah as m,ai as f,G as y,D as v,E as g,j as _,aZ as h,aJ as b,cy as x,e as w,S as j,o as k,h as C}from"./index.Dv9sjPYC.js";import{E as F,a as S}from"./form-item.DgRMSZzs.js";import{E as V}from"./upload.BgURkZfm.js";import{E as z}from"./progress.B6GDuKkw.js";import{F as M}from"./file-api.C9PIarN4.js";import{E as O,a as E}from"./image-viewer.DOnoIQmi.js";import{E as I}from"./link.CHuo07Uc.js";import"./castArray.D1K_WIrw.js";import"./_baseClone.Br4BWTY9.js";import"./debounce.CITkvERZ.js";import"./toNumber.P9ps2NTq.js";const N={key:0,class:"el-upload-list__item-info"},U=["onClick"],D={class:"el-upload-list__item-file-name"},L=["onClick"],W={key:1,class:"el-upload-list__item-info"},q=b(e({__name:"FileUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"*"},uploadBtnText:{type:String,default:"上传文件"},style:{type:Object,default:()=>({width:"300px"})}},{modelValue:{type:[Array],required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,b=a(e,"modelValue"),x=t([]);function w(e){return!(e.size>1024*l.maxFileSize*1024)||(h.warning("上传文件不能大于"+l.maxFileSize+"M"),!1)}function j(e){return new Promise((a,t)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach(e=>{i.append(e,l.data[e])}),M.upload(i,e=>{const l=s.uid,a=x.value.find(e=>e.uid===l);a&&(a.percentage=e)}).then(e=>{a(e)}).catch(e=>{t(e)})})}function k(){h.warning(`最多只能上传${l.limit}个文件`)}s(b,e=>{x.value=e.map(e=>({name:e.name?e.name:e.url?.substring(e.url.lastIndexOf("/")+1),url:e.url,status:"success",uid:Date.now()<<13|Math.floor(8192*Math.random())}))},{immediate:!0});const C=(e,l,a)=>{if(h.success("上传成功"),a.every(e=>"success"===e.status||"fail"===e.status)){const e=[];a.map(l=>{if("success"===l.status){const a=l.response;a&&e.push({name:a.name,url:a.url})}else x.value.splice(x.value.findIndex(e=>e.uid===l.uid),1)}),e.length>0&&(b.value=[...b.value,...e])}},F=e=>{h.error("上传失败")};return(e,a)=>{const t=m,s=i("Document"),h=g,S=i("Close"),O=z,E=V;return n(),u("div",null,[r(E,{"file-list":d(x),"onUpdate:fileList":a[0]||(a[0]=e=>p(x)?x.value=e:null),style:o(l.style),"before-upload":w,"http-request":j,"on-success":C,"on-error":F,"on-exceed":k,accept:l.accept,limit:l.limit,multiple:""},{file:c(({file:e})=>["success"===e.status?(n(),u("div",N,[v("a",{class:"el-upload-list__item-name",onClick:l=>function(e){const{url:l,name:a}=e;l&&M.download(l,a)}(e)},[r(h,null,{default:c(()=>[r(s)]),_:1}),v("span",D,y(e.name),1),v("span",{class:"el-icon--close",onClick:_(l=>{return a=e.url,void M.delete(a).then(()=>{b.value=b.value.filter(e=>e.url!==a)});var a},["stop"])},[r(h,null,{default:c(()=>[r(S)]),_:1})],8,L)],8,U)])):(n(),u("div",W,[r(O,{style:{display:"inline-flex"},percentage:e.percentage},null,8,["percentage"])]))]),default:c(()=>[r(t,{type:"primary",disabled:d(x).length>=l.limit},{default:c(()=>[f(y(l.uploadBtnText),1)]),_:1},8,["disabled"])]),_:1},8,["file-list","style","accept","limit"])])}}}),[["__scopeId","data-v-ad85268c"]]),P=b(e({__name:"SingleImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"},style:{type:Object,default:()=>({width:"150px",height:"150px"})}},{modelValue:{type:String,default:()=>""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){x(e=>({v25d788e4:l.style.width??"150px",v424efe59:l.style.height??"150px"}));const l=e,t=a(e,"modelValue");function s(e){return l.accept.split(",").map(e=>e.trim()).some(l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l)?!(e.size>1024*l.maxFileSize*1024)||(h.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(h.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function o(e){return new Promise((a,t)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach(e=>{i.append(e,l.data[e])}),M.upload(i).then(e=>{a(e)}).catch(e=>{t(e)})})}function d(){}function p(){t.value=""}const m=e=>{h.success("上传成功"),t.value=e.url},f=e=>{h.error("上传失败: "+e.message)};return(e,a)=>{const y=O,v=i("CircleCloseFilled"),h=g,b=i("Plus"),x=V;return n(),w(x,{class:"single-upload","list-type":"picture-card","show-file-list":!1,accept:l.accept,"before-upload":s,"http-request":o,"on-success":m,"on-error":f},{default:c(()=>[t.value?(n(),u(j,{key:0},[r(y,{class:"single-upload__image",src:t.value,"preview-src-list":[t.value],onClick:_(d,["stop"])},null,8,["src","preview-src-list"]),r(h,{class:"single-upload__delete-btn",onClick:_(p,["stop"])},{default:c(()=>[r(v)]),_:1})],64)):(n(),w(h,{key:1},{default:c(()=>[r(b)]),_:1}))]),_:1},8,["accept"])}}}),[["__scopeId","data-v-bd22d71e"]]),H={style:{width:"100%"}},K=["src"],Z={class:"el-upload-list__item-actions"},A=["onClick"],J=["onClick"],Q=e({__name:"MultiImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"}},{modelValue:{type:[Array],default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,s=t(!1),o=t(0),m=a(e,"modelValue"),f=t([]);function y(e){return l.accept.split(",").map(e=>e.trim()).some(l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l)?!(e.size>1024*l.maxFileSize*1024)||(h.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(h.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function _(e){return new Promise((a,t)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach(e=>{i.append(e,l.data[e])}),M.upload(i).then(e=>{a(e)}).catch(e=>{t(e)})})}function b(){h.warning("最多只能上传"+l.limit+"张图片")}const x=(e,l)=>{h.success("上传成功");const a=f.value.findIndex(e=>e.uid===l.uid);-1!==a&&(f.value[a].url=e.url,f.value[a].status="success",m.value[a]=e.url)},F=e=>{h.error("上传失败: "+e.message)},S=()=>{s.value=!1};return k(()=>{f.value=m.value.map(e=>({url:e}))}),(e,a)=>{const t=i("Plus"),h=g,k=i("zoom-in"),z=i("Delete"),O=V,I=E;return n(),u(j,null,[r(O,{"file-list":d(f),"onUpdate:fileList":a[0]||(a[0]=e=>p(f)?f.value=e:null),"list-type":"picture-card","before-upload":y,"http-request":_,"on-success":x,"on-error":F,"on-exceed":b,accept:l.accept,limit:l.limit,multiple:""},{file:c(({file:e})=>[v("div",H,[v("img",{class:"el-upload-list__item-thumbnail",src:e.url},null,8,K),v("span",Z,[v("span",{onClick:l=>{return a=e.url,o.value=m.value.findIndex(e=>e===a),void(s.value=!0);var a}},[r(h,null,{default:c(()=>[r(k)]),_:1})],8,A),v("span",{onClick:l=>{return a=e.url,void M.delete(a).then(()=>{const e=m.value.indexOf(a);-1!==e&&(m.value.splice(e,1),f.value.splice(e,1))});var a}},[r(h,null,{default:c(()=>[r(z)]),_:1})],8,J)])])]),default:c(()=>[r(h,null,{default:c(()=>[r(t)]),_:1})]),_:1},8,["file-list","accept","limit"]),d(s)?(n(),w(I,{key:0,"zoom-rate":1.2,"initial-index":d(o),"url-list":m.value,onClose:S},null,8,["initial-index","url-list"])):C("",!0)],64)}}}),T={class:"app-container"},$=e({__name:"upload",setup(e){const l=t("https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"),a=t(["https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"]),s=t([{name:"照片1.jpg",url:"https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"},{name:"照片2.jpg",url:"https://s2.loli.net/2023/05/24/RuHFMwW4rG5lIqs.jpg"}]);return(e,t)=>{const i=I,o=P,m=F,y=q,v=S;return n(),u("div",T,[r(i,{href:"https://gitee.com/youlaiorg/vue3-element-admin/blob/master/src/views/demo/upload.vue",type:"primary",target:"_blank",class:"mb-10"},{default:c(()=>[...t[3]||(t[3]=[f(" 示例源码 请点击>>>> ",-1)])]),_:1}),r(v,null,{default:c(()=>[r(m,{label:"单图上传"},{default:c(()=>[r(o,{modelValue:d(l),"onUpdate:modelValue":t[0]||(t[0]=e=>p(l)?l.value=e:null)},null,8,["modelValue"])]),_:1}),r(m,{label:"多图上传"},{default:c(()=>[r(Q,{modelValue:d(a),"onUpdate:modelValue":t[1]||(t[1]=e=>p(a)?a.value=e:null),limit:2},null,8,["modelValue"])]),_:1}),r(m,{label:"文件上传"},{default:c(()=>[r(y,{modelValue:d(s),"onUpdate:modelValue":t[2]||(t[2]=e=>p(s)?s.value=e:null)},null,8,["modelValue"])]),_:1})]),_:1})])}}});export{$ as default};
